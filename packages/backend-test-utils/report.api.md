## API Report File for "@backstage/backend-test-utils"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="express" />
/// <reference types="jest" />
/// <reference types="node" />
/// <reference types="qs" />

import { AuditorService } from '@backstage/backend-plugin-api';
import { AuthService } from '@backstage/backend-plugin-api';
import { Backend } from '@backstage/backend-app-api';
import { BackendFeature } from '@backstage/backend-plugin-api';
import { BackstageCredentials } from '@backstage/backend-plugin-api';
import { BackstageNonePrincipal } from '@backstage/backend-plugin-api';
import { BackstagePrincipalAccessRestrictions } from '@backstage/backend-plugin-api';
import { BackstageServicePrincipal } from '@backstage/backend-plugin-api';
import { BackstageUserInfo } from '@backstage/backend-plugin-api';
import { BackstageUserPrincipal } from '@backstage/backend-plugin-api';
import { CacheService } from '@backstage/backend-plugin-api';
import { DatabaseService } from '@backstage/backend-plugin-api';
import { DiscoveryService } from '@backstage/backend-plugin-api';
import { ErrorRequestHandler } from 'express';
import { EventsService } from '@backstage/plugin-events-node';
import { ExtendedHttpServer } from '@backstage/backend-defaults/rootHttpRouter';
import { ExtensionPoint } from '@backstage/backend-plugin-api';
import { HttpAuthService } from '@backstage/backend-plugin-api';
import { HttpRouterService } from '@backstage/backend-plugin-api';
import { JsonObject } from '@backstage/types';
import Keyv from 'keyv';
import { Knex } from 'knex';
import { LifecycleService } from '@backstage/backend-plugin-api';
import { LoggerService } from '@backstage/backend-plugin-api';
import { ParamsDictionary } from 'express-serve-static-core';
import { ParsedQs } from 'qs';
import { PermissionsRegistryService } from '@backstage/backend-plugin-api';
import { PermissionsService } from '@backstage/backend-plugin-api';
import { RootConfigService } from '@backstage/backend-plugin-api';
import { RootHealthService } from '@backstage/backend-plugin-api';
import { RootHttpRouterService } from '@backstage/backend-plugin-api';
import { RootLifecycleService } from '@backstage/backend-plugin-api';
import { RootLoggerService } from '@backstage/backend-plugin-api';
import { SchedulerService } from '@backstage/backend-plugin-api';
import { ServiceFactory } from '@backstage/backend-plugin-api';
import { ServiceRef } from '@backstage/backend-plugin-api';
import { UrlReaderService } from '@backstage/backend-plugin-api';
import { UserInfoService } from '@backstage/backend-plugin-api';

// @public
export function createMockDirectory(
  options?: CreateMockDirectoryOptions,
): MockDirectory;

// @public
export interface CreateMockDirectoryOptions {
  content?: MockDirectoryContent;
  mockOsTmpDir?: boolean;
}

// @public (undocumented)
export namespace mockCredentials {
  export function limitedUser(
    userEntityRef?: string,
  ): BackstageCredentials<BackstageUserPrincipal>;
  export namespace limitedUser {
    export function cookie(userEntityRef?: string): string;
    // (undocumented)
    export function invalidCookie(): string;
    // (undocumented)
    export function invalidToken(): string;
    export function token(userEntityRef?: string): string;
  }
  export function none(): BackstageCredentials<BackstageNonePrincipal>;
  export namespace none {
    export function header(): string;
  }
  export function service(
    subject?: string,
    accessRestrictions?: BackstagePrincipalAccessRestrictions,
  ): BackstageCredentials<BackstageServicePrincipal>;
  export namespace service {
    export function header(options?: TokenOptions): string;
    // (undocumented)
    export function invalidHeader(): string;
    // (undocumented)
    export function invalidToken(): string;
    export function token(options?: TokenOptions): string;
    export type TokenOptions = {
      onBehalfOf: BackstageCredentials;
      targetPluginId: string;
    };
  }
  export function user(
    userEntityRef?: string,
  ): BackstageCredentials<BackstageUserPrincipal>;
  export namespace user {
    export function header(userEntityRef?: string): string;
    // (undocumented)
    export function invalidHeader(): string;
    // (undocumented)
    export function invalidToken(): string;
    export function token(userEntityRef?: string): string;
  }
}

// @public
export interface MockDirectory {
  addContent(root: MockDirectoryContent): void;
  clear(): void;
  content(
    options?: MockDirectoryContentOptions,
  ): MockDirectoryContent | undefined;
  readonly path: string;
  remove(): void;
  resolve(...paths: string[]): string;
  setContent(root: MockDirectoryContent): void;
}

// @public
export type MockDirectoryContent = {
  [name in string]:
    | MockDirectoryContent
    | string
    | Buffer
    | MockDirectoryContentCallback;
};

// @public
export type MockDirectoryContentCallback = (
  ctx: MockDirectoryContentCallbackContext,
) => void;

// @public
export interface MockDirectoryContentCallbackContext {
  path: string;
  symlink(target: string): void;
}

// @public
export interface MockDirectoryContentOptions {
  path?: string;
  shouldReadAsText?: boolean | ((path: string, buffer: Buffer) => boolean);
}

// @public
export function mockErrorHandler(): ErrorRequestHandler<
  ParamsDictionary,
  any,
  any,
  ParsedQs,
  Record<string, any>
>;

// @public
export namespace mockServices {
  // (undocumented)
  export namespace auditor {
    const // (undocumented)
      factory: () => ServiceFactory<AuditorService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<AuditorService> | undefined,
      ) => ServiceMock<AuditorService>;
  }
  // (undocumented)
  export function auth(options?: {
    pluginId?: string;
    disableDefaultAuthPolicy?: boolean;
  }): AuthService;
  // (undocumented)
  export namespace auth {
    const // (undocumented)
      factory: () => ServiceFactory<AuthService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<AuthService> | undefined,
      ) => ServiceMock<AuthService>;
  }
  // (undocumented)
  export namespace cache {
    const // (undocumented)
      factory: () => ServiceFactory<CacheService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<CacheService> | undefined,
      ) => ServiceMock<CacheService>;
  }
  export function database(options: {
    knex: Knex;
    migrations?: {
      skip?: boolean;
    };
  }): DatabaseService;
  // (undocumented)
  export namespace database {
    const factory: (options?: {
      knex: Knex;
      migrations?: {
        skip?: boolean;
      };
    }) => ServiceFactory<DatabaseService, 'plugin', 'singleton'>;
    const mock: (
      partialImpl?: Partial<DatabaseService> | undefined,
    ) => ServiceMock<DatabaseService>;
  }
  // (undocumented)
  export function discovery(): DiscoveryService;
  // (undocumented)
  export namespace discovery {
    const // (undocumented)
      factory: () => ServiceFactory<DiscoveryService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<DiscoveryService> | undefined,
      ) => ServiceMock<DiscoveryService>;
  }
  // (undocumented)
  export namespace events {
    const // (undocumented)
      factory: () => ServiceFactory<EventsService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<EventsService> | undefined,
      ) => ServiceMock<EventsService>;
  }
  export function httpAuth(options?: {
    pluginId?: string;
    defaultCredentials?: BackstageCredentials;
  }): HttpAuthService;
  // (undocumented)
  export namespace httpAuth {
    const factory: (options?: {
      defaultCredentials?: BackstageCredentials;
    }) => ServiceFactory<HttpAuthService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<HttpAuthService> | undefined,
      ) => ServiceMock<HttpAuthService>;
  }
  // (undocumented)
  export namespace httpRouter {
    const // (undocumented)
      factory: () => ServiceFactory<HttpRouterService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<HttpRouterService> | undefined,
      ) => ServiceMock<HttpRouterService>;
  }
  // (undocumented)
  export namespace lifecycle {
    const // (undocumented)
      factory: () => ServiceFactory<LifecycleService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<LifecycleService> | undefined,
      ) => ServiceMock<LifecycleService>;
  }
  // (undocumented)
  export namespace logger {
    const // (undocumented)
      factory: () => ServiceFactory<LoggerService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<LoggerService> | undefined,
      ) => ServiceMock<LoggerService>;
  }
  // (undocumented)
  export namespace permissions {
    const // (undocumented)
      factory: () => ServiceFactory<PermissionsService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<PermissionsService> | undefined,
      ) => ServiceMock<PermissionsService>;
  }
  // (undocumented)
  export namespace permissionsRegistry {
    const // (undocumented)
      factory: () => ServiceFactory<
        PermissionsRegistryService,
        'plugin',
        'singleton'
      >;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<PermissionsRegistryService> | undefined,
      ) => ServiceMock<PermissionsRegistryService>;
  }
  // (undocumented)
  export function rootConfig(options?: rootConfig.Options): RootConfigService;
  // (undocumented)
  export namespace rootConfig {
    // (undocumented)
    export type Options = {
      data?: JsonObject;
    };
    const // (undocumented)
      factory: (
        options?: Options | undefined,
      ) => ServiceFactory<RootConfigService, 'root', 'singleton' | 'multiton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<RootConfigService> | undefined,
      ) => ServiceMock<RootConfigService>;
  }
  // (undocumented)
  export namespace rootHealth {
    const // (undocumented)
      factory: () => ServiceFactory<RootHealthService, 'root', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<RootHealthService> | undefined,
      ) => ServiceMock<RootHealthService>;
  }
  // (undocumented)
  export namespace rootHttpRouter {
    const // (undocumented)
      factory: () => ServiceFactory<RootHttpRouterService, 'root', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<RootHttpRouterService> | undefined,
      ) => ServiceMock<RootHttpRouterService>;
  }
  // (undocumented)
  export namespace rootLifecycle {
    const // (undocumented)
      factory: () => ServiceFactory<RootLifecycleService, 'root', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<RootLifecycleService> | undefined,
      ) => ServiceMock<RootLifecycleService>;
  }
  // (undocumented)
  export function rootLogger(options?: rootLogger.Options): LoggerService;
  // (undocumented)
  export namespace rootLogger {
    // (undocumented)
    export type Options = {
      level?: 'none' | 'error' | 'warn' | 'info' | 'debug';
    };
    const // (undocumented)
      factory: (
        options?: Options | undefined,
      ) => ServiceFactory<LoggerService, 'root', 'singleton' | 'multiton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<RootLoggerService> | undefined,
      ) => ServiceMock<RootLoggerService>;
  }
  // (undocumented)
  export namespace scheduler {
    const // (undocumented)
      factory: () => ServiceFactory<SchedulerService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<SchedulerService> | undefined,
      ) => ServiceMock<SchedulerService>;
  }
  // (undocumented)
  export namespace urlReader {
    const // (undocumented)
      factory: () => ServiceFactory<UrlReaderService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<UrlReaderService> | undefined,
      ) => ServiceMock<UrlReaderService>;
  }
  export function userInfo(
    customInfo?: Partial<BackstageUserInfo>,
  ): UserInfoService;
  // (undocumented)
  export namespace userInfo {
    const factory: () => ServiceFactory<UserInfoService, 'plugin', 'singleton'>;
    const // (undocumented)
      mock: (
        partialImpl?: Partial<UserInfoService> | undefined,
      ) => ServiceMock<UserInfoService>;
  }
}

// @public
export function registerMswTestHooks(worker: {
  listen: (t: any) => void;
  close: () => void;
  resetHandlers: () => void;
}): void;

// @public
export class ServiceFactoryTester<
  TService,
  TScope extends 'root' | 'plugin',
  TInstances extends 'singleton' | 'multiton' = 'singleton',
> {
  static from<
    TService,
    TScope extends 'root' | 'plugin',
    TInstances extends 'singleton' | 'multiton' = 'singleton',
  >(
    subject: ServiceFactory<TService, TScope, TInstances>,
    options?: ServiceFactoryTesterOptions,
  ): ServiceFactoryTester<TService, TScope, TInstances>;
  getService<
    TGetService,
    TGetScope extends 'root' | 'plugin',
    TGetInstances extends 'singleton' | 'multiton' = 'singleton',
  >(
    service: ServiceRef<TGetService, TGetScope, TGetInstances>,
    ...args: 'root' extends TGetScope ? [] : [pluginId?: string]
  ): Promise<TGetInstances extends 'multiton' ? TGetService[] : TGetService>;
  getSubject(
    ...args: 'root' extends TScope ? [] : [pluginId?: string]
  ): Promise<TInstances extends 'multiton' ? TService[] : TService>;
}

// @public
export interface ServiceFactoryTesterOptions {
  dependencies?: Array<ServiceFactory>;
}

// @public (undocumented)
export type ServiceMock<TService> = {
  factory: ServiceFactory<TService>;
} & {
  [Key in keyof TService]: TService[Key] extends (
    ...args: infer Args
  ) => infer Return
    ? TService[Key] & jest.MockInstance<Return, Args>
    : TService[Key];
};

// @public (undocumented)
export function startTestBackend<TExtensionPoints extends any[]>(
  options: TestBackendOptions<TExtensionPoints>,
): Promise<TestBackend>;

// @public (undocumented)
export interface TestBackend extends Backend {
  readonly server: ExtendedHttpServer;
}

// @public (undocumented)
export interface TestBackendOptions<TExtensionPoints extends any[]> {
  // (undocumented)
  extensionPoints?: readonly [
    ...{
      [index in keyof TExtensionPoints]: [
        ExtensionPoint<TExtensionPoints[index]>,
        Partial<TExtensionPoints[index]>,
      ];
    },
  ];
  // (undocumented)
  features?: Array<
    | BackendFeature
    | Promise<{
        default: BackendFeature;
      }>
  >;
}

// @public
export type TestCacheId = 'MEMORY' | 'REDIS_7' | 'MEMCACHED_1';

// @public
export class TestCaches {
  static create(options?: {
    ids?: TestCacheId[];
    disableDocker?: boolean;
  }): TestCaches;
  // (undocumented)
  eachSupportedId(): [TestCacheId][];
  init(id: TestCacheId): Promise<{
    store: string;
    connection: string;
    keyv: Keyv;
  }>;
  // (undocumented)
  static setDefaults(options: { ids?: TestCacheId[] }): void;
  // (undocumented)
  supports(id: TestCacheId): boolean;
}

// @public
export type TestDatabaseId =
  | 'POSTGRES_16'
  | 'POSTGRES_15'
  | 'POSTGRES_14'
  | 'POSTGRES_13'
  | 'POSTGRES_12'
  | 'POSTGRES_11'
  | 'POSTGRES_9'
  | 'MYSQL_8'
  | 'SQLITE_3';

// @public
export class TestDatabases {
  static create(options?: {
    ids?: TestDatabaseId[];
    disableDocker?: boolean;
  }): TestDatabases;
  // (undocumented)
  eachSupportedId(): [TestDatabaseId][];
  init(id: TestDatabaseId): Promise<Knex>;
  // (undocumented)
  static setDefaults(options: { ids?: TestDatabaseId[] }): void;
  // (undocumented)
  supports(id: TestDatabaseId): boolean;
}
```
