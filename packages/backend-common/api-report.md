## API Report File for "@backstage/backend-common"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="node" />
/// <reference types="webpack-env" />

import { AppConfig } from '@backstage/config';
import { AuthCallback } from 'isomorphic-git';
import { AuthService } from '@backstage/backend-plugin-api';
import { BackendFeature } from '@backstage/backend-plugin-api';
import { CacheService } from '@backstage/backend-plugin-api';
import { CacheServiceOptions } from '@backstage/backend-plugin-api';
import { CacheServiceSetOptions } from '@backstage/backend-plugin-api';
import { Config } from '@backstage/config';
import { ConfigSchema } from '@backstage/config-loader';
import cors from 'cors';
import { DatabaseService } from '@backstage/backend-plugin-api';
import { DiscoveryService } from '@backstage/backend-plugin-api';
import Docker from 'dockerode';
import { ErrorRequestHandler } from 'express';
import express from 'express';
import { HttpAuthService } from '@backstage/backend-plugin-api';
import { isChildPath as isChildPath_2 } from '@backstage/backend-plugin-api';
import { isDatabaseConflictError as isDatabaseConflictError_2 } from '@backstage/backend-plugin-api';
import { KubeConfig } from '@kubernetes/client-node';
import { LifecycleService } from '@backstage/backend-plugin-api';
import { LoadConfigOptionsRemote } from '@backstage/config-loader';
import { Logger } from 'winston';
import { LoggerService } from '@backstage/backend-plugin-api';
import { MergeResult } from 'isomorphic-git';
import { PermissionsService } from '@backstage/backend-plugin-api';
import { PluginMetadataService } from '@backstage/backend-plugin-api';
import { PushResult } from 'isomorphic-git';
import { ReadCommitResult } from 'isomorphic-git';
import { Request as Request_2 } from 'express';
import { RequestHandler } from 'express';
import { resolvePackagePath as resolvePackagePath_2 } from '@backstage/backend-plugin-api';
import { resolveSafeChildPath as resolveSafeChildPath_2 } from '@backstage/backend-plugin-api';
import { RootConfigService } from '@backstage/backend-plugin-api';
import { Router } from 'express';
import { SchedulerService } from '@backstage/backend-plugin-api';
import { Server } from 'http';
import { ServiceRef } from '@backstage/backend-plugin-api';
import { TransportStreamOptions } from 'winston-transport';
import { UrlReaderService } from '@backstage/backend-plugin-api';
import { UserInfoService } from '@backstage/backend-plugin-api';
import { V1PodTemplateSpec } from '@kubernetes/client-node';
import * as winston from 'winston';
import { Writable } from 'stream';

// @public @deprecated
export type AuthCallbackOptions = {
  onAuth: AuthCallback;
  logger?: LoggerService;
};

// @public @deprecated (undocumented)
export type CacheClient = CacheService;

// @public @deprecated (undocumented)
export type CacheClientOptions = CacheServiceOptions;

// @public @deprecated (undocumented)
export type CacheClientSetOptions = CacheServiceSetOptions;

// @public @deprecated (undocumented)
export class CacheManager {
  // (undocumented)
  forPlugin(pluginId: string): PluginCacheManager;
  static fromConfig(
    config: RootConfigService,
    options?: CacheManagerOptions,
  ): CacheManager;
}

// Warning: (ae-forgotten-export) The symbol "CacheManagerOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type CacheManagerOptions = CacheManagerOptions_2;

// @public @deprecated
export function cacheToPluginCacheManager(cache: CacheService): {
  getClient(options?: CacheServiceOptions): CacheService;
};

// @public @deprecated
export const coloredFormat: winston.Logform.Format;

// @public @deprecated
export interface ContainerRunner {
  runContainer(opts: RunContainerOptions): Promise<void>;
}

// Warning: (ae-forgotten-export) The symbol "createConfigSecretEnumerator_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const createConfigSecretEnumerator: typeof createConfigSecretEnumerator_2;

// @public @deprecated
export function createLegacyAuthAdapters<
  TOptions extends {
    auth?: AuthService;
    httpAuth?: HttpAuthService;
    userInfo?: UserInfoService;
    identity?: LegacyIdentityService;
    tokenManager?: TokenManager;
    discovery: PluginEndpointDiscovery;
  },
  TAdapters = (TOptions extends {
    auth?: AuthService;
  }
    ? {
        auth: AuthService;
      }
    : {}) &
    (TOptions extends {
      httpAuth?: HttpAuthService;
    }
      ? {
          httpAuth: HttpAuthService;
        }
      : {}) &
    (TOptions extends {
      userInfo?: UserInfoService;
    }
      ? {
          userInfo: UserInfoService;
        }
      : {}),
>(options: TOptions): TAdapters;

// @public @deprecated
export function createRootLogger(
  options?: winston.LoggerOptions,
  env?: NodeJS.ProcessEnv,
): winston.Logger;

// @public @deprecated
export function createServiceBuilder(_module: NodeModule): ServiceBuilder;

// @public @deprecated
export function createStatusCheckRouter(options: {
  logger: LoggerService;
  path?: string;
  statusCheck?: StatusCheck;
}): Promise<express.Router>;

// @public @deprecated (undocumented)
export class DatabaseManager implements LegacyRootDatabaseService {
  // (undocumented)
  forPlugin(
    pluginId: string,
    deps?:
      | {
          lifecycle: LifecycleService;
          pluginMetadata: PluginMetadataService;
        }
      | undefined,
  ): PluginDatabaseManager;
  // (undocumented)
  static fromConfig(
    config: Config,
    options?: {
      migrations?: DatabaseService['migrations'];
      logger?: LoggerService;
    },
  ): DatabaseManager;
}

// Warning: (ae-forgotten-export) The symbol "DatabaseManagerOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type DatabaseManagerOptions = DatabaseManagerOptions_2;

// @public @deprecated
export class DockerContainerRunner implements ContainerRunner {
  constructor(options: { dockerClient: Docker });
  // (undocumented)
  runContainer(options: RunContainerOptions): Promise<void>;
}

// @public @deprecated
export function errorHandler(
  options?: ErrorHandlerOptions,
): ErrorRequestHandler;

// @public @deprecated
export type ErrorHandlerOptions = {
  showStackTraces?: boolean;
  logger?: LoggerService;
  logClientErrors?: boolean;
};

// @public @deprecated
export function getRootLogger(): winston.Logger;

// @public @deprecated
export function getVoidLogger(): winston.Logger;

// @public @deprecated
export class Git {
  // (undocumented)
  add(options: { dir: string; filepath: string }): Promise<void>;
  // (undocumented)
  addRemote(options: {
    dir: string;
    remote: string;
    url: string;
    force?: boolean;
  }): Promise<void>;
  // (undocumented)
  branch(options: { dir: string; ref: string }): Promise<void>;
  // (undocumented)
  checkout(options: { dir: string; ref: string }): Promise<void>;
  clone(options: {
    url: string;
    dir: string;
    ref?: string;
    depth?: number;
    noCheckout?: boolean;
  }): Promise<void>;
  // (undocumented)
  commit(options: {
    dir: string;
    message: string;
    author: {
      name: string;
      email: string;
    };
    committer: {
      name: string;
      email: string;
    };
  }): Promise<string>;
  currentBranch(options: {
    dir: string;
    fullName?: boolean;
  }): Promise<string | undefined>;
  // (undocumented)
  deleteRemote(options: { dir: string; remote: string }): Promise<void>;
  fetch(options: {
    dir: string;
    remote?: string;
    tags?: boolean;
  }): Promise<void>;
  // (undocumented)
  static fromAuth: (options: StaticAuthOptions | AuthCallbackOptions) => Git;
  // (undocumented)
  init(options: { dir: string; defaultBranch?: string }): Promise<void>;
  log(options: { dir: string; ref?: string }): Promise<ReadCommitResult[]>;
  merge(options: {
    dir: string;
    theirs: string;
    ours?: string;
    author: {
      name: string;
      email: string;
    };
    committer: {
      name: string;
      email: string;
    };
  }): Promise<MergeResult>;
  // (undocumented)
  push(options: {
    dir: string;
    remote: string;
    remoteRef?: string;
    force?: boolean;
  }): Promise<PushResult>;
  readCommit(options: { dir: string; sha: string }): Promise<ReadCommitResult>;
  remove(options: { dir: string; filepath: string }): Promise<void>;
  resolveRef(options: { dir: string; ref: string }): Promise<string>;
}

// @public @deprecated
class HostDiscovery implements DiscoveryService {
  static fromConfig(config: Config): HostDiscovery;
  // (undocumented)
  getBaseUrl(pluginId: string): Promise<string>;
  // (undocumented)
  getExternalBaseUrl(pluginId: string): Promise<string>;
}
export { HostDiscovery };
export { HostDiscovery as SingleHostDiscovery };

// @public @deprecated (undocumented)
export const isChildPath: typeof isChildPath_2;

// @public @deprecated (undocumented)
export const isDatabaseConflictError: typeof isDatabaseConflictError_2;

// @public @deprecated
export class KubernetesContainerRunner implements ContainerRunner {
  constructor(options: KubernetesContainerRunnerOptions);
  // (undocumented)
  runContainer(options: RunContainerOptions): Promise<void>;
}

// @public @deprecated
export type KubernetesContainerRunnerMountBase = {
  volumeName: string;
  basePath: string;
};

// @public @deprecated
export type KubernetesContainerRunnerOptions = {
  kubeConfig: KubeConfig;
  name: string;
  namespace?: string;
  mountBase?: KubernetesContainerRunnerMountBase;
  podTemplate?: V1PodTemplateSpec;
  timeoutMs?: number;
};

// @public @deprecated (undocumented)
export type LegacyCreateRouter<TEnv> = (deps: TEnv) => Promise<RequestHandler>;

// @public @deprecated
export interface LegacyIdentityService {
  // (undocumented)
  getIdentity(options: { request: Request_2<unknown> }): Promise<
    | {
        expiresInSeconds?: number;
        token: string;
        identity: {
          type: 'user';
          userEntityRef: string;
          ownershipEntityRefs: string[];
        };
      }
    | undefined
  >;
}

// @public @deprecated
export const legacyPlugin: (
  name: string,
  createRouterImport: Promise<{
    default: LegacyCreateRouter<
      TransformedEnv<
        {
          cache: CacheService;
          config: RootConfigService;
          database: DatabaseService;
          discovery: DiscoveryService;
          logger: LoggerService;
          permissions: PermissionsService;
          scheduler: SchedulerService;
          reader: UrlReaderService;
        },
        {
          logger: (log: LoggerService) => Logger;
          cache: (cache: CacheService) => {
            getClient(options?: CacheServiceOptions | undefined): CacheService;
          };
        }
      > & {
        tokenManager: TokenManager;
        identity: LegacyIdentityService;
      }
    >;
  }>,
) => BackendFeature;

// @public @deprecated (undocumented)
export type LegacyRootDatabaseService = {
  forPlugin(pluginId: string): DatabaseService;
};

// @public @deprecated
export function loadBackendConfig(options: {
  logger: LoggerService;
  remote?: LoadConfigOptionsRemote;
  additionalConfigs?: AppConfig[];
  argv: string[];
  watch?: boolean;
}): Promise<Config>;

// @public @deprecated (undocumented)
export function loggerToWinstonLogger(
  logger: LoggerService,
  opts?: TransportStreamOptions,
): Logger;

// @public @deprecated
export function makeLegacyPlugin<
  TEnv extends Record<string, unknown>,
  TEnvTransforms extends {
    [key in keyof TEnv]?: (dep: TEnv[key]) => unknown;
  },
>(
  envMapping: {
    [key in keyof TEnv]: ServiceRef<TEnv[key]>;
  },
  envTransforms: TEnvTransforms,
): (
  name: string,
  createRouterImport: Promise<{
    default: LegacyCreateRouter<
      TransformedEnv<TEnv, TEnvTransforms> & {
        tokenManager: TokenManager;
        identity: LegacyIdentityService;
      }
    >;
  }>,
) => BackendFeature;

// @public @deprecated
export function notFoundHandler(): RequestHandler;

// @public @deprecated (undocumented)
export type PluginCacheManager = {
  getClient(options?: CacheServiceOptions): CacheService;
};

// @public @deprecated (undocumented)
export type PluginDatabaseManager = DatabaseService;

// @public @deprecated (undocumented)
export type PluginEndpointDiscovery = DiscoveryService;

// @public @deprecated
export interface PullOptions {
  // (undocumented)
  [key: string]: unknown;
  // (undocumented)
  authconfig?: {
    username?: string;
    password?: string;
    auth?: string;
    email?: string;
    serveraddress?: string;
    [key: string]: unknown;
  };
}

// @public @deprecated
export function redactWinstonLogLine(
  info: winston.Logform.TransformableInfo,
): winston.Logform.TransformableInfo;

// @public @deprecated
export function requestLoggingHandler(logger?: LoggerService): RequestHandler;

// @public @deprecated
export type RequestLoggingHandlerFactory = (
  logger?: LoggerService,
) => RequestHandler;

// @public @deprecated (undocumented)
export const resolvePackagePath: typeof resolvePackagePath_2;

// @public @deprecated (undocumented)
export const resolveSafeChildPath: typeof resolveSafeChildPath_2;

// @public @deprecated
export type RunContainerOptions = {
  imageName: string;
  command?: string | string[];
  args: string[];
  logStream?: Writable;
  mountDirs?: Record<string, string>;
  workingDir?: string;
  envVars?: Record<string, string>;
  pullImage?: boolean;
  defaultUser?: boolean;
  pullOptions?: PullOptions;
};

// @public @deprecated
export class ServerTokenManager implements TokenManager {
  // (undocumented)
  authenticate(token: string): Promise<void>;
  // (undocumented)
  static fromConfig(
    config: Config,
    options: ServerTokenManagerOptions,
  ): TokenManager;
  // (undocumented)
  getToken(): Promise<{
    token: string;
  }>;
  static noop(): TokenManager;
}

// @public @deprecated
export interface ServerTokenManagerOptions {
  allowDisabledTokenManager?: boolean;
  logger: LoggerService;
}

// @public @deprecated
export type ServiceBuilder = {
  loadConfig(config: Config): ServiceBuilder;
  setPort(port: number): ServiceBuilder;
  setHost(host: string): ServiceBuilder;
  setLogger(logger: LoggerService): ServiceBuilder;
  enableCors(options: cors.CorsOptions): ServiceBuilder;
  setHttpsSettings(settings: {
    certificate:
      | {
          key: string;
          cert: string;
        }
      | {
          hostname: string;
        };
  }): ServiceBuilder;
  addRouter(root: string, router: Router | RequestHandler): ServiceBuilder;
  setRequestLoggingHandler(
    requestLoggingHandler: RequestLoggingHandlerFactory,
  ): ServiceBuilder;
  setErrorHandler(errorHandler: ErrorRequestHandler): ServiceBuilder;
  disableDefaultErrorHandler(): ServiceBuilder;
  start(): Promise<Server>;
};

// @public @deprecated
export function setRootLogger(newLogger: winston.Logger): void;

// @public @deprecated
export type StaticAuthOptions = {
  username?: string;
  password?: string;
  token?: string;
  logger?: LoggerService;
};

// @public @deprecated
export type StatusCheck = () => Promise<any>;

// @public @deprecated
export function statusCheckHandler(
  options?: StatusCheckHandlerOptions,
): Promise<RequestHandler>;

// @public @deprecated
export interface StatusCheckHandlerOptions {
  statusCheck?: StatusCheck;
}

// @public @deprecated (undocumented)
export interface TokenManager {
  authenticate(token: string): Promise<void>;
  getToken(): Promise<{
    token: string;
  }>;
}

// @public @deprecated
export function useHotCleanup(
  _module: NodeModule,
  cancelEffect: () => void,
): void;

// @public @deprecated
export function useHotMemoize<T>(_module: NodeModule, valueFactory: () => T): T;
```
