## API Report File for "@backstage/backend-common"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="node" />
/// <reference types="webpack-env" />

import { AppConfig } from '@backstage/config';
import { AuthCallback } from 'isomorphic-git';
import { AuthService } from '@backstage/backend-plugin-api';
import { AwsCredentialsManager } from '@backstage/integration-aws-node';
import { AwsS3Integration } from '@backstage/integration';
import { AzureDevOpsCredentialsProvider } from '@backstage/integration';
import { AzureIntegration } from '@backstage/integration';
import { BackendFeature } from '@backstage/backend-plugin-api';
import { BitbucketCloudIntegration } from '@backstage/integration';
import { BitbucketIntegration } from '@backstage/integration';
import { BitbucketServerIntegration } from '@backstage/integration';
import { CacheService } from '@backstage/backend-plugin-api';
import { CacheServiceOptions } from '@backstage/backend-plugin-api';
import type { CacheServiceSetOptions } from '@backstage/backend-plugin-api';
import { Config } from '@backstage/config';
import cors from 'cors';
import { DiscoveryService } from '@backstage/backend-plugin-api';
import Docker from 'dockerode';
import { ErrorRequestHandler } from 'express';
import express from 'express';
import { GerritIntegration } from '@backstage/integration';
import { GiteaIntegration } from '@backstage/integration';
import { GithubCredentialsProvider } from '@backstage/integration';
import { GithubIntegration } from '@backstage/integration';
import { GitLabIntegration } from '@backstage/integration';
import { HarnessIntegration } from '@backstage/integration';
import { HostDiscovery as HostDiscovery_2 } from '@backstage/backend-app-api';
import { HttpAuthService } from '@backstage/backend-plugin-api';
import { IdentityService } from '@backstage/backend-plugin-api';
import { isChildPath as isChildPath_2 } from '@backstage/backend-plugin-api';
import { isDatabaseConflictError as isDatabaseConflictError_2 } from '@backstage/backend-plugin-api';
import { KubeConfig } from '@kubernetes/client-node';
import { LifecycleService } from '@backstage/backend-plugin-api';
import { LoadConfigOptionsRemote } from '@backstage/config-loader';
import { Logger } from 'winston';
import { LoggerService } from '@backstage/backend-plugin-api';
import { MergeResult } from 'isomorphic-git';
import { PermissionsService } from '@backstage/backend-plugin-api';
import { DatabaseService as PluginDatabaseManager } from '@backstage/backend-plugin-api';
import { PluginMetadataService } from '@backstage/backend-plugin-api';
import { PushResult } from 'isomorphic-git';
import { Readable } from 'stream';
import { ReadCommitResult } from 'isomorphic-git';
import type { ReadTreeOptions as ReadTreeOptions_2 } from '@backstage/backend-plugin-api';
import type { ReadTreeResponse as ReadTreeResponse_2 } from '@backstage/backend-plugin-api';
import type { ReadTreeResponseDirOptions as ReadTreeResponseDirOptions_2 } from '@backstage/backend-plugin-api';
import type { ReadTreeResponseFile as ReadTreeResponseFile_2 } from '@backstage/backend-plugin-api';
import type { ReadUrlOptions as ReadUrlOptions_2 } from '@backstage/backend-plugin-api';
import type { ReadUrlResponse as ReadUrlResponse_2 } from '@backstage/backend-plugin-api';
import { RequestHandler } from 'express';
import { resolvePackagePath as resolvePackagePath_2 } from '@backstage/backend-plugin-api';
import { resolveSafeChildPath as resolveSafeChildPath_2 } from '@backstage/backend-plugin-api';
import { RootConfigService } from '@backstage/backend-plugin-api';
import { Router } from 'express';
import { SchedulerService } from '@backstage/backend-plugin-api';
import type { SearchOptions as SearchOptions_2 } from '@backstage/backend-plugin-api';
import type { SearchResponse as SearchResponse_2 } from '@backstage/backend-plugin-api';
import type { SearchResponseFile as SearchResponseFile_2 } from '@backstage/backend-plugin-api';
import { Server } from 'http';
import { ServiceRef } from '@backstage/backend-plugin-api';
import { TokenManagerService as TokenManager } from '@backstage/backend-plugin-api';
import { TransportStreamOptions } from 'winston-transport';
import { UrlReaderReadTreeOptions } from '@backstage/backend-plugin-api';
import { UrlReaderReadTreeResponse } from '@backstage/backend-plugin-api';
import { UrlReaderReadUrlOptions } from '@backstage/backend-plugin-api';
import { UrlReaderReadUrlResponse } from '@backstage/backend-plugin-api';
import { UrlReaderSearchOptions } from '@backstage/backend-plugin-api';
import { UrlReaderSearchResponse } from '@backstage/backend-plugin-api';
import { UrlReaderService } from '@backstage/backend-plugin-api';
import { UserInfoService } from '@backstage/backend-plugin-api';
import { V1PodTemplateSpec } from '@kubernetes/client-node';
import * as winston from 'winston';
import { Writable } from 'stream';

// @public @deprecated
export type AuthCallbackOptions = {
  onAuth: AuthCallback;
  logger?: LoggerService;
};

// Warning: (ae-forgotten-export) The symbol "AwsS3UrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const AwsS3UrlReader: typeof AwsS3UrlReader_2;

// Warning: (ae-forgotten-export) The symbol "AzureUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const AzureUrlReader: typeof AzureUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "BitbucketCloudUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const BitbucketCloudUrlReader: typeof BitbucketCloudUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "BitbucketServerUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const BitbucketServerUrlReader: typeof BitbucketServerUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "BitbucketUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const BitbucketUrlReader: typeof BitbucketUrlReader_2;

// @public @deprecated (undocumented)
export type CacheClient = CacheService;

// @public @deprecated (undocumented)
export type CacheClientOptions = CacheServiceOptions;

// @public @deprecated (undocumented)
export type CacheClientSetOptions = CacheServiceSetOptions;

// @public
export class CacheManager {
  forPlugin(pluginId: string): {
    getClient(options?: CacheServiceOptions): CacheService;
  };
  static fromConfig(
    config: Config,
    options?: {
      logger?: LoggerService;
      onError?: (err: Error) => void;
    },
  ): CacheManager;
}

// @public
export type CacheManagerOptions = {
  logger?: LoggerService;
  onError?: (err: Error) => void;
};

// @public
export function cacheToPluginCacheManager(cache: CacheService): {
  getClient(options?: CacheServiceOptions): CacheService;
};

// @public @deprecated
export const coloredFormat: winston.Logform.Format;

// @public
export interface ContainerRunner {
  runContainer(opts: RunContainerOptions): Promise<void>;
}

// @public
export function createLegacyAuthAdapters<
  TOptions extends {
    auth?: AuthService;
    httpAuth?: HttpAuthService;
    userInfo?: UserInfoService;
    identity?: IdentityService;
    tokenManager?: TokenManager;
    discovery: PluginEndpointDiscovery;
  },
  TAdapters = (TOptions extends {
    auth?: AuthService;
  }
    ? {
        auth: AuthService;
      }
    : {}) &
    (TOptions extends {
      httpAuth?: HttpAuthService;
    }
      ? {
          httpAuth: HttpAuthService;
        }
      : {}) &
    (TOptions extends {
      userInfo?: UserInfoService;
    }
      ? {
          userInfo: UserInfoService;
        }
      : {}),
>(options: TOptions): TAdapters;

// @public @deprecated
export function createRootLogger(
  options?: winston.LoggerOptions,
  env?: NodeJS.ProcessEnv,
): winston.Logger;

// @public @deprecated
export function createServiceBuilder(_module: NodeModule): ServiceBuilder;

// @public
export function createStatusCheckRouter(options: {
  logger: LoggerService;
  path?: string;
  statusCheck?: StatusCheck;
}): Promise<express.Router>;

// @public
export class DatabaseManager implements LegacyRootDatabaseService {
  forPlugin(
    pluginId: string,
    deps?: {
      lifecycle: LifecycleService;
      pluginMetadata: PluginMetadataService;
    },
  ): PluginDatabaseManager;
  static fromConfig(
    config: Config,
    options?: DatabaseManagerOptions,
  ): DatabaseManager;
}

// @public
export type DatabaseManagerOptions = {
  migrations?: PluginDatabaseManager['migrations'];
  logger?: LoggerService;
};

// @public
export class DockerContainerRunner implements ContainerRunner {
  constructor(options: { dockerClient: Docker });
  // (undocumented)
  runContainer(options: RunContainerOptions): Promise<void>;
}

// @public
export function dropDatabase(
  dbConfig: Config,
  ...databaseNames: string[]
): Promise<void>;

// @public @deprecated
export function errorHandler(
  options?: ErrorHandlerOptions,
): ErrorRequestHandler;

// @public
export type ErrorHandlerOptions = {
  showStackTraces?: boolean;
  logger?: LoggerService;
  logClientErrors?: boolean;
};

// Warning: (ae-forgotten-export) The symbol "FetchUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const FetchUrlReader: typeof FetchUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "FromReadableArrayOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type FromReadableArrayOptions = FromReadableArrayOptions_2;

// Warning: (ae-forgotten-export) The symbol "GerritUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const GerritUrlReader: typeof GerritUrlReader_2;

// @public @deprecated
export function getRootLogger(): winston.Logger;

// @public @deprecated
export function getVoidLogger(): winston.Logger;

// @public @deprecated
export class Git {
  // (undocumented)
  add(options: { dir: string; filepath: string }): Promise<void>;
  // (undocumented)
  addRemote(options: {
    dir: string;
    remote: string;
    url: string;
    force?: boolean;
  }): Promise<void>;
  // (undocumented)
  branch(options: { dir: string; ref: string }): Promise<void>;
  // (undocumented)
  checkout(options: { dir: string; ref: string }): Promise<void>;
  clone(options: {
    url: string;
    dir: string;
    ref?: string;
    depth?: number;
    noCheckout?: boolean;
  }): Promise<void>;
  // (undocumented)
  commit(options: {
    dir: string;
    message: string;
    author: {
      name: string;
      email: string;
    };
    committer: {
      name: string;
      email: string;
    };
  }): Promise<string>;
  currentBranch(options: {
    dir: string;
    fullName?: boolean;
  }): Promise<string | undefined>;
  // (undocumented)
  deleteRemote(options: { dir: string; remote: string }): Promise<void>;
  fetch(options: {
    dir: string;
    remote?: string;
    tags?: boolean;
  }): Promise<void>;
  // (undocumented)
  static fromAuth: (options: StaticAuthOptions | AuthCallbackOptions) => Git;
  // (undocumented)
  init(options: { dir: string; defaultBranch?: string }): Promise<void>;
  log(options: { dir: string; ref?: string }): Promise<ReadCommitResult[]>;
  merge(options: {
    dir: string;
    theirs: string;
    ours?: string;
    author: {
      name: string;
      email: string;
    };
    committer: {
      name: string;
      email: string;
    };
  }): Promise<MergeResult>;
  // (undocumented)
  push(options: {
    dir: string;
    remote: string;
    remoteRef?: string;
    force?: boolean;
  }): Promise<PushResult>;
  readCommit(options: { dir: string; sha: string }): Promise<ReadCommitResult>;
  remove(options: { dir: string; filepath: string }): Promise<void>;
  resolveRef(options: { dir: string; ref: string }): Promise<string>;
}

// Warning: (ae-forgotten-export) The symbol "GiteaUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const GiteaUrlReader: typeof GiteaUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "GithubUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const GithubUrlReader: typeof GithubUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "GitlabUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const GitlabUrlReader: typeof GitlabUrlReader_2;

// Warning: (ae-forgotten-export) The symbol "HarnessUrlReader_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const HarnessUrlReader: typeof HarnessUrlReader_2;

// @public @deprecated
export const HostDiscovery: typeof HostDiscovery_2;

// @public @deprecated (undocumented)
export const isChildPath: typeof isChildPath_2;

// @public @deprecated (undocumented)
export const isDatabaseConflictError: typeof isDatabaseConflictError_2;

// @public
export class KubernetesContainerRunner implements ContainerRunner {
  constructor(options: KubernetesContainerRunnerOptions);
  // (undocumented)
  runContainer(options: RunContainerOptions): Promise<void>;
}

// @public
export type KubernetesContainerRunnerMountBase = {
  volumeName: string;
  basePath: string;
};

// @public
export type KubernetesContainerRunnerOptions = {
  kubeConfig: KubeConfig;
  name: string;
  namespace?: string;
  mountBase?: KubernetesContainerRunnerMountBase;
  podTemplate?: V1PodTemplateSpec;
  timeoutMs?: number;
};

// @public (undocumented)
export type LegacyCreateRouter<TEnv> = (deps: TEnv) => Promise<RequestHandler>;

// @public
export const legacyPlugin: (
  name: string,
  createRouterImport: Promise<{
    default: LegacyCreateRouter<
      TransformedEnv<
        {
          cache: CacheService;
          config: RootConfigService;
          database: PluginDatabaseManager;
          discovery: DiscoveryService;
          logger: LoggerService;
          permissions: PermissionsService;
          scheduler: SchedulerService;
          tokenManager: TokenManager;
          reader: UrlReaderService;
          identity: IdentityService;
        },
        {
          logger: (log: LoggerService) => Logger;
          cache: (cache: CacheService) => {
            getClient(options?: CacheServiceOptions | undefined): CacheService;
          };
        }
      >
    >;
  }>,
) => BackendFeature;

// @public
export type LegacyRootDatabaseService = {
  forPlugin(pluginId: string): PluginDatabaseManager;
};

// @public @deprecated
export function loadBackendConfig(options: {
  logger: LoggerService;
  remote?: LoadConfigOptionsRemote;
  additionalConfigs?: AppConfig[];
  argv: string[];
  watch?: boolean;
}): Promise<Config>;

// @public (undocumented)
export function loggerToWinstonLogger(
  logger: LoggerService,
  opts?: TransportStreamOptions,
): Logger;

// @public
export function makeLegacyPlugin<
  TEnv extends Record<string, unknown>,
  TEnvTransforms extends {
    [key in keyof TEnv]?: (dep: TEnv[key]) => unknown;
  },
>(
  envMapping: {
    [key in keyof TEnv]: ServiceRef<TEnv[key]>;
  },
  envTransforms: TEnvTransforms,
): (
  name: string,
  createRouterImport: Promise<{
    default: LegacyCreateRouter<TransformedEnv<TEnv, TEnvTransforms>>;
  }>,
) => BackendFeature;

// @public
export function notFoundHandler(): RequestHandler;

// @public (undocumented)
export interface PluginCacheManager {
  // (undocumented)
  getClient(options?: CacheServiceOptions): CacheService;
}

export { PluginDatabaseManager };

// @public @deprecated (undocumented)
export type PluginEndpointDiscovery = DiscoveryService;

// @public
export interface PullOptions {
  // (undocumented)
  [key: string]: unknown;
  // (undocumented)
  authconfig?: {
    username?: string;
    password?: string;
    auth?: string;
    email?: string;
    serveraddress?: string;
    [key: string]: unknown;
  };
}

// Warning: (ae-forgotten-export) The symbol "ReaderFactory_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type ReaderFactory = ReaderFactory_2;

// @public @deprecated (undocumented)
export type ReadTreeOptions = ReadTreeOptions_2;

// @public @deprecated (undocumented)
export type ReadTreeResponse = ReadTreeResponse_2;

// @public @deprecated (undocumented)
export type ReadTreeResponseDirOptions = ReadTreeResponseDirOptions_2;

// Warning: (ae-forgotten-export) The symbol "ReadTreeResponseFactory_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type ReadTreeResponseFactory = ReadTreeResponseFactory_2;

// Warning: (ae-forgotten-export) The symbol "ReadTreeResponseFactoryOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type ReadTreeResponseFactoryOptions = ReadTreeResponseFactoryOptions_2;

// @public @deprecated (undocumented)
export type ReadTreeResponseFile = ReadTreeResponseFile_2;

// @public @deprecated (undocumented)
export type ReadUrlOptions = ReadUrlOptions_2;

// @public @deprecated (undocumented)
export type ReadUrlResponse = ReadUrlResponse_2;

// Warning: (ae-forgotten-export) The symbol "ReadUrlResponseFactory_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const ReadUrlResponseFactory: typeof ReadUrlResponseFactory_2;

// Warning: (ae-forgotten-export) The symbol "ReadUrlResponseFactoryFromStreamOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type ReadUrlResponseFactoryFromStreamOptions =
  ReadUrlResponseFactoryFromStreamOptions_2;

// @public
export function redactWinstonLogLine(
  info: winston.Logform.TransformableInfo,
): winston.Logform.TransformableInfo;

// @public @deprecated
export function requestLoggingHandler(logger?: LoggerService): RequestHandler;

// @public
export type RequestLoggingHandlerFactory = (
  logger?: LoggerService,
) => RequestHandler;

// @public @deprecated (undocumented)
export const resolvePackagePath: typeof resolvePackagePath_2;

// @public @deprecated (undocumented)
export const resolveSafeChildPath: typeof resolveSafeChildPath_2;

// @public
export type RunContainerOptions = {
  imageName: string;
  command?: string | string[];
  args: string[];
  logStream?: Writable;
  mountDirs?: Record<string, string>;
  workingDir?: string;
  envVars?: Record<string, string>;
  pullImage?: boolean;
  defaultUser?: boolean;
  pullOptions?: PullOptions;
};

// @public @deprecated (undocumented)
export type SearchOptions = SearchOptions_2;

// @public @deprecated (undocumented)
export type SearchResponse = SearchResponse_2;

// @public @deprecated (undocumented)
export type SearchResponseFile = SearchResponseFile_2;

// @public
export class ServerTokenManager implements TokenManager {
  // (undocumented)
  authenticate(token: string): Promise<void>;
  // (undocumented)
  static fromConfig(
    config: Config,
    options: ServerTokenManagerOptions,
  ): TokenManager;
  // (undocumented)
  getToken(): Promise<{
    token: string;
  }>;
  static noop(): TokenManager;
}

// @public
export interface ServerTokenManagerOptions {
  allowDisabledTokenManager?: boolean;
  logger: LoggerService;
}

// @public
export type ServiceBuilder = {
  loadConfig(config: Config): ServiceBuilder;
  setPort(port: number): ServiceBuilder;
  setHost(host: string): ServiceBuilder;
  setLogger(logger: LoggerService): ServiceBuilder;
  enableCors(options: cors.CorsOptions): ServiceBuilder;
  setHttpsSettings(settings: {
    certificate:
      | {
          key: string;
          cert: string;
        }
      | {
          hostname: string;
        };
  }): ServiceBuilder;
  addRouter(root: string, router: Router | RequestHandler): ServiceBuilder;
  setRequestLoggingHandler(
    requestLoggingHandler: RequestLoggingHandlerFactory,
  ): ServiceBuilder;
  setErrorHandler(errorHandler: ErrorRequestHandler): ServiceBuilder;
  disableDefaultErrorHandler(): ServiceBuilder;
  start(): Promise<Server>;
};

// @public @deprecated
export function setRootLogger(newLogger: winston.Logger): void;

// @public @deprecated
export const SingleHostDiscovery: typeof HostDiscovery_2;

// @public @deprecated
export type StaticAuthOptions = {
  username?: string;
  password?: string;
  token?: string;
  logger?: LoggerService;
};

// @public
export type StatusCheck = () => Promise<any>;

// @public
export function statusCheckHandler(
  options?: StatusCheckHandlerOptions,
): Promise<RequestHandler>;

// @public
export interface StatusCheckHandlerOptions {
  statusCheck?: StatusCheck;
}

export { TokenManager };

// @public @deprecated (undocumented)
export type UrlReader = UrlReaderService;

// Warning: (ae-forgotten-export) The symbol "UrlReaderPredicateTuple_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type UrlReaderPredicateTuple = UrlReaderPredicateTuple_2;

// Warning: (ae-forgotten-export) The symbol "UrlReaders_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export const UrlReaders: typeof UrlReaders_2;

// Warning: (ae-forgotten-export) The symbol "UrlReadersOptions_2" needs to be exported by the entry point index.d.ts
//
// @public @deprecated (undocumented)
export type UrlReadersOptions = UrlReadersOptions_2;

// @public @deprecated
export function useHotCleanup(
  _module: NodeModule,
  cancelEffect: () => void,
): void;

// @public @deprecated
export function useHotMemoize<T>(_module: NodeModule, valueFactory: () => T): T;
```
