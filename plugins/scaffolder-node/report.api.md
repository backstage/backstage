## API Report File for "@backstage/plugin-scaffolder-node"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts
/// <reference types="node" />

import { BackstageCredentials } from '@backstage/backend-plugin-api';
import { JsonObject } from '@backstage/types';
import { JsonValue } from '@backstage/types';
import { Logger } from 'winston';
import { LoggerService } from '@backstage/backend-plugin-api';
import { Observable } from '@backstage/types';
import { Schema } from 'jsonschema';
import { ScmIntegrationRegistry } from '@backstage/integration';
import { ScmIntegrations } from '@backstage/integration';
import { SpawnOptionsWithoutStdio } from 'child_process';
import { TaskSpec } from '@backstage/plugin-scaffolder-common';
import { TemplateInfo } from '@backstage/plugin-scaffolder-common';
import { UrlReaderService } from '@backstage/backend-plugin-api';
import { UserEntity } from '@backstage/catalog-model';
import { Writable } from 'stream';
import { z } from 'zod';

// @public
export type ActionContext<
  TActionInput extends JsonObject,
  TActionOutput extends JsonObject = JsonObject,
> = {
  logger: Logger;
  logStream: Writable;
  secrets?: TaskSecrets;
  workspacePath: string;
  input: TActionInput;
  checkpoint<T extends JsonValue | void>(opts: {
    key: string;
    fn: () => Promise<T> | T;
  }): Promise<T>;
  output(
    name: keyof TActionOutput,
    value: TActionOutput[keyof TActionOutput],
  ): void;
  createTemporaryDirectory(): Promise<string>;
  getInitiatorCredentials(): Promise<BackstageCredentials>;
  task: {
    id: string;
  };
  templateInfo?: TemplateInfo;
  isDryRun?: boolean;
  user?: {
    entity?: UserEntity;
    ref?: string;
  };
  signal?: AbortSignal;
  each?: JsonObject;
};

// @public (undocumented)
export function addFiles(options: {
  dir: string;
  filepath: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger?: Logger | undefined;
}): Promise<void>;

// @public (undocumented)
export function cloneRepo(options: {
  url: string;
  dir: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger?: Logger | undefined;
  ref?: string | undefined;
  depth?: number | undefined;
  noCheckout?: boolean | undefined;
}): Promise<void>;

// @public (undocumented)
export function commitAndPushBranch(options: {
  dir: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger?: Logger | undefined;
  commitMessage: string;
  gitAuthorInfo?: {
    name?: string;
    email?: string;
  };
  branch?: string;
  remoteRef?: string;
  remote?: string;
}): Promise<{
  commitHash: string;
}>;

// @public (undocumented)
export function commitAndPushRepo(input: {
  dir: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger: Logger;
  commitMessage: string;
  gitAuthorInfo?: {
    name?: string;
    email?: string;
  };
  branch?: string;
  remoteRef?: string;
}): Promise<{
  commitHash: string;
}>;

// @public (undocumented)
export function createBranch(options: {
  dir: string;
  ref: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger?: Logger | undefined;
}): Promise<void>;

// @public (undocumented)
export type CreatedTemplateFilter<
  S extends TemplateFilterSchema | undefined = undefined,
  F extends S extends TemplateFilterSchema
    ? TemplateFilterFunction<S>
    : (
        arg: JsonValue,
        ...rest: JsonValue[]
      ) => JsonValue | undefined = S extends TemplateFilterSchema
    ? TemplateFilterFunction<S>
    : (arg: JsonValue, ...rest: JsonValue[]) => JsonValue | undefined,
> = {
  id: string;
  description?: string;
  examples?: TemplateFilterExample[];
  schema?: S;
  filter: F;
};

// @public (undocumented)
export type CreatedTemplateGlobal =
  | CreatedTemplateGlobalValue<any>
  | CreatedTemplateGlobalFunction<any, any>;

// @public (undocumented)
export type CreatedTemplateGlobalFunction<
  S extends TemplateGlobalFunctionSchema | undefined = undefined,
  F extends S extends TemplateGlobalFunctionSchema
    ? SchemaCompliantTemplateGlobalFunction<S>
    : (
        arg: JsonValue,
        ...rest: JsonValue[]
      ) => JsonValue = S extends TemplateGlobalFunctionSchema
    ? SchemaCompliantTemplateGlobalFunction<S>
    : (...args: JsonValue[]) => JsonValue,
> = {
  id: string;
  description?: string;
  examples?: TemplateGlobalFunctionExample[];
  schema?: S;
  fn: F;
};

// @public (undocumented)
export type CreatedTemplateGlobalValue<T extends JsonValue = JsonValue> = {
  id: string;
  value: T;
  description?: string;
};

// @public
export const createTemplateAction: <
  TInputParams extends JsonObject = JsonObject,
  TOutputParams extends JsonObject = JsonObject,
  TInputSchema extends z.ZodType<any, z.ZodTypeDef, any> | Schema = {},
  TOutputSchema extends z.ZodType<any, z.ZodTypeDef, any> | Schema = {},
  TActionInput extends JsonObject = TInputSchema extends z.ZodType<
    any,
    any,
    infer IReturn
  >
    ? IReturn
    : TInputParams,
  TActionOutput extends JsonObject = TOutputSchema extends z.ZodType<
    any,
    any,
    infer IReturn_1
  >
    ? IReturn_1
    : TOutputParams,
>(
  action: TemplateActionOptions<
    TActionInput,
    TActionOutput,
    TInputSchema,
    TOutputSchema
  >,
) => TemplateAction<TActionInput, TActionOutput>;

// @public
export const createTemplateFilter: <TF extends CreatedTemplateFilter<any, any>>(
  filter: TF,
) => TF;

// @public
export const createTemplateGlobal: <
  T extends
    | CreatedTemplateGlobalValue<any>
    | CreatedTemplateGlobalFunction<any, any>,
>(
  t: T,
) => T;

// @public
export function deserializeDirectoryContents(
  targetPath: string,
  files: SerializedFile[],
): Promise<void>;

// @public
export function executeShellCommand(
  options: ExecuteShellCommandOptions,
): Promise<void>;

// @public
export type ExecuteShellCommandOptions = {
  command: string;
  args: string[];
  options?: SpawnOptionsWithoutStdio;
  logger?: LoggerService;
  logStream?: Writable;
};

// @public
export function fetchContents(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
  baseUrl?: string;
  fetchUrl?: string;
  outputPath: string;
  token?: string;
}): Promise<void>;

// @public
export function fetchFile(options: {
  reader: UrlReaderService;
  integrations: ScmIntegrations;
  baseUrl?: string;
  fetchUrl?: string;
  outputPath: string;
  token?: string;
}): Promise<void>;

// @public (undocumented)
export const getRepoSourceDirectory: (
  workspacePath: string,
  sourcePath: string | undefined,
) => string;

// @public (undocumented)
export function initRepoAndPush(input: {
  dir: string;
  remoteUrl: string;
  auth:
    | {
        username: string;
        password: string;
      }
    | {
        token: string;
      };
  logger: Logger;
  defaultBranch?: string;
  commitMessage?: string;
  gitAuthorInfo?: {
    name?: string;
    email?: string;
  };
}): Promise<{
  commitHash: string;
}>;

// @public (undocumented)
export const parseRepoUrl: (
  repoUrl: string,
  integrations: ScmIntegrationRegistry,
) => {
  repo: string;
  host: string;
  owner?: string | undefined;
  organization?: string | undefined;
  workspace?: string | undefined;
  project?: string | undefined;
};

// @public (undocumented)
export type SchemaCompliantTemplateGlobalFunction<
  T extends TemplateGlobalFunctionSchema,
> = z.ZodFunction<
  z.ZodTuple<
    [
      ...(T['arguments'] extends (zImpl: typeof z) => z.ZodTuple<infer Items>
        ? Items
        : [ReturnType<NonNullable<T['arguments']>>]),
    ]
  >,
  T['output'] extends (zImpl: typeof z) => z.ZodType
    ? ReturnType<T['output']>
    : z.ZodUnknown
>;

// @public (undocumented)
export interface SerializedFile {
  // (undocumented)
  content: Buffer;
  // (undocumented)
  executable?: boolean;
  // (undocumented)
  path: string;
  // (undocumented)
  symlink?: boolean;
}

// @public (undocumented)
export function serializeDirectoryContents(
  sourcePath: string,
  options?: {
    gitignore?: boolean;
    globPatterns?: string[];
  },
): Promise<SerializedFile[]>;

// @public
export type SerializedTask = {
  id: string;
  spec: TaskSpec;
  status: TaskStatus;
  createdAt: string;
  lastHeartbeatAt?: string;
  createdBy?: string;
  secrets?: TaskSecrets;
  state?: JsonObject;
};

// @public
export type SerializedTaskEvent = {
  id: number;
  isTaskRecoverable?: boolean;
  taskId: string;
  body: JsonObject;
  type: TaskEventType;
  createdAt: string;
};

// @public
export interface TaskBroker {
  // (undocumented)
  cancel?(taskId: string): Promise<void>;
  // (undocumented)
  claim(): Promise<TaskContext>;
  // (undocumented)
  dispatch(
    options: TaskBrokerDispatchOptions,
  ): Promise<TaskBrokerDispatchResult>;
  // (undocumented)
  event$(options: { taskId: string; after: number | undefined }): Observable<{
    events: SerializedTaskEvent[];
  }>;
  // (undocumented)
  get(taskId: string): Promise<SerializedTask>;
  // (undocumented)
  list?(options?: {
    filters?: {
      createdBy?: string | string[];
      status?: TaskStatus | TaskStatus[];
    };
    pagination?: {
      limit?: number;
      offset?: number;
    };
    order?: {
      order: 'asc' | 'desc';
      field: string;
    }[];
  }): Promise<{
    tasks: SerializedTask[];
    totalTasks?: number;
  }>;
  // @deprecated (undocumented)
  list?(options: { createdBy?: string; status?: TaskStatus }): Promise<{
    tasks: SerializedTask[];
    totalTasks?: number;
  }>;
  // (undocumented)
  recoverTasks?(): Promise<void>;
  // (undocumented)
  retry?(taskId: string): Promise<void>;
  // (undocumented)
  vacuumTasks(options: { timeoutS: number }): Promise<void>;
}

// @public
export type TaskBrokerDispatchOptions = {
  spec: TaskSpec;
  secrets?: TaskSecrets;
  createdBy?: string;
};

// @public
export type TaskBrokerDispatchResult = {
  taskId: string;
};

// @public
export type TaskCompletionState = 'failed' | 'completed';

// @public
export interface TaskContext {
  // (undocumented)
  cancelSignal: AbortSignal;
  // (undocumented)
  cleanWorkspace?(): Promise<void>;
  // (undocumented)
  complete(result: TaskCompletionState, metadata?: JsonObject): Promise<void>;
  // (undocumented)
  createdBy?: string;
  // (undocumented)
  done: boolean;
  // (undocumented)
  emitLog(message: string, logMetadata?: JsonObject): Promise<void>;
  // (undocumented)
  getInitiatorCredentials(): Promise<BackstageCredentials>;
  // (undocumented)
  getTaskState?(): Promise<
    | {
        state?: JsonObject;
      }
    | undefined
  >;
  // (undocumented)
  getWorkspaceName(): Promise<string>;
  // (undocumented)
  isDryRun?: boolean;
  // (undocumented)
  rehydrateWorkspace?(options: {
    taskId: string;
    targetPath: string;
  }): Promise<void>;
  // (undocumented)
  secrets?: TaskSecrets;
  // (undocumented)
  serializeWorkspace?(options: { path: string }): Promise<void>;
  // (undocumented)
  spec: TaskSpec;
  // (undocumented)
  taskId?: string;
  // (undocumented)
  updateCheckpoint?(
    options:
      | {
          key: string;
          status: 'success';
          value: JsonValue;
        }
      | {
          key: string;
          status: 'failed';
          reason: string;
        },
  ): Promise<void>;
}

// @public
export type TaskEventType = 'completion' | 'log' | 'cancelled' | 'recovered';

// @public
export type TaskSecrets = Record<string, string> & {
  backstageToken?: string;
};

// @public
export type TaskStatus =
  | 'cancelled'
  | 'completed'
  | 'failed'
  | 'open'
  | 'processing';

// @public (undocumented)
export type TemplateAction<
  TActionInput extends JsonObject = JsonObject,
  TActionOutput extends JsonObject = JsonObject,
> = {
  id: string;
  description?: string;
  examples?: {
    description: string;
    example: string;
  }[];
  supportsDryRun?: boolean;
  schema?: {
    input?: Schema;
    output?: Schema;
  };
  handler: (ctx: ActionContext<TActionInput, TActionOutput>) => Promise<void>;
};

// @public (undocumented)
export type TemplateActionOptions<
  TActionInput extends JsonObject = {},
  TActionOutput extends JsonObject = {},
  TInputSchema extends Schema | z.ZodType = {},
  TOutputSchema extends Schema | z.ZodType = {},
> = {
  id: string;
  description?: string;
  examples?: TemplateExample[];
  supportsDryRun?: boolean;
  schema?: {
    input?: TInputSchema;
    output?: TOutputSchema;
  };
  handler: (ctx: ActionContext<TActionInput, TActionOutput>) => Promise<void>;
};

// @public (undocumented)
export type TemplateExample = {
  description: string;
  example: string;
};

// @public (undocumented)
export type TemplateFilter = (
  arg: JsonValue,
  ...rest: JsonValue[]
) => JsonValue | undefined;

// @public (undocumented)
export type TemplateFilterExample = {
  description?: string;
  example: string;
  notes?: string;
};

// @public (undocumented)
export type TemplateFilterFunction<T extends TemplateFilterSchema> =
  z.ZodFunction<
    z.ZodTuple<
      [
        T['input'] extends (zImpl: typeof z) => z.ZodType
          ? ReturnType<T['input']>
          : z.ZodAny,
        ...(T['arguments'] extends (zImpl: typeof z) => z.ZodTuple<infer Items>
          ? Items
          : [ReturnType<NonNullable<T['arguments']>>]),
      ]
    >,
    T['output'] extends (zImpl: typeof z) => z.ZodType
      ? ReturnType<T['output']>
      : z.ZodUnknown
  >;

// @public (undocumented)
export type TemplateFilterSchema = {
  [K in 'input' | 'arguments' | 'output']?: (zImpl: typeof z) => z.ZodType;
};

// @public (undocumented)
export type TemplateGlobal = TemplateGlobalFunction | JsonValue;

// @public (undocumented)
export type TemplateGlobalFunction<
  Args extends JsonValue[] = JsonValue[],
  Output extends JsonValue | undefined = JsonValue | undefined,
> = (...args: Args) => Output;

// @public (undocumented)
export type TemplateGlobalFunctionExample = {
  description?: string;
  example: string;
  notes?: string;
};

// @public (undocumented)
export type TemplateGlobalFunctionSchema = {
  [K in 'arguments' | 'output']?: (zImpl: typeof z) => z.ZodType;
};

// Warnings were encountered during analysis:
//
// src/actions/createTemplateAction.d.ts:6:1 - (ae-undocumented) Missing documentation for "TemplateExample".
// src/actions/createTemplateAction.d.ts:11:1 - (ae-undocumented) Missing documentation for "TemplateActionOptions".
// src/actions/gitHelpers.d.ts:5:1 - (ae-undocumented) Missing documentation for "initRepoAndPush".
// src/actions/gitHelpers.d.ts:27:1 - (ae-undocumented) Missing documentation for "commitAndPushRepo".
// src/actions/gitHelpers.d.ts:49:1 - (ae-undocumented) Missing documentation for "cloneRepo".
// src/actions/gitHelpers.d.ts:66:1 - (ae-undocumented) Missing documentation for "createBranch".
// src/actions/gitHelpers.d.ts:80:1 - (ae-undocumented) Missing documentation for "addFiles".
// src/actions/gitHelpers.d.ts:94:1 - (ae-undocumented) Missing documentation for "commitAndPushBranch".
// src/actions/types.d.ts:60:1 - (ae-undocumented) Missing documentation for "TemplateAction".
// src/actions/util.d.ts:5:22 - (ae-undocumented) Missing documentation for "getRepoSourceDirectory".
// src/actions/util.d.ts:9:22 - (ae-undocumented) Missing documentation for "parseRepoUrl".
// src/files/serializeDirectoryContents.d.ts:6:1 - (ae-undocumented) Missing documentation for "serializeDirectoryContents".
// src/files/types.d.ts:6:1 - (ae-undocumented) Missing documentation for "SerializedFile".
// src/files/types.d.ts:7:5 - (ae-undocumented) Missing documentation for "path".
// src/files/types.d.ts:8:5 - (ae-undocumented) Missing documentation for "content".
// src/files/types.d.ts:9:5 - (ae-undocumented) Missing documentation for "executable".
// src/files/types.d.ts:10:5 - (ae-undocumented) Missing documentation for "symlink".
// src/filters/types.d.ts:4:1 - (ae-undocumented) Missing documentation for "TemplateFilter".
// src/filters/types.d.ts:6:1 - (ae-undocumented) Missing documentation for "TemplateFilterSchema".
// src/filters/types.d.ts:10:1 - (ae-undocumented) Missing documentation for "TemplateFilterExample".
// src/filters/types.d.ts:16:1 - (ae-undocumented) Missing documentation for "TemplateFilterFunction".
// src/filters/types.d.ts:21:1 - (ae-undocumented) Missing documentation for "CreatedTemplateFilter".
// src/globals/types.d.ts:4:1 - (ae-undocumented) Missing documentation for "TemplateGlobalFunction".
// src/globals/types.d.ts:6:1 - (ae-undocumented) Missing documentation for "TemplateGlobal".
// src/globals/types.d.ts:8:1 - (ae-undocumented) Missing documentation for "CreatedTemplateGlobalValue".
// src/globals/types.d.ts:14:1 - (ae-undocumented) Missing documentation for "TemplateGlobalFunctionSchema".
// src/globals/types.d.ts:18:1 - (ae-undocumented) Missing documentation for "SchemaCompliantTemplateGlobalFunction".
// src/globals/types.d.ts:22:1 - (ae-undocumented) Missing documentation for "TemplateGlobalFunctionExample".
// src/globals/types.d.ts:28:1 - (ae-undocumented) Missing documentation for "CreatedTemplateGlobalFunction".
// src/globals/types.d.ts:36:1 - (ae-undocumented) Missing documentation for "CreatedTemplateGlobal".
// src/tasks/types.d.ts:83:5 - (ae-undocumented) Missing documentation for "cancelSignal".
// src/tasks/types.d.ts:84:5 - (ae-undocumented) Missing documentation for "spec".
// src/tasks/types.d.ts:85:5 - (ae-undocumented) Missing documentation for "secrets".
// src/tasks/types.d.ts:86:5 - (ae-undocumented) Missing documentation for "createdBy".
// src/tasks/types.d.ts:87:5 - (ae-undocumented) Missing documentation for "done".
// src/tasks/types.d.ts:88:5 - (ae-undocumented) Missing documentation for "isDryRun".
// src/tasks/types.d.ts:89:5 - (ae-undocumented) Missing documentation for "complete".
// src/tasks/types.d.ts:90:5 - (ae-undocumented) Missing documentation for "emitLog".
// src/tasks/types.d.ts:91:5 - (ae-undocumented) Missing documentation for "getTaskState".
// src/tasks/types.d.ts:94:5 - (ae-undocumented) Missing documentation for "updateCheckpoint".
// src/tasks/types.d.ts:103:5 - (ae-undocumented) Missing documentation for "serializeWorkspace".
// src/tasks/types.d.ts:106:5 - (ae-undocumented) Missing documentation for "cleanWorkspace".
// src/tasks/types.d.ts:107:5 - (ae-undocumented) Missing documentation for "rehydrateWorkspace".
// src/tasks/types.d.ts:111:5 - (ae-undocumented) Missing documentation for "getWorkspaceName".
// src/tasks/types.d.ts:112:5 - (ae-undocumented) Missing documentation for "getInitiatorCredentials".
// src/tasks/types.d.ts:120:5 - (ae-undocumented) Missing documentation for "cancel".
// src/tasks/types.d.ts:121:5 - (ae-undocumented) Missing documentation for "retry".
// src/tasks/types.d.ts:122:5 - (ae-undocumented) Missing documentation for "claim".
// src/tasks/types.d.ts:123:5 - (ae-undocumented) Missing documentation for "recoverTasks".
// src/tasks/types.d.ts:124:5 - (ae-undocumented) Missing documentation for "dispatch".
// src/tasks/types.d.ts:125:5 - (ae-undocumented) Missing documentation for "vacuumTasks".
// src/tasks/types.d.ts:128:5 - (ae-undocumented) Missing documentation for "event$".
// src/tasks/types.d.ts:134:5 - (ae-undocumented) Missing documentation for "get".
// src/tasks/types.d.ts:135:5 - (ae-undocumented) Missing documentation for "list".
// src/tasks/types.d.ts:155:5 - (ae-undocumented) Missing documentation for "list".
```
