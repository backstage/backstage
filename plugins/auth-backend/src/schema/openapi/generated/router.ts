/*
 * Copyright 2025 The Backstage Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// ******************************************************************
// * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. *
// ******************************************************************
import { createValidatedOpenApiRouterFromGeneratedEndpointMap } from '@backstage/backend-openapi-utils';
import { EndpointMap } from './apis';

export const spec = {
  openapi: '3.0.3',
  info: {
    title: 'auth',
    description: 'API for the Backstage authentication provider backend',
    version: '1.0.0',
    license: {
      name: 'Apache-2.0',
      url: 'http://www.apache.org/licenses/LICENSE-2.0.html',
    },
    contact: {},
  },
  servers: [
    {
      url: '/',
    },
  ],
  paths: {
    '/{providerId}/start': {
      get: {
        summary: 'Start authentication flow',
        description:
          'Initiates the authentication flow for the specified provider',
        operationId: 'startAuth',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description:
              'The ID of the authentication provider (e.g., google, github, okta)',
            allowReserved: true,
            schema: {
              type: 'string',
              example: 'google',
            },
          },
          {
            name: 'env',
            in: 'query',
            required: false,
            description: 'Optional environment identifier',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'scope',
            in: 'query',
            required: false,
            description: 'Optional OAuth scope(s) to request',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'origin',
            in: 'query',
            required: false,
            description: 'Origin URL for CORS validation',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        responses: {
          '302': {
            description: "Redirect to the provider's authorization endpoint",
          },
          '400': {
            description: 'Invalid request or misconfigured provider',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found or not registered',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
    },
    '/{providerId}/handler/frame': {
      get: {
        summary: 'Handle authentication callback (GET)',
        description:
          'Handles the OAuth callback from the authentication provider',
        operationId: 'handleFrameCallbackGet',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description: 'The ID of the authentication provider',
            allowReserved: true,
            schema: {
              type: 'string',
              example: 'google',
            },
          },
          {
            name: 'code',
            in: 'query',
            required: false,
            description: 'Authorization code from OAuth provider',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'state',
            in: 'query',
            required: false,
            description: 'State parameter for CSRF protection',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'error',
            in: 'query',
            required: false,
            description: 'Error code if authentication failed',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'error_description',
            in: 'query',
            required: false,
            description: 'Human-readable error description',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        responses: {
          '200': {
            description:
              'Authentication successful, returns HTML frame with token',
            content: {
              'text/html': {
                schema: {
                  type: 'string',
                },
              },
            },
          },
          '400': {
            description: 'Invalid callback parameters',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '401': {
            description: 'Authentication failed',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
      post: {
        summary: 'Handle authentication callback (POST)',
        description:
          'Handles POST-based authentication callbacks from the provider',
        operationId: 'handleFrameCallbackPost',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description: 'The ID of the authentication provider',
            schema: {
              type: 'string',
              example: 'google',
            },
            allowReserved: true,
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        requestBody: {
          required: false,
          content: {
            'application/x-www-form-urlencoded': {
              schema: {
                type: 'object',
                properties: {
                  code: {
                    type: 'string',
                    description: 'Authorization code from OAuth provider',
                  },
                  state: {
                    type: 'string',
                    description: 'State parameter for CSRF protection',
                  },
                  error: {
                    type: 'string',
                    description: 'Error code if authentication failed',
                  },
                  error_description: {
                    type: 'string',
                    description: 'Human-readable error description',
                  },
                },
              },
            },
          },
        },
        responses: {
          '200': {
            description:
              'Authentication successful, returns HTML frame with token',
            content: {
              'text/html': {
                schema: {
                  type: 'string',
                },
              },
            },
          },
          '400': {
            description: 'Invalid callback parameters',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '401': {
            description: 'Authentication failed',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
    },
    '/{providerId}/logout': {
      post: {
        summary: 'Logout from provider',
        description:
          'Logs out the user from the authentication provider. This endpoint is optional\nand only available if the provider implements logout functionality.\n',
        operationId: 'logout',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description: 'The ID of the authentication provider',
            allowReserved: true,
            schema: {
              type: 'string',
              example: 'google',
            },
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        requestBody: {
          required: false,
          content: {
            'application/json': {
              schema: {
                type: 'object',
                properties: {
                  token: {
                    type: 'string',
                    description: 'The token to invalidate',
                  },
                },
              },
            },
          },
        },
        responses: {
          '200': {
            description: 'Logout successful',
            content: {
              'application/json': {
                schema: {
                  type: 'object',
                  properties: {
                    status: {
                      type: 'string',
                      example: 'ok',
                    },
                  },
                },
              },
            },
          },
          '400': {
            description: 'Invalid request',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found or logout not supported',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
    },
    '/{providerId}/refresh': {
      get: {
        summary: 'Refresh authentication token (GET)',
        description:
          'Refreshes the authentication token for the user. This endpoint is optional\nand only available if the provider implements token refresh functionality.\n',
        operationId: 'refreshTokenGet',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description: 'The ID of the authentication provider',
            allowReserved: true,
            schema: {
              type: 'string',
              example: 'google',
            },
          },
          {
            name: 'scope',
            in: 'query',
            required: false,
            description: 'Optional OAuth scope(s) to request',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'origin',
            in: 'query',
            required: false,
            description: 'Origin URL for CORS validation',
            allowReserved: true,
            schema: {
              type: 'string',
            },
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        responses: {
          '200': {
            description: 'Token refresh successful',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/RefreshResponse',
                },
              },
            },
          },
          '400': {
            description: 'Invalid request',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '401': {
            description: 'Token refresh failed or unauthorized',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found or refresh not supported',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
      post: {
        summary: 'Refresh authentication token (POST)',
        description:
          'Refreshes the authentication token for the user. This endpoint is optional\nand only available if the provider implements token refresh functionality.\n',
        operationId: 'refreshTokenPost',
        parameters: [
          {
            name: 'providerId',
            in: 'path',
            required: true,
            description: 'The ID of the authentication provider',
            allowReserved: true,
            schema: {
              type: 'string',
              example: 'google',
            },
          },
          {
            name: 'unknown',
            in: 'query',
            required: false,
            style: 'form',
            explode: true,
            allowReserved: true,
            schema: {
              type: 'object',
              additionalProperties: {},
            },
          },
        ],
        requestBody: {
          required: false,
          content: {
            'application/json': {
              schema: {
                type: 'object',
                properties: {
                  scope: {
                    type: 'string',
                    description: 'Optional OAuth scope(s) to request',
                  },
                  refreshToken: {
                    type: 'string',
                    description: 'Refresh token to use',
                  },
                },
              },
            },
          },
        },
        responses: {
          '200': {
            description: 'Token refresh successful',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/RefreshResponse',
                },
              },
            },
          },
          '400': {
            description: 'Invalid request',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '401': {
            description: 'Token refresh failed or unauthorized',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
          '404': {
            description: 'Provider not found or refresh not supported',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
    },
  },
  components: {
    securitySchemes: {
      BearerAuth: {
        type: 'http',
        scheme: 'bearer',
        bearerFormat: 'JWT',
        description: 'Backstage identity token',
      },
    },
    schemas: {
      RefreshResponse: {
        type: 'object',
        properties: {
          backstageIdentity: {
            type: 'object',
            description: 'The Backstage identity of the authenticated user',
            properties: {
              token: {
                type: 'string',
                description: 'The Backstage identity token',
              },
              identity: {
                type: 'object',
                properties: {
                  type: {
                    type: 'string',
                    example: 'user',
                  },
                  userEntityRef: {
                    type: 'string',
                    example: 'user:default/john.doe',
                  },
                  ownershipEntityRefs: {
                    type: 'array',
                    items: {
                      type: 'string',
                    },
                  },
                },
              },
            },
          },
          providerInfo: {
            type: 'object',
            description: 'Provider-specific information',
            properties: {
              accessToken: {
                type: 'string',
                description: 'OAuth access token',
              },
              expiresInSeconds: {
                type: 'number',
                description: 'Token expiry time in seconds',
              },
              scope: {
                type: 'string',
                description: 'Granted OAuth scopes',
              },
              idToken: {
                type: 'string',
                description: 'OpenID Connect ID token',
              },
            },
            additionalProperties: {},
          },
        },
        required: ['backstageIdentity'],
      },
      Error: {
        type: 'object',
        properties: {
          error: {
            type: 'object',
            properties: {
              message: {
                type: 'string',
                description: 'Error message',
              },
              name: {
                type: 'string',
                description: 'Error name',
              },
            },
            required: ['message'],
          },
        },
      },
    },
  },
} as const;
export const createOpenApiRouter = async (
  options?: Parameters<
    typeof createValidatedOpenApiRouterFromGeneratedEndpointMap
  >['1'],
) =>
  createValidatedOpenApiRouterFromGeneratedEndpointMap<EndpointMap>(
    spec,
    options,
  );
