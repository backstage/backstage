/*
 * Copyright 2025 The Backstage Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// ******************************************************************
// * THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY. *
// ******************************************************************
import { createValidatedOpenApiRouterFromGeneratedEndpointMap } from '@backstage/backend-openapi-utils';
import { EndpointMap } from './apis';

export const spec = {
  openapi: '3.0.0',
  info: {
    title: 'permission',
    description: 'API for the Backstage permission system backend',
    version: '1.0.0',
    license: {
      name: 'Apache 2.0',
      url: 'https://www.apache.org/licenses/LICENSE-2.0',
    },
  },
  servers: [
    {
      url: '/',
    },
  ],
  paths: {
    '/health': {
      get: {
        summary: 'Health check endpoint',
        description:
          'Returns the health status of the permission backend service',
        operationId: 'getHealth',
        responses: {
          '200': {
            description: 'Service is healthy',
            content: {
              'application/json': {
                schema: {
                  type: 'object',
                  properties: {
                    status: {
                      type: 'string',
                      example: 'ok',
                    },
                  },
                  required: ['status'],
                },
              },
            },
          },
        },
      },
    },
    '/authorize': {
      post: {
        summary: 'Authorize permission requests',
        description:
          'Evaluates a batch of permission requests and returns authorization decisions',
        operationId: 'authorize',
        requestBody: {
          required: true,
          content: {
            'application/json': {
              schema: {
                $ref: '#/components/schemas/EvaluatePermissionRequestBatch',
              },
            },
          },
        },
        responses: {
          '200': {
            description:
              'Authorization decisions for the requested permissions',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/EvaluatePermissionResponseBatch',
                },
              },
            },
          },
          '400': {
            description: 'Invalid request body or missing required fields',
            content: {
              'application/json': {
                schema: {
                  $ref: '#/components/schemas/Error',
                },
              },
            },
          },
        },
      },
    },
  },
  components: {
    schemas: {
      PermissionAttributes: {
        type: 'object',
        properties: {
          action: {
            type: 'string',
            enum: ['create', 'read', 'update', 'delete'],
            description: 'The action being performed',
          },
        },
        additionalProperties: false,
      },
      BasicPermission: {
        type: 'object',
        properties: {
          type: {
            type: 'string',
            enum: ['basic'],
          },
          name: {
            type: 'string',
            description: 'The permission name',
          },
          attributes: {
            $ref: '#/components/schemas/PermissionAttributes',
          },
        },
        required: ['type', 'name', 'attributes'],
        additionalProperties: false,
      },
      ResourcePermission: {
        type: 'object',
        properties: {
          type: {
            type: 'string',
            enum: ['resource'],
          },
          name: {
            type: 'string',
            description: 'The permission name',
          },
          attributes: {
            $ref: '#/components/schemas/PermissionAttributes',
          },
          resourceType: {
            type: 'string',
            description: 'The type of resource this permission applies to',
          },
        },
        required: ['type', 'name', 'attributes', 'resourceType'],
        additionalProperties: false,
      },
      BasicPermissionRequest: {
        type: 'object',
        properties: {
          id: {
            type: 'string',
            description: 'Unique identifier for this request',
          },
          permission: {
            $ref: '#/components/schemas/BasicPermission',
          },
          resourceRef: {
            type: 'string',
            nullable: true,
            description:
              'Optional resource reference (should not be set for basic permissions)',
          },
        },
        required: ['id', 'permission'],
        additionalProperties: false,
      },
      ResourcePermissionRequest: {
        type: 'object',
        properties: {
          id: {
            type: 'string',
            description: 'Unique identifier for this request',
          },
          permission: {
            $ref: '#/components/schemas/ResourcePermission',
          },
          resourceRef: {
            description: 'Reference to the resource(s) being accessed',
            oneOf: [
              {
                type: 'string',
              },
              {
                type: 'array',
                items: {
                  type: 'string',
                },
                minItems: 1,
              },
            ],
          },
        },
        required: ['id', 'permission'],
        additionalProperties: false,
      },
      EvaluatePermissionRequest: {
        oneOf: [
          {
            $ref: '#/components/schemas/BasicPermissionRequest',
          },
          {
            $ref: '#/components/schemas/ResourcePermissionRequest',
          },
        ],
      },
      EvaluatePermissionRequestBatch: {
        type: 'object',
        properties: {
          items: {
            type: 'array',
            items: {
              $ref: '#/components/schemas/EvaluatePermissionRequest',
            },
            description: 'Array of permission evaluation requests',
          },
        },
        required: ['items'],
        additionalProperties: false,
      },
      AuthorizeResult: {
        type: 'string',
        enum: ['ALLOW', 'DENY', 'CONDITIONAL'],
        description: 'The authorization decision result',
      },
      EvaluatePermissionResponse: {
        type: 'object',
        properties: {
          id: {
            type: 'string',
            description: 'The request ID this response corresponds to',
          },
          result: {
            $ref: '#/components/schemas/AuthorizeResult',
          },
        },
        required: ['id', 'result'],
        additionalProperties: {},
      },
      EvaluatePermissionResponseBatch: {
        type: 'object',
        properties: {
          items: {
            type: 'array',
            items: {
              $ref: '#/components/schemas/EvaluatePermissionResponse',
            },
            description: 'Array of permission evaluation responses',
          },
        },
        required: ['items'],
        additionalProperties: false,
      },
      Error: {
        type: 'object',
        properties: {
          error: {
            type: 'object',
            properties: {
              message: {
                type: 'string',
                description: 'Error message',
              },
              name: {
                type: 'string',
                description: 'Error name',
              },
            },
            required: ['message'],
          },
        },
      },
    },
  },
} as const;
export const createOpenApiRouter = async (
  options?: Parameters<
    typeof createValidatedOpenApiRouterFromGeneratedEndpointMap
  >['1'],
) =>
  createValidatedOpenApiRouterFromGeneratedEndpointMap<EndpointMap>(
    spec,
    options,
  );
