"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["33466"],{132649(e,t,n){n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>r});var a=n(245590),o=n(474848),l=n(28453);let i={id:"collators",title:"Collators",description:"Indexing you Backstage content with Collators"},c,s={},r=[{value:"Catalog",id:"catalog",level:2},{value:"Configuring the Catalog Collator",id:"configuring-the-catalog-collator",level:3},{value:"Scheduling",id:"scheduling",level:4},{value:"Filtering",id:"filtering",level:4},{value:"TechDocs",id:"techdocs",level:2},{value:"Configuring the TechDocs Collator",id:"configuring-the-techdocs-collator",level:3},{value:"Filtering through the catalog collator",id:"filtering-through-the-catalog-collator",level:3},{value:"Community Collators",id:"community-collators",level:2},{value:"Custom Collators",id:"custom-collators",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(t.p,{children:["Backstage includes 2 ",(0,o.jsx)(t.a,{href:"/docs/next/features/search/concepts#collators",children:"collators"})," out of the box for the ",(0,o.jsx)(t.a,{href:"#catalog",children:"Catalog"})," and ",(0,o.jsx)(t.a,{href:"#techdocs",children:"TechDocs"}),". There's also some from the ",(0,o.jsx)(t.a,{href:"#community-collators",children:"Backstage Community"})," too!"]}),"\n",(0,o.jsx)(t.h2,{id:"catalog",children:"Catalog"}),"\n",(0,o.jsx)(t.p,{children:"The Catalog collator will index all the Entities in your Catalog. It is installed by default but if you need to add it manually here's how."}),"\n",(0,o.jsx)(t.p,{children:"First we add the plugin into your backend app:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",metastring:'title="From your Backstage root directory"',children:"yarn --cwd packages/backend add @backstage/plugin-search-backend-module-catalog\n"})}),"\n",(0,o.jsx)(t.p,{children:"Then add the following line:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/index.ts"',children:"const backend = createBackend();\n\n// Other plugins...\n\n// search plugin\nbackend.add(import('@backstage/plugin-search-backend'));\n\n/* highlight-add-start */\nbackend.add(import('@backstage/plugin-search-backend-module-catalog'));\n/* highlight-add-end */\n\nbackend.start();\n"})}),"\n",(0,o.jsx)(t.h3,{id:"configuring-the-catalog-collator",children:"Configuring the Catalog Collator"}),"\n",(0,o.jsx)(t.p,{children:"The following sections outlines the available configurations for this collator."}),"\n",(0,o.jsx)(t.h4,{id:"scheduling",children:"Scheduling"}),"\n",(0,o.jsx)(t.p,{children:"The default schedule for the Catalog Collator is to run every 10 minutes, you can provide your own schedule by adding it to your config:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="app-config.yaml',children:'search:\n  collators:\n    catalog:\n      schedule: # same options as in SchedulerServiceTaskScheduleDefinition\n        # supports cron, ISO duration, "human duration" as used in code\n        initialDelay: { seconds: 90 }\n        # supports cron, ISO duration, "human duration" as used in code\n        frequency: { hours: 6 }\n        # supports ISO duration, "human duration" as used in code\n        timeout: { minutes: 3 }\n'})}),"\n",(0,o.jsx)(t.h4,{id:"filtering",children:"Filtering"}),"\n",(0,o.jsxs)(t.p,{children:["You may wish to collate specific subsets of entities in your Catalog, this can be accomplished using the ",(0,o.jsx)(t.code,{children:"filter"})," configuration option. Here's a basic example:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title"app-config.yaml"',children:"search:\n  collators:\n    catalog:\n      filter:\n        kind: ['component', 'api']\n        spec.lifecycle: production\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The above example will only collate entities that are ",(0,o.jsx)(t.code,{children:"kind"})," equal to ",(0,o.jsx)(t.code,{children:"component"})," or ",(0,o.jsx)(t.code,{children:"api"})," AND have a ",(0,o.jsx)(t.code,{children:"spec.lifecycle"})," set to ",(0,o.jsx)(t.code,{children:"production"})]}),"\n",(0,o.jsx)(t.p,{children:"You can also apply a more advanced filter like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title"app-config.yaml"',children:"search:\n  collators:\n    catalog:\n      filter:\n        - kind: ['API']\n          spec.type: openapi\n        - kind: ['Component']\n          spec.lifecycle: experimental\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now with this example it will collate all entities that are ",(0,o.jsx)(t.code,{children:"kind"})," equal to ",(0,o.jsx)(t.code,{children:"api"})," with a ",(0,o.jsx)(t.code,{children:"spec.type"})," equal to ",(0,o.jsx)(t.code,{children:"openapi"})," OR all entities that are ",(0,o.jsx)(t.code,{children:"kind"})," equal to ",(0,o.jsx)(t.code,{children:"component"})," AND have a ",(0,o.jsx)(t.code,{children:"spec.lifecycle"})," set to ",(0,o.jsx)(t.code,{children:"experimental"})]}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.p,{children:["The filter configuration is implemented using the ",(0,o.jsx)(t.code,{children:"EntityFilterQuery"})," syntax. The ",(0,o.jsxs)(t.a,{href:"https://backstage.io/api/stable/types/_backstage_catalog-client.index.EntityFilterQuery.html",children:["reference documentation on ",(0,o.jsx)(t.code,{children:"EntityFilterQuery"})]})," provides more details."]})}),"\n",(0,o.jsx)(t.h2,{id:"techdocs",children:"TechDocs"}),"\n",(0,o.jsx)(t.p,{children:"The TechDocs collator will index all the TechDocs in your Catalog. It is installed by default but if you need to add it manually here's how."}),"\n",(0,o.jsx)(t.p,{children:"First we add the plugin into your backend app:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",metastring:'title="From your Backstage root directory"',children:"yarn --cwd packages/backend add @backstage/plugin-search-backend-module-techdocs\n"})}),"\n",(0,o.jsx)(t.p,{children:"Then add the following line:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-ts",metastring:'title="packages/backend/src/index.ts"',children:"const backend = createBackend();\n\n// Other plugins...\n\n// search plugin\nbackend.add(import('@backstage/plugin-search-backend'));\n\n/* highlight-add-start */\nbackend.add(import('@backstage/plugin-search-backend-module-techdocs'));\n/* highlight-add-end */\n\nbackend.start();\n"})}),"\n",(0,o.jsx)(t.h3,{id:"configuring-the-techdocs-collator",children:"Configuring the TechDocs Collator"}),"\n",(0,o.jsx)(t.p,{children:"The default schedule for the TechDocs Collator is to run every 10 minutes, you can provide your own schedule by adding it to your config:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="app-config.yaml',children:'search:\n  collators:\n    techdocs:\n      schedule: # same options as in SchedulerServiceTaskScheduleDefinition\n        # supports cron, ISO duration, "human duration" as used in code\n        initialDelay: { seconds: 90 }\n        # supports cron, ISO duration, "human duration" as used in code\n        frequency: { hours: 6 }\n        # supports ISO duration, "human duration" as used in code\n        timeout: { minutes: 3 }\n'})}),"\n",(0,o.jsx)(t.h3,{id:"filtering-through-the-catalog-collator",children:"Filtering through the catalog collator"}),"\n",(0,o.jsxs)(t.p,{children:["The TechDocs collator by default filters through catalog entities where the annotation ",(0,o.jsx)(t.code,{children:"metadata.annotations.backstage.io/techdocs-ref"})," exists. If you wish to further filter out entities, there are two ways to do so through the ",(0,o.jsx)(t.code,{children:"techDocsCollatorEntityFilterExtensionPoint"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"export const exampleCustomCatalogFiltering = createBackendModule({\n  pluginId: 'search',\n  moduleId: 'search-techdocs-collator-entity-filter',\n  register(reg) {\n    reg.registerInit({\n      deps: {\n        customCollatorFilter: techDocsCollatorEntityFilterExtensionPoint,\n      },\n      async init({ customCollatorFilter }) {\n        /* filtering by catalog params */\n        customCollatorFilter.setCustomCatalogApiFilters([\n          { kind: ['API', 'Component', ...] },\n          { metadata: ['...more filters'] },\n        ]);\n\n        /* filtering by a custom function */\n        customCollatorFilter.setEntityFilterFunction((entities: Entity[]) =>\n          entities.filter(\n            entity => entity.metadata?.annotations?.abc === 'xyz',\n          ),\n        );\n      },\n    });\n  },\n});\n"})}),"\n",(0,o.jsx)(t.h2,{id:"community-collators",children:"Community Collators"}),"\n",(0,o.jsx)(t.p,{children:"Here are some of the known Search Collators available in from the Backstage Community:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/backstage/community-plugins/tree/main/workspaces/explore/plugins/search-backend-module-explore",children:(0,o.jsx)(t.code,{children:"@backstage-community/plugin-search-backend-module-explore"})}),": will index content from the ",(0,o.jsx)(t.a,{href:"https://github.com/backstage/community-plugins/tree/main/workspaces/explore/plugins/explore",children:"Explore plugin"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/backstage/backstage/tree/master/plugins/search-backend-module-stack-overflow-collator",children:(0,o.jsx)(t.code,{children:"@backstage/plugin-search-backend-module-stack-overflow-collator"})}),": will index content from Stack Overflow."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://github.com/backstage/community-plugins/tree/main/workspaces/adr/plugins/search-backend-module-adr",children:(0,o.jsx)(t.code,{children:"@backstage-community/search-backend-module-adr"})}),": will index content from the ",(0,o.jsx)(t.a,{href:"https://github.com/backstage/community-plugins/tree/main/workspaces/adr/plugins/adr",children:"ADR plugin"}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"custom-collators",children:"Custom Collators"}),"\n",(0,o.jsxs)(t.p,{children:["To create your own collators/decorators modules, please use the ",(0,o.jsx)(t.a,{href:"https://github.com/backstage/backstage/blob/d7f955f300893f50c4882ea8f5c09aa42dfaacfd/plugins/search-backend-module-catalog/src/alpha.ts#L49",children:"searchModuleCatalogCollator"})," as an example, we recommend that modules are separated by plugin packages (e.g. ",(0,o.jsx)(t.code,{children:"search-backend-module-<plugin-id>"}),"). You can also find the available search engines and collator/decorator modules documentation in the Alpha API reports."]})]})}function h(e={}){let{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453(e,t,n){n.d(t,{R:()=>i,x:()=>c});var a=n(296540);let o={},l=a.createContext(o);function i(e){let t=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(l.Provider,{value:t},e.children)}},245590(e){e.exports=JSON.parse('{"id":"features/search/collators","title":"Collators","description":"Indexing you Backstage content with Collators","source":"@site/../docs/features/search/collators.md","sourceDirName":"features/search","slug":"/features/search/collators","permalink":"/docs/next/features/search/collators","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/features/search/collators.md","tags":[],"version":"current","frontMatter":{"id":"collators","title":"Collators","description":"Indexing you Backstage content with Collators"},"sidebar":"docs","previous":{"title":"Search Engines","permalink":"/docs/next/features/search/search-engines"},"next":{"title":"How-To guides","permalink":"/docs/next/features/search/how-to-guides"}}')}}]);