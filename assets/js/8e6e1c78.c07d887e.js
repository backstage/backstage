"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["94717"],{630985(e,o,t){t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>a});var n=t(646100),s=t(474848),c=t(28453);let r={id:"root-lifecycle",title:"Root Lifecycle Service",sidebar_label:"Root Lifecycle",description:"Documentation for the Root Lifecycle service"},i,l={},a=[{value:"Configure the service",id:"configure-the-service",level:2}];function d(e){let o={code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.p,{children:"This service is the same as the lifecycle service, but should only be used by the root services. This is also where the implementation for the actual lifecycle hooks are collected and executed, so if you want to override the implementation of how those are processed, you should override this service."}),"\n",(0,s.jsx)(o.h2,{id:"configure-the-service",children:"Configure the service"}),"\n",(0,s.jsx)(o.p,{children:"The following example shows how to override the default implementation of the lifecycle service with something that listens on different process events to the original."}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-ts",children:"class MyCustomLifecycleService implements RootLifecycleService {\n  constructor(private readonly logger: LoggerService) {}\n\n  #isCalled = false;\n  #shutdownTasks: Array<{\n    hook: LifecycleServiceShutdownHook;\n    options?: LifecycleServiceShutdownOptions;\n  }> = [];\n\n  addShutdownHook(\n    hook: LifecycleServiceShutdownHook,\n    options?: LifecycleServiceShutdownOptions,\n  ): void {\n    this.#shutdownTasks.push({ hook, options });\n  }\n\n  async shutdown(): Promise<void> {\n    if (this.#isCalled) {\n      return;\n    }\n    this.#isCalled = true;\n\n    this.logger.info(`Running ${this.#shutdownTasks.length} shutdown tasks...`);\n    await Promise.all(\n      this.#shutdownTasks.map(async ({ hook, options }) => {\n        const logger = options?.logger ?? this.logger;\n        try {\n          await hook();\n          logger.info(`Shutdown hook succeeded`);\n        } catch (error) {\n          logger.error(`Shutdown hook failed, ${error}`);\n        }\n      }),\n    );\n  }\n}\n\nconst backend = createBackend();\n\nbackend.add(\n  createServiceFactory({\n    service: coreServices.rootLifecycle,\n    deps: {\n      logger: coreServices.rootLogger,\n    },\n    async factory({ logger }) {\n      return new MyCustomLifecycleService(logger);\n    },\n  }),\n);\n"})})]})}function h(e={}){let{wrapper:o}={...(0,c.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453(e,o,t){t.d(o,{R:()=>r,x:()=>i});var n=t(296540);let s={},c=n.createContext(s);function r(e){let o=n.useContext(c);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(c.Provider,{value:o},e.children)}},646100(e){e.exports=JSON.parse('{"id":"backend-system/core-services/root-lifecycle","title":"Root Lifecycle Service","description":"Documentation for the Root Lifecycle service","source":"@site/versioned_docs/version-stable/backend-system/core-services/root-lifecycle.md","sourceDirName":"backend-system/core-services","slug":"/backend-system/core-services/root-lifecycle","permalink":"/docs/backend-system/core-services/root-lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/backend-system/core-services/root-lifecycle.md","tags":[],"version":"stable","frontMatter":{"id":"root-lifecycle","title":"Root Lifecycle Service","sidebar_label":"Root Lifecycle","description":"Documentation for the Root Lifecycle service"},"sidebar":"docs","previous":{"title":"Root Instance Metadata","permalink":"/docs/backend-system/core-services/root-instance-metadata"},"next":{"title":"Root Logger","permalink":"/docs/backend-system/core-services/root-logger"}}')}}]);