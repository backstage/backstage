"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["90620"],{749601(e,s,t){t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var r=t(77723),i=t(474848),n=t(28453);let o={id:"permissions",title:"Permissions Service",sidebar_label:"Permissions",description:"Documentation for the Permissions service"},c,a={},p=[{value:"Using the service",id:"using-the-service",level:2}];function m(e){let s={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s.p,{children:["This service allows your plugins to ask ",(0,i.jsx)(s.a,{href:"https://backstage.io/docs/permissions/overview",children:"the permissions framework"})," for authorization of user actions."]}),"\n",(0,i.jsx)(s.h2,{id:"using-the-service",children:"Using the service"}),"\n",(0,i.jsxs)(s.p,{children:["The following example shows how to get the permissions service in your ",(0,i.jsx)(s.code,{children:"example"})," backend to check to see if the user is allowed to perform a certain action with a custom permission rule."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"import {\n  coreServices,\n  createBackendPlugin,\n} from '@backstage/backend-plugin-api';\nimport { NotAllowedError } from '@backstage/errors';\nimport { AuthorizeResult } from '@backstage/plugin-permission-common';\nimport Router from 'express-promise-router';\n\nexport default createBackendPlugin({\n  pluginId: 'example',\n  register(env) {\n    env.registerInit({\n      deps: {\n        permissions: coreServices.permissions,\n        httpRouter: coreServices.httpRouter,\n        httpAuth: coreServices.httpAuth,\n      },\n      async init({ permissions, httpRouter, httpAuth }) {\n        const endpoints = Router();\n        endpoints.get('/test-me', (request, response) => {\n          // Ask the permissions framework what the decision is for the given\n          // permission, for the principal that made the original request. The\n          // `httpAuth` service helps us extract those credentials. We authorize\n          // a single permission here, so the result will be an array with one\n          // element accordingly.\n          const permissionResponse = await permissions.authorize(\n            [{ permission: myCustomPermission }],\n            { credentials: await httpAuth.credentials(request) },\n          );\n\n          if (permissionResponse[0].result !== AuthorizeResult.ALLOW) {\n            throw new NotAllowedError(\n              'You are not permitted to perform this action',\n            );\n          }\n\n          // TODO: Actual code goes here\n        });\n\n        httpRouter.use(endpoints);\n      },\n    });\n  },\n});\n"})})]})}function l(e={}){let{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(m,{...e})}):m(e)}},28453(e,s,t){t.d(s,{R:()=>o,x:()=>c});var r=t(296540);let i={},n=r.createContext(i);function o(e){let s=r.useContext(n);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(n.Provider,{value:s},e.children)}},77723(e){e.exports=JSON.parse('{"id":"backend-system/core-services/permissions","title":"Permissions Service","description":"Documentation for the Permissions service","source":"@site/../docs/backend-system/core-services/permissions.md","sourceDirName":"backend-system/core-services","slug":"/backend-system/core-services/permissions","permalink":"/docs/next/backend-system/core-services/permissions","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/backend-system/core-services/permissions.md","tags":[],"version":"current","frontMatter":{"id":"permissions","title":"Permissions Service","sidebar_label":"Permissions","description":"Documentation for the Permissions service"},"sidebar":"docs","previous":{"title":"Logger","permalink":"/docs/next/backend-system/core-services/logger"},"next":{"title":"Permissions Registry","permalink":"/docs/next/backend-system/core-services/permissions-registry"}}')}}]);