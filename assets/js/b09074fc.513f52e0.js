"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["55943"],{21273(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var i=t(340978),s=t(474848),a=t(28453);let r={id:"software-catalog-api",title:"API",description:"The Software Catalog API"},l,o={},d=[{value:"Overview",id:"overview",level:2},{value:"Entities",id:"entities",level:2},{value:"<code>GET /entities/by-query</code>",id:"get-entitiesby-query",level:3},{value:"Filtering",id:"filtering",level:4},{value:"Full text filtering",id:"full-text-filtering",level:4},{value:"Field selection",id:"field-selection",level:4},{value:"Ordering",id:"ordering",level:4},{value:"Pagination",id:"pagination",level:4},{value:"<code>GET /entities</code>",id:"get-entities",level:3},{value:"Filtering",id:"filtering-1",level:4},{value:"Field selection",id:"field-selection-1",level:4},{value:"Ordering",id:"ordering-1",level:3},{value:"Pagination",id:"pagination-1",level:4},{value:"<code>GET /entities/by-uid/&lt;uid&gt;</code>",id:"get-entitiesby-uiduid",level:3},{value:"<code>DELETE /entities/by-uid/&lt;uid&gt;</code>",id:"delete-entitiesby-uiduid",level:3},{value:"<code>GET /entities/by-name/&lt;kind&gt;/&lt;namespace&gt;/&lt;name&gt;</code>",id:"get-entitiesby-namekindnamespacename",level:3},{value:"<code>GET /entities/by-name/{kind}/{namespace}/{name}/ancestry</code>",id:"get-entitiesby-namekindnamespacenameancestry",level:3},{value:"<code>POST /entities/by-refs</code>",id:"post-entitiesby-refs",level:3},{value:"<code>POST /refresh</code>",id:"post-refresh",level:3},{value:"<code>POST /validate-entity</code>",id:"post-validate-entity",level:3},{value:"Locations",id:"locations",level:2},{value:"<code>GET /locations</code>",id:"get-locations",level:3},{value:"<code>GET /locations/{id}</code>",id:"get-locationsid",level:3},{value:"<code>GET /locations/by-entity/{kind}/{namespace}/{name}</code>",id:"get-locationsby-entitykindnamespacename",level:3},{value:"<code>GET /entity-facets?facet=&lt;string&gt;&amp;facet=&lt;string&gt;&amp;filter=&lt;string&gt;&amp;filter=&lt;string&gt;</code>",id:"get-entity-facetsfacetstringfacetstringfilterstringfilterstring",level:3},{value:"<code>POST /locations</code>",id:"post-locations",level:3},{value:"<code>POST /analyze-location</code>",id:"post-analyze-location",level:3},{value:"<code>DELETE /locations/{id}</code>",id:"delete-locationsid",level:3},{value:"Other",id:"other",level:2}];function c(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The software catalog backend has a JSON based REST API, which can be leveraged\nby external systems. This page describes its shape and features. The OpenAPI spec\nfor this API can be found ",(0,s.jsx)(n.a,{href:"https://github.com/backstage/backstage/blob/master/plugins/catalog-backend/src/schema/openapi.yaml",children:"here"}),".\nA UI visualizing the OpenAPI endpoints including the ability to try them out in the browser can be found ",(0,s.jsx)(n.a,{href:"https://www.postman.com/backstage-io/workspace/catalog-api/overview",children:"here"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The API surface consists of a few distinct groups of functionality. Each has a\ndedicated section below."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," This page only describes some of the most commonly used parts of the\nAPI, and is a work in progress."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["All of the URL paths in this article are assumed to be on top of some base URL\npointing at your catalog installation. For example, if the path given in a\nsection below is ",(0,s.jsx)(n.code,{children:"/entities"}),", and the catalog is located at\n",(0,s.jsx)(n.code,{children:"http://localhost:7007/api/catalog"})," during local development, the full URL would\nbe ",(0,s.jsx)(n.code,{children:"http://localhost:7007/api/catalog/entities"}),". The actual URL may vary from\none organization to the other, especially in production, but is commonly your\n",(0,s.jsx)(n.code,{children:"backend.baseUrl"})," in your app config, plus ",(0,s.jsx)(n.code,{children:"/api/catalog"})," at the end."]}),"\n",(0,s.jsxs)(n.p,{children:["Some or all of the endpoints may accept or require an ",(0,s.jsx)(n.code,{children:"Authorization"})," header\nwith a ",(0,s.jsx)(n.code,{children:"Bearer"})," token, which should then be the Backstage token returned by the\n",(0,s.jsx)(n.a,{href:"https://backstage.io/api/stable/variables/_backstage_core-plugin-api.index.identityApiRef.html",children:(0,s.jsx)(n.code,{children:"identity API"})}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"entities",children:"Entities"}),"\n",(0,s.jsxs)(n.p,{children:["These are the endpoints that deal with reading of entities directly. What it\nexposes are final entities - i.e. the output of all processing and the stitching\nprocess, not the raw originally ingested entity data. See\n",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/life-of-an-entity",children:"The Life of an Entity"})," for more details about this process and\ndistinction."]}),"\n",(0,s.jsx)(n.h3,{id:"get-entitiesby-query",children:(0,s.jsx)(n.code,{children:"GET /entities/by-query"})}),"\n",(0,s.jsx)(n.p,{children:"Query entities. Supports the following query parameters, described in the section below:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#filtering",children:(0,s.jsx)(n.code,{children:"filter"})}),", for selecting only a subset of all entities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#field-selection",children:(0,s.jsx)(n.code,{children:"fields"})}),", for selecting only parts of the full data\nstructure of each entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"limit"})," for limiting the number of entities returned (20 is the default)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#ordering",children:(0,s.jsx)(n.code,{children:"orderField"})}),", for deciding the order of the entities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#full-text-filtering",children:(0,s.jsx)(n.code,{children:"fullTextFilter"})}),", for filtering the entities by text"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#pagination",children:(0,s.jsx)(n.code,{children:"cursor"})}),", for retrieving the next or previous batch of entities"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The return type is JSON, on the following form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "items": [{ "kind": "Component", "metadata": { "name": "foo" } }],\n  "totalItems": 4,\n  "pageInfo": {\n    "nextCursor": "a-cursor",\n    "prevCursor": "another-cursor"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"filtering",children:"Filtering"}),"\n",(0,s.jsx)(n.p,{children:"You can pass in one or more filter sets that get matched against each entity.\nEach filter set is a number of conditions that all have to match for the\ncondition to be true (conditions effectively have an AND between them). At least\none filter set has to be true for the entity to be part of the result set\n(filter sets effectively have an OR between them)."}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"/entities/by-query?filter=kind=user,metadata.namespace=default&filter=kind=group,spec.type\n\n  Return entities that match\n\n    Filter set 1:\n      Condition 1: kind = user\n                   AND\n      Condition 2: metadata.namespace = default\n\n    OR\n\n    Filter set 2:\n      Condition 1: kind = group\n                   AND\n      Condition 2: spec.type exists\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each condition is either on the form ",(0,s.jsx)(n.code,{children:"<key>"}),", or on the form ",(0,s.jsx)(n.code,{children:"<key>=<value>"}),".\nThe first form asserts on the existence of a certain key (with any value), and\nthe second asserts that the key exists and has a certain value. All checks are\nalways case ",(0,s.jsx)(n.em,{children:"insensitive"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"In all cases, the key is a simplified JSON path in a given piece of entity data.\nEach part of the path is a key of an object, and the traversal also descends\nthrough arrays. There are two special forms:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Array items that are simple value types (such as strings) match on a key-value\npair where the key is the item as a string, and the value is the string ",(0,s.jsx)(n.code,{children:"true"})]}),"\n",(0,s.jsxs)(n.li,{children:["Relations can be matched on a ",(0,s.jsx)(n.code,{children:"relations.<type>=<targetRef>"})," form"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Let's look at a simplified example to illustrate the concept:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "a": {\n    "b": ["c", { "d": 1 }],\n    "e": 7\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This would match any one of the following conditions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.c"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.c=true"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.d"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.d=1"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.e"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.e=7"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Some more real world usable examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all orphaned entities:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?filter=metadata.annotations.backstage.io/orphan=true"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all users and groups:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?filter=kind=user&filter=kind=group"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all service components:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?filter=kind=component,spec.type=service"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Return all entities with the ",(0,s.jsx)(n.code,{children:"java"})," tag:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?filter=metadata.tags.java"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Return all users who are members of the ",(0,s.jsx)(n.code,{children:"ops"})," group (note that the full\n",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/references",children:"reference"})," of the group is used):"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?filter=kind=user,relations.memberof=group:default/ops"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"full-text-filtering",children:"Full text filtering"}),"\n",(0,s.jsx)(n.p,{children:"TODO"}),"\n",(0,s.jsx)(n.h4,{id:"field-selection",children:"Field selection"}),"\n",(0,s.jsxs)(n.p,{children:["By default the full entities are returned, but you can pass in a ",(0,s.jsx)(n.code,{children:"fields"})," query\nparameter which selects what parts of the entity data to retain. This makes the\nresponse smaller and faster to transfer, and may allow the catalog to perform\nmore efficient queries."]}),"\n",(0,s.jsxs)(n.p,{children:["The query parameter value is a comma separated list of simplified JSON paths\nlike above. Each path corresponds to the key of either a value, or of a subtree\nroot that you want to keep in the output. The rest is pruned away. For example,\nspecifying ",(0,s.jsx)(n.code,{children:"?fields=metadata.name,metadata.annotations,spec"})," retains only the\n",(0,s.jsx)(n.code,{children:"name"})," and ",(0,s.jsx)(n.code,{children:"annotations"})," fields of the ",(0,s.jsx)(n.code,{children:"metadata"})," of each entity (it'll be an\nobject with at most two keys), keeps the entire ",(0,s.jsx)(n.code,{children:"spec"})," unchanged, and cuts out\nall other roots such as ",(0,s.jsx)(n.code,{children:"relations"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Some more real world usable examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return only enough data to form the full ref of each entity:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?fields=kind,metadata.namespace,metadata.name"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ordering",children:"Ordering"}),"\n",(0,s.jsxs)(n.p,{children:["By default the entities are returned ordered by their internal ",(0,s.jsx)(n.code,{children:"uid"}),". You can\ncustomize the ",(0,s.jsx)(n.code,{children:"orderField"})," query parameters to affect that ordering."]}),"\n",(0,s.jsx)(n.p,{children:"For example, to return entities by their name:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities/by-query?orderField=metadata.name,asc"})}),"\n",(0,s.jsxs)(n.p,{children:["Each parameter can be followed by ",(0,s.jsx)(n.code,{children:"asc"})," for ascending lexicographical order or\n",(0,s.jsx)(n.code,{children:"desc"})," for descending (reverse) lexicographical order."]}),"\n",(0,s.jsx)(n.h4,{id:"pagination",children:"Pagination"}),"\n",(0,s.jsxs)(n.p,{children:["You may pass the ",(0,s.jsx)(n.code,{children:"cursor"})," query parameters to perform cursor based pagination\nthrough the set of entities. The value of ",(0,s.jsx)(n.code,{children:"cursor"})," will be returned in the response, under the ",(0,s.jsx)(n.code,{children:"pageInfo"})," property:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'  "pageInfo": {\n    "nextCursor": "a-cursor",\n    "prevCursor": "another-cursor"\n  }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"nextCursor"})," exists, it can be used to retrieve the next batch of entities. Following the same approach,\nif ",(0,s.jsx)(n.code,{children:"prevCursor"})," exists, it can be used to retrieve the previous batch of entities."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#filtering",children:(0,s.jsx)(n.code,{children:"filter"})}),", for selecting only a subset of all entities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#field-selection",children:(0,s.jsx)(n.code,{children:"fields"})}),", for selecting only parts of the full data\nstructure of each entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"limit"})," for limiting the number of entities returned (20 is the default)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#ordering",children:(0,s.jsx)(n.code,{children:"orderField"})}),", for deciding the order of the entities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fullTextFilter"}),"\n",(0,s.jsx)(n.strong,{children:"NOTE"}),": [",(0,s.jsx)(n.code,{children:"filter"}),", ",(0,s.jsx)(n.code,{children:"orderField"}),", ",(0,s.jsx)(n.code,{children:"fullTextFilter"}),"] and ",(0,s.jsx)(n.code,{children:"cursor"})," are mutually exclusive. This means that,\nit isn't possible to change any of [",(0,s.jsx)(n.code,{children:"filter"}),", ",(0,s.jsx)(n.code,{children:"orderField"}),", ",(0,s.jsx)(n.code,{children:"fullTextFilter"}),"] when passing ",(0,s.jsx)(n.code,{children:"cursor"})," as query parameters,\nas changing any of these properties will affect pagination. If any of ",(0,s.jsx)(n.code,{children:"filter"}),", ",(0,s.jsx)(n.code,{children:"orderField"}),", ",(0,s.jsx)(n.code,{children:"fullTextFilter"})," is specified together with ",(0,s.jsx)(n.code,{children:"cursor"}),", only the latter is taken into consideration."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"get-entities",children:(0,s.jsx)(n.code,{children:"GET /entities"})}),"\n",(0,s.jsx)(n.p,{children:"Lists entities."}),"\n",(0,s.jsx)(n.admonition,{title:"Note",type:"note",children:(0,s.jsxs)(n.p,{children:["This endpoint is deprecated in favor of ",(0,s.jsx)(n.code,{children:"GET /entities/by-query"}),", which provides a more efficient implementation and cursor based pagination."]})}),"\n",(0,s.jsx)(n.p,{children:"The endpoint supports the following query parameters, described in sections\nbelow:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#filtering",children:(0,s.jsx)(n.code,{children:"filter"})}),", for selecting only a subset of all entities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#field-selection",children:(0,s.jsx)(n.code,{children:"fields"})}),", for selecting only parts of the full data\nstructure of each entity"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.a,{href:"#pagination",children:[(0,s.jsx)(n.code,{children:"offset"}),", ",(0,s.jsx)(n.code,{children:"limit"}),", and ",(0,s.jsx)(n.code,{children:"after"})]})," for pagination"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The return type is JSON, as an array of ",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/descriptor-format",children:(0,s.jsx)(n.code,{children:"Entity"})}),"."]}),"\n",(0,s.jsx)(n.h4,{id:"filtering-1",children:"Filtering"}),"\n",(0,s.jsx)(n.p,{children:"You can pass in one or more filter sets that get matched against each entity.\nEach filter set is a number of conditions that all have to match for the\ncondition to be true (conditions effectively have an AND between them). At least\none filter set has to be true for the entity to be part of the result set\n(filter sets effectively have an OR between them)."}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"/entities?filter=kind=user,metadata.namespace=default&filter=kind=group,spec.type\n\n  Return entities that match\n\n    Filter set 1:\n      Condition 1: kind = user\n                   AND\n      Condition 2: metadata.namespace = default\n\n    OR\n\n    Filter set 2:\n      Condition 1: kind = group\n                   AND\n      Condition 2: spec.type exists\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each condition is either on the form ",(0,s.jsx)(n.code,{children:"<key>"}),", or on the form ",(0,s.jsx)(n.code,{children:"<key>=<value>"}),".\nThe first form asserts on the existence of a certain key (with any value), and\nthe second asserts that the key exists and has a certain value. All checks are\nalways case ",(0,s.jsx)(n.em,{children:"insensitive"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"In all cases, the key is a simplified JSON path in a given piece of entity data.\nEach part of the path is a key of an object, and the traversal also descends\nthrough arrays. There are two special forms:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Array items that are simple value types (such as strings) match on a key-value\npair where the key is the item as a string, and the value is the string ",(0,s.jsx)(n.code,{children:"true"})]}),"\n",(0,s.jsxs)(n.li,{children:["Relations can be matched on a ",(0,s.jsx)(n.code,{children:"relations.<type>=<targetRef>"})," form"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Let's look at a simplified example to illustrate the concept:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "a": {\n    "b": ["c", { "d": 1 }],\n    "e": 7\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This would match any one of the following conditions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.c"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.c=true"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.d"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.b.d=1"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.e"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"a.e=7"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Some more real world usable examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all orphaned entities:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?filter=metadata.annotations.backstage.io/orphan=true"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all users and groups:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?filter=kind=user&filter=kind=group"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return all service components:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?filter=kind=component,spec.type=service"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Return all entities with the ",(0,s.jsx)(n.code,{children:"java"})," tag:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?filter=metadata.tags.java"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Return all users who are members of the ",(0,s.jsx)(n.code,{children:"ops"})," group (note that the full\n",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/references",children:"reference"})," of the group is used):"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?filter=kind=user,relations.memberof=group:default/ops"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"field-selection-1",children:"Field selection"}),"\n",(0,s.jsxs)(n.p,{children:["By default the full entities are returned, but you can pass in a ",(0,s.jsx)(n.code,{children:"fields"})," query\nparameter which selects what parts of the entity data to retain. This makes the\nresponse smaller and faster to transfer, and may allow the catalog to perform\nmore efficient queries."]}),"\n",(0,s.jsxs)(n.p,{children:["The query parameter value is a comma separated list of simplified JSON paths\nlike above. Each path corresponds to the key of either a value, or of a subtree\nroot that you want to keep in the output. The rest is pruned away. For example,\nspecifying ",(0,s.jsx)(n.code,{children:"?fields=metadata.name,metadata.annotations,spec"})," retains only the\n",(0,s.jsx)(n.code,{children:"name"})," and ",(0,s.jsx)(n.code,{children:"annotations"})," fields of the ",(0,s.jsx)(n.code,{children:"metadata"})," of each entity (it'll be an\nobject with at most two keys), keeps the entire ",(0,s.jsx)(n.code,{children:"spec"})," unchanged, and cuts out\nall other roots such as ",(0,s.jsx)(n.code,{children:"relations"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Some more real world usable examples:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Return only enough data to form the full ref of each entity:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"/entities?fields=kind,metadata.namespace,metadata.name"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ordering-1",children:"Ordering"}),"\n",(0,s.jsxs)(n.p,{children:["By default the entities are returned in an undefined, but stable order. You can\npass in one or more ",(0,s.jsx)(n.code,{children:"order"})," query parameters to affect that ordering."]}),"\n",(0,s.jsxs)(n.p,{children:["Each parameter starts either with ",(0,s.jsx)(n.code,{children:"asc:"})," for ascending lexicographical order or\n",(0,s.jsx)(n.code,{children:"desc:"})," for descending (reverse) lexicographical order, followed by a\ndot-separated path into an entity's keys. The ordering is case insensitive. If\nmore than one order directive is given, later directives have lower precedence\n(they are applied only when directives of higher precedence have equal values)."]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"/entities?order=asc:kind&order=desc:metadata.name\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will order the output first by kind ascending, and then within each kind\n(if there's more than one of a given kind) by their name descending. When given\na field that does NOT exist on all entities in the result set, those entities\nthat do not have the field will always be sorted last in that particular order\nstep, no matter what the desired order was."}),"\n",(0,s.jsx)(n.h4,{id:"pagination-1",children:"Pagination"}),"\n",(0,s.jsxs)(n.p,{children:["You may pass the ",(0,s.jsx)(n.code,{children:"offset"})," and ",(0,s.jsx)(n.code,{children:"limit"})," query parameters to do classical\npagination through the set of entities. There is also an ",(0,s.jsx)(n.code,{children:"after"})," query parameter\nto return the next page of results after the previous one when performing cursor\nbased pagination."]}),"\n",(0,s.jsxs)(n.p,{children:["Each paginated response that has a next page of data, will have a ",(0,s.jsx)(n.code,{children:"Link"}),",\n",(0,s.jsx)(n.code,{children:'rel="next"'})," header pointing to the query path to the next page."]}),"\n",(0,s.jsx)(n.p,{children:"Example: Getting the first page:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'GET /entities?limit=2\nHTTP/1.1 200 OK\nlink: </entities?limit=2&after=eyJsaW1pdCI6Miwib2Zmc2V0IjoyfQ%3D%3D>; rel="next"\n\n[{"metadata":{...\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Getting the next page, since we detect the presence of the ",(0,s.jsx)(n.code,{children:"Link"})," header:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:'GET /entities?limit=2&after=eyJsaW1pdCI6Miwib2Zmc2V0IjoyfQ%3D%3D\nHTTP/1.1 200 OK\nlink: </entities?limit=2&after=eyJsaW1pdCI6Miwib2Zmc2V0Ijo0fQ%3D%3D>; rel="next"\n\n[{"metadata":{...\n'})}),"\n",(0,s.jsx)(n.h3,{id:"get-entitiesby-uiduid",children:(0,s.jsx)(n.code,{children:"GET /entities/by-uid/<uid>"})}),"\n",(0,s.jsxs)(n.p,{children:["Gets an entity by its ",(0,s.jsx)(n.code,{children:"metadata.uid"})," field value."]}),"\n",(0,s.jsxs)(n.p,{children:["The return type is JSON, as a single ",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/descriptor-format",children:(0,s.jsx)(n.code,{children:"Entity"})}),", or a 404\nerror if there was no entity with that UID."]}),"\n",(0,s.jsx)(n.h3,{id:"delete-entitiesby-uiduid",children:(0,s.jsx)(n.code,{children:"DELETE /entities/by-uid/<uid>"})}),"\n",(0,s.jsxs)(n.p,{children:["Deletes an entity by its ",(0,s.jsx)(n.code,{children:"metadata.uid"})," field value."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"}),' This method of deletion is appropriate for orphaned entities, but\nnot for removal of "live" entities that are actively being updated by a\nlocation. Please read below.']}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'The most common user flow is that you register a location (see below), and then\nthe catalog keeps itself up to date with that location and the subtree of things\nthat may spawn from it. This means that the catalog is a live-updating view of\nan actual authoritative data source. If there\'s something keeping the entity\n"alive" in the catalog, it will just reappear shortly after deletion with the\nmethod described in this section. To properly remove entities, you typically\nwant to instead unregister the location that causes the entity to appear.'}),"\n",(0,s.jsxs)(n.p,{children:["However if you have an orphaned entity, for example after removing the reference\nto its file from a ",(0,s.jsx)(n.code,{children:"Location"})," entity, or if a processor has stopped producing\nyour entity, then this deletion method is appropriate."]}),"\n",(0,s.jsx)(n.p,{children:"The return type is always an empty 204 response, whether an entity with this UID\nexisted or not."}),"\n",(0,s.jsx)(n.h3,{id:"get-entitiesby-namekindnamespacename",children:(0,s.jsx)(n.code,{children:"GET /entities/by-name/<kind>/<namespace>/<name>"})}),"\n",(0,s.jsxs)(n.p,{children:["Gets an entity by its ",(0,s.jsx)(n.code,{children:"kind"}),", ",(0,s.jsx)(n.code,{children:"metadata.namespace"}),", and ",(0,s.jsx)(n.code,{children:"metadata.name"})," field\nvalue. These are special in that they form the entity's unique\n",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/references",children:"reference"})," triplet."]}),"\n",(0,s.jsxs)(n.p,{children:["The return type is JSON, as a single ",(0,s.jsx)(n.a,{href:"/docs/next/features/software-catalog/descriptor-format",children:(0,s.jsx)(n.code,{children:"Entity"})}),", or a 404\nerror if there was no entity with that reference triplet."]}),"\n",(0,s.jsx)(n.h3,{id:"get-entitiesby-namekindnamespacenameancestry",children:(0,s.jsx)(n.code,{children:"GET /entities/by-name/{kind}/{namespace}/{name}/ancestry"})}),"\n",(0,s.jsx)(n.p,{children:"Get an entity's ancestry by entity ref."}),"\n",(0,s.jsx)(n.h3,{id:"post-entitiesby-refs",children:(0,s.jsx)(n.code,{children:"POST /entities/by-refs"})}),"\n",(0,s.jsx)(n.p,{children:"Gets a batch of entities by their entity refs. This is useful in contexts where\nyou want to fetch a large number of specific entities efficiently, for example\nin GraphQL resolvers."}),"\n",(0,s.jsx)(n.p,{children:"The request body is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "entityRefs": ["component:default/foo", "api:default/bar"],\n  "fields": ["kind", "metadata.name"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["where each ",(0,s.jsx)(n.code,{children:"entityRefs"})," entry is an entity ref that you want to fetch. The\n",(0,s.jsx)(n.code,{children:"fields"})," array is optional and works the same way as the ",(0,s.jsx)(n.code,{children:"GET /entities"})," fields\nabove, e.g. it's used to fetch only certain slices of each entity."]}),"\n",(0,s.jsx)(n.p,{children:"The return type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "items": [{ "kind": "Component", "metadata": { "name": "foo" } }, null]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["where the ",(0,s.jsx)(n.code,{children:"items"})," array has ",(0,s.jsx)(n.em,{children:"the same length"})," and ",(0,s.jsx)(n.em,{children:"the same order"})," as the input\n",(0,s.jsx)(n.code,{children:"entityRefs"})," array. Each element contains the corresponding entity data, or\n",(0,s.jsx)(n.code,{children:"null"})," if no entity existed in the catalog with that ref."]}),"\n",(0,s.jsx)(n.h3,{id:"post-refresh",children:(0,s.jsx)(n.code,{children:"POST /refresh"})}),"\n",(0,s.jsxs)(n.p,{children:["Refresh the entity related to ",(0,s.jsx)(n.code,{children:"entityRef"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Request body is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "entityRef": "<string>"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"post-validate-entity",children:(0,s.jsx)(n.code,{children:"POST /validate-entity"})}),"\n",(0,s.jsx)(n.p,{children:"Validate that a passed in entity has no errors in schema."}),"\n",(0,s.jsx)(n.p,{children:"Request body is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "location": "<string>",\n  "entity": {}\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"locations",children:"Locations"}),"\n",(0,s.jsx)(n.h3,{id:"get-locations",children:(0,s.jsx)(n.code,{children:"GET /locations"})}),"\n",(0,s.jsx)(n.p,{children:"Lists locations."}),"\n",(0,s.jsx)(n.p,{children:"Response type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "data": {\n      "id": "b9784c38-7118-472f-9e22-5638fc73bab0",\n      "target": "https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml",\n      "type": "url"\n    }\n  }\n]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"get-locationsid",children:(0,s.jsx)(n.code,{children:"GET /locations/{id}"})}),"\n",(0,s.jsx)(n.p,{children:"Gets a location by it's location ID."}),"\n",(0,s.jsx)(n.p,{children:"Response type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "id": "b9784c38-7118-472f-9e22-5638fc73bab0",\n  "target": "https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml",\n  "type": "url"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"get-locationsby-entitykindnamespacename",children:(0,s.jsx)(n.code,{children:"GET /locations/by-entity/{kind}/{namespace}/{name}"})}),"\n",(0,s.jsx)(n.p,{children:"Gets a location referring to a given entity."}),"\n",(0,s.jsx)(n.p,{children:"Response type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "id": "b9784c38-7118-472f-9e22-5638fc73bab0",\n  "target": "https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml",\n  "type": "url"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"get-entity-facetsfacetstringfacetstringfilterstringfilterstring",children:(0,s.jsx)(n.code,{children:"GET /entity-facets?facet=<string>&facet=<string>&filter=<string>&filter=<string>"})}),"\n",(0,s.jsx)(n.p,{children:"Get all entity facets that match the given filters."}),"\n",(0,s.jsx)(n.p,{children:"Response type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "facets": [\n    {\n      "value": "<string>",\n      "count": 1\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"post-locations",children:(0,s.jsx)(n.code,{children:"POST /locations"})}),"\n",(0,s.jsx)(n.p,{children:"Adds a location to be ingested by the catalog."}),"\n",(0,s.jsxs)(n.p,{children:["If successful the response code will be ",(0,s.jsx)(n.code,{children:"HTTP/1.1 201 Created"})," and a JSON on the form"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "entities": [],\n  "location": {\n    "id": "b9784c38-7118-472f-9e22-5638fc73bab0",\n    "target": "https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml",\n    "type": "url"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If the location already exists the response will be ",(0,s.jsx)(n.code,{children:"HTTP/1.1 409 Conflict"})," and a JSON on the form"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "error": {\n    "message": "Location url:https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml already exists",\n    "name": "ConflictError",\n    "stack": "ConflictError: Location url:https://git.example.com/example-project/example-repository/blob/main/catalog-info.yaml already exists\\n..."\n  },\n  "request": {\n    "method": "POST",\n    "url": "/locations"\n  },\n  "response": {\n    "statusCode": 409\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Supports the ",(0,s.jsx)(n.code,{children:"?dryRun=true"})," query parameter, which will perform validation and not write anything to the database. In the event of successfully passing validation, the ",(0,s.jsx)(n.code,{children:"entities"})," field of the response JSON will be populated with entities present in the location."]}),"\n",(0,s.jsx)(n.h3,{id:"post-analyze-location",children:(0,s.jsx)(n.code,{children:"POST /analyze-location"})}),"\n",(0,s.jsx)(n.p,{children:"Validate a given location."}),"\n",(0,s.jsx)(n.p,{children:"Request body is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "location": {\n    "type": "<string>",\n    "target": "<string>"\n  },\n  "catalogFileName": "<string>"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"And Response type is JSON, on the form"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "generateEntities": [\n    {\n      "fields": [\n        {\n          "description": "<string>",\n          "value": "<string>",\n          "state": "needsUserInput",\n          "field": "<string>"\n        },\n        {\n          "description": "<string>",\n          "value": {},\n          "state": "analysisSuggestedNoValue",\n          "field": "<string>"\n        }\n      ],\n      "entity": {}\n    }\n  ],\n  "existingEntityFiles": [\n    {\n      "entity": "<Entity>",\n      "isRegistered": "<boolean>",\n      "location": {\n        "target": "<string>",\n        "type": "<string>"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"delete-locationsid",children:(0,s.jsx)(n.code,{children:"DELETE /locations/{id}"})}),"\n",(0,s.jsxs)(n.p,{children:["Delete a location by its id. On success response code will be ",(0,s.jsx)(n.code,{children:"HTTP/1.1 204 No Content"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"other",children:"Other"}),"\n",(0,s.jsx)(n.p,{children:"TODO"})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>l});var i=t(296540);let s={},a=i.createContext(s);function r(e){let n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}},340978(e){e.exports=JSON.parse('{"id":"features/software-catalog/software-catalog-api","title":"API","description":"The Software Catalog API","source":"@site/../docs/features/software-catalog/api.md","sourceDirName":"features/software-catalog","slug":"/features/software-catalog/software-catalog-api","permalink":"/docs/next/features/software-catalog/software-catalog-api","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/features/software-catalog/api.md","tags":[],"version":"current","frontMatter":{"id":"software-catalog-api","title":"API","description":"The Software Catalog API"}}')}}]);