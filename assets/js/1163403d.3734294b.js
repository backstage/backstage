"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["4786"],{93838(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});var t=n(977063),r=n(474848),c=n(28453);let o={id:"adrs-adr013",title:"ADR013: [superseded] Proper use of HTTP fetching libraries",description:"Architecture Decision Record (ADR) for the proper use of fetchApiRef, node-fetch, and cross-fetch for data fetching."},i,a={},d=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2}];function h(e){let s={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.admonition,{title:"Superseded",type:"note",children:(0,r.jsxs)(s.p,{children:["This ADR has been superseded by ",(0,r.jsx)(s.a,{href:"/docs/next/architecture-decisions/adrs-adr014",children:"ADR014"})," and no longer applies."]})}),"\n",(0,r.jsx)(s.h2,{id:"context",children:"Context"}),"\n",(0,r.jsx)(s.p,{children:"Using multiple HTTP packages for data fetching increases the complexity and the\nsupport burden of keeping said package up to date."}),"\n",(0,r.jsx)(s.h2,{id:"decision",children:"Decision"}),"\n",(0,r.jsxs)(s.p,{children:["Backend (node) packages should use the ",(0,r.jsx)(s.code,{children:"node-fetch"})," package for HTTP data\nfetching. Example:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import fetch from 'node-fetch';\nimport { ResponseError } from '@backstage/errors';\n\nconst response = await fetch('https://example.com/api/v1/users.json');\nif (!response.ok) {\n  throw await ResponseError.fromResponse(response);\n}\nconst users = await response.json();\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Frontend plugins and packages should prefer to use the\n",(0,r.jsx)(s.a,{href:"https://backstage.io/api/stable/variables/_backstage_core-plugin-api.index.fetchApiRef.html",children:(0,r.jsx)(s.code,{children:"fetchApiRef"})}),".\nIt uses ",(0,r.jsx)(s.code,{children:"cross-fetch"})," internally. Example:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import { useApi } from '@backstage/core-plugin-api';\n\n// Inside some functional React component...\nconst { fetch } = useApi(fetchApiRef);\n\nconst response = await fetch('https://example.com/api/v1/users.json');\nif (!response.ok) {\n  throw await ResponseError.fromResponse(response);\n}\nconst users = await response.json();\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Isomorphic packages should have a dependency on the ",(0,r.jsx)(s.code,{children:"cross-fetch"})," package for\nmocking and type definitions. Preferably, classes and functions in isomorphic\npackages should accept an argument of type ",(0,r.jsx)(s.code,{children:"typeof fetch"})," to let callers supply\ntheir preferred implementation of ",(0,r.jsx)(s.code,{children:"fetch"}),". This lets them adorn the calls with\nauth or other information, and track metrics etc, in a cross-platform way.\nExample:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"import crossFetch from 'cross-fetch';\n\nexport class MyClient {\n  private readonly fetch: typeof crossFetch;\n\n  constructor(options: { fetch?: typeof crossFetch }) {\n    this.fetch = options.fetch || crossFetch;\n  }\n\n  async users() {\n    return await this.fetch('https://example.com/api/v1/users.json');\n  }\n}\n"})}),"\n",(0,r.jsx)(s.h2,{id:"consequences",children:"Consequences"}),"\n",(0,r.jsxs)(s.p,{children:["We will gradually transition away from third party packages such as ",(0,r.jsx)(s.code,{children:"axios"}),",\n",(0,r.jsx)(s.code,{children:"got"})," and others. Once we have transitioned to ",(0,r.jsx)(s.code,{children:"node-fetch"})," we will add lint\nrules to enforce this decision."]})]})}function p(e={}){let{wrapper:s}={...(0,c.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453(e,s,n){n.d(s,{R:()=>o,x:()=>i});var t=n(296540);let r={},c=t.createContext(r);function o(e){let s=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(c.Provider,{value:s},e.children)}},977063(e){e.exports=JSON.parse('{"id":"architecture-decisions/adrs-adr013","title":"ADR013: [superseded] Proper use of HTTP fetching libraries","description":"Architecture Decision Record (ADR) for the proper use of fetchApiRef, node-fetch, and cross-fetch for data fetching.","source":"@site/../docs/architecture-decisions/adr013-use-node-fetch.md","sourceDirName":"architecture-decisions","slug":"/architecture-decisions/adrs-adr013","permalink":"/docs/next/architecture-decisions/adrs-adr013","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/architecture-decisions/adr013-use-node-fetch.md","tags":[],"version":"current","frontMatter":{"id":"adrs-adr013","title":"ADR013: [superseded] Proper use of HTTP fetching libraries","description":"Architecture Decision Record (ADR) for the proper use of fetchApiRef, node-fetch, and cross-fetch for data fetching."},"sidebar":"docs","previous":{"title":"ADR012: Use Luxon.toLocaleString and date/time presets","permalink":"/docs/next/architecture-decisions/adrs-adr012"},"next":{"title":"ADR014: Proper use of HTTP fetching libraries","permalink":"/docs/next/architecture-decisions/adrs-adr014"}}')}}]);