/*! For license information please see 8e6e1c78.8d96a635.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[71660],{30985:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>a});var n=t(74848),r=t(28453);const s={id:"root-lifecycle",title:"Root Lifecycle Service",sidebar_label:"Root Lifecycle",description:"Documentation for the Root Lifecycle service"},c=void 0,i={id:"backend-system/core-services/root-lifecycle",title:"Root Lifecycle Service",description:"Documentation for the Root Lifecycle service",source:"@site/versioned_docs/version-stable/backend-system/core-services/root-lifecycle.md",sourceDirName:"backend-system/core-services",slug:"/backend-system/core-services/root-lifecycle",permalink:"/docs/backend-system/core-services/root-lifecycle",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/backend-system/core-services/root-lifecycle.md",tags:[],version:"stable",frontMatter:{id:"root-lifecycle",title:"Root Lifecycle Service",sidebar_label:"Root Lifecycle",description:"Documentation for the Root Lifecycle service"},sidebar:"docs",previous:{title:"Root Instance Metadata",permalink:"/docs/backend-system/core-services/root-instance-metadata"},next:{title:"Root Logger",permalink:"/docs/backend-system/core-services/root-logger"}},l={},a=[{value:"Configure the service",id:"configure-the-service",level:2}];function d(e){const o={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.p,{children:"This service is the same as the lifecycle service, but should only be used by the root services. This is also where the implementation for the actual lifecycle hooks are collected and executed, so if you want to override the implementation of how those are processed, you should override this service."}),"\n",(0,n.jsx)(o.h2,{id:"configure-the-service",children:"Configure the service"}),"\n",(0,n.jsx)(o.p,{children:"The following example shows how to override the default implementation of the lifecycle service with something that listens on different process events to the original."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-ts",children:"class MyCustomLifecycleService implements RootLifecycleService {\n  constructor(private readonly logger: LoggerService) {}\n\n  #isCalled = false;\n  #shutdownTasks: Array<{\n    hook: LifecycleServiceShutdownHook;\n    options?: LifecycleServiceShutdownOptions;\n  }> = [];\n\n  addShutdownHook(\n    hook: LifecycleServiceShutdownHook,\n    options?: LifecycleServiceShutdownOptions,\n  ): void {\n    this.#shutdownTasks.push({ hook, options });\n  }\n\n  async shutdown(): Promise<void> {\n    if (this.#isCalled) {\n      return;\n    }\n    this.#isCalled = true;\n\n    this.logger.info(`Running ${this.#shutdownTasks.length} shutdown tasks...`);\n    await Promise.all(\n      this.#shutdownTasks.map(async ({ hook, options }) => {\n        const logger = options?.logger ?? this.logger;\n        try {\n          await hook();\n          logger.info(`Shutdown hook succeeded`);\n        } catch (error) {\n          logger.error(`Shutdown hook failed, ${error}`);\n        }\n      }),\n    );\n  }\n}\n\nconst backend = createBackend();\n\nbackend.add(\n  createServiceFactory({\n    service: coreServices.rootLifecycle,\n    deps: {\n      logger: coreServices.rootLogger,\n    },\n    async factory({ logger }) {\n      return new MyCustomLifecycleService(logger);\n    },\n  }),\n);\n"})})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},21020:(e,o,t)=>{var n=t(96540),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function a(e,o,t){var n,s={},a=null,d=null;for(n in void 0!==t&&(a=""+t),void 0!==o.key&&(a=""+o.key),void 0!==o.ref&&(d=o.ref),o)c.call(o,n)&&!l.hasOwnProperty(n)&&(s[n]=o[n]);if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===s[n]&&(s[n]=o[n]);return{$$typeof:r,type:e,key:a,ref:d,props:s,_owner:i.current}}o.Fragment=s,o.jsx=a,o.jsxs=a},74848:(e,o,t)=>{e.exports=t(21020)},28453:(e,o,t)=>{t.d(o,{R:()=>c,x:()=>i});var n=t(96540);const r={},s=n.createContext(r);function c(e){const o=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),n.createElement(s.Provider,{value:o},e.children)}}}]);