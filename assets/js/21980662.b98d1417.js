/*! For license information please see 21980662.b98d1417.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[877293],{830003:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>r});var l=t(474848),s=t(28453);const i={id:"templates",title:"CLI Templates",description:"Overview of the new CLI Declarative Templates"},a=void 0,c={id:"tooling/cli/templates",title:"CLI Templates",description:"Overview of the new CLI Declarative Templates",source:"@site/../docs/tooling/cli/04-templates.md",sourceDirName:"tooling/cli",slug:"/tooling/cli/templates",permalink:"/docs/next/tooling/cli/templates",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/tooling/cli/04-templates.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"templates",title:"CLI Templates",description:"Overview of the new CLI Declarative Templates"},sidebar:"docs",previous:{title:"Commands",permalink:"/docs/next/tooling/cli/commands"},next:{title:"Linking in Local Packages",permalink:"/docs/next/tooling/local-dev/linking-local-packages"}},d={},r=[{value:"Basic Configuration",id:"basic-configuration",level:2},{value:"Installing custom templates",id:"installing-custom-templates",level:2},{value:"Creating your own CLI templates",id:"creating-your-own-cli-templates",level:2},{value:"Template Roles",id:"template-roles",level:3},{value:"Dependency Versioning",id:"dependency-versioning",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["The behavior of the ",(0,l.jsx)(n.code,{children:"backstage-cli new"})," command is configurable through your root ",(0,l.jsx)(n.code,{children:"package.json"}),", and you can also create and add custom CLI templates to suit your needs."]}),"\n",(0,l.jsx)(n.h2,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "root",\n  "backstage": {\n    "cli": {\n      "new": {\n        "globals": {\n          "license": "MIT",\n          "namePrefix": "@my-org/"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"globals"})," - Configures input for all generated packages and plugins.\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"version"})," - Sets the value of the ",(0,l.jsx)(n.code,{children:"version"})," field in ",(0,l.jsx)(n.code,{children:"package.json"})," of all generated packages. Defaults to ",(0,l.jsx)(n.code,{children:"0.1.0"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"license"})," - Sets the value of the ",(0,l.jsx)(n.code,{children:"license"})," field in ",(0,l.jsx)(n.code,{children:"package.json"})," of all generated packages. Defaults to ",(0,l.jsx)(n.code,{children:"Apache-2.0"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"private"})," - Sets the value of the ",(0,l.jsx)(n.code,{children:"private"})," field in ",(0,l.jsx)(n.code,{children:"package.json"})," of all generated packages. Defaults to ",(0,l.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"publishRegistry"})," - Sets the value of the ",(0,l.jsx)(n.code,{children:"publishConfig.registry"})," field in ",(0,l.jsx)(n.code,{children:"package.json"})," of all generated packages."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"namePrefix"})," - The prefix used to generate the full package name. Defaults to ",(0,l.jsx)(n.code,{children:"@internal/"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"namePluginInfix"})," - The infix used to generate the full package name for plugin packages. Defaults to ",(0,l.jsx)(n.code,{children:"plugin-"}),"."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"templates"})," - Specifies custom templates.\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["See ",(0,l.jsx)(n.a,{href:"#installing-custom-templates",children:"Installing custom templates"})," and ",(0,l.jsx)(n.a,{href:"#creating-your-own-cli-templates",children:"Creating your own CLI templates"})," for more information."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["The generated package name is based on the ",(0,l.jsx)(n.code,{children:"namePrefix"})," and ",(0,l.jsx)(n.code,{children:"namePluginInfix"}),' globals, as well as the "base name" which is derived from the package role and user input. For plugin packages the final package name will be ',(0,l.jsx)(n.code,{children:"<namePrefix><namePluginInfix><baseName>"}),", and for other packages it will be ",(0,l.jsx)(n.code,{children:"<namePrefix><baseName>"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["For example, if you want your plugin frontend packages to end up with the name ",(0,l.jsx)(n.code,{children:"@acme/backstage-plugin-<pluginId>"}),", you should use the following configuration:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "root",\n  "backstage": {\n    "cli": {\n      "new": {\n        "globals": {\n          "namePrefix": "@acme/",\n          "namePluginInfix": "backstage-plugin-"\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"installing-custom-templates",children:"Installing custom templates"}),"\n",(0,l.jsxs)(n.p,{children:["Custom templates can be installed from local directories. To install a template you add it to the ",(0,l.jsx)(n.code,{children:"backstage.cli.new.templates"})," configuration array in your root ",(0,l.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "root",\n  "backstage": {\n    "cli": {\n      "new": {\n        "templates": ["./templates/custom-plugin"]\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["Each entry in the ",(0,l.jsx)(n.code,{children:"templates"})," array should be a relative path that points to a directory containing a ",(0,l.jsx)(n.code,{children:"portable-template.yaml"})," file. If the path starts with ",(0,l.jsx)(n.code,{children:"./"})," it will be used as is, otherwise it will be resolved as a module within ",(0,l.jsx)(n.code,{children:"node_modules"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["When defining the ",(0,l.jsx)(n.code,{children:"templates"})," array it will override the default set of templates. If you want to keep using one of the build-in templates in the Backstage CLI you can reference them directly within the CLI package. This following is the full list of built-in templates:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "name": "root",\n  "backstage": {\n    "cli": {\n      "new": {\n        "templates": [\n          "@backstage/cli/templates/frontend-plugin",\n          "@backstage/cli/templates/backend-plugin",\n          "@backstage/cli/templates/backend-plugin-module",\n          "@backstage/cli/templates/plugin-web-library",\n          "@backstage/cli/templates/plugin-node-library",\n          "@backstage/cli/templates/plugin-common-library",\n          "@backstage/cli/templates/web-library",\n          "@backstage/cli/templates/node-library",\n          "@backstage/cli/templates/scaffolder-backend-module"\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"creating-your-own-cli-templates",children:"Creating your own CLI templates"}),"\n",(0,l.jsxs)(n.p,{children:["Each template lives in its own directory and must have a ",(0,l.jsx)(n.code,{children:"portable-template.yaml"})," file that describes the template. The template directory can also contain any files that should be templated or copied to the generated package."]}),"\n",(0,l.jsxs)(n.p,{children:["Start by creating ",(0,l.jsx)(n.code,{children:"portable-template.yaml"})," in a new directory somewhere in your project, in this example we're using ",(0,l.jsx)(n.code,{children:"./templates/custom-plugin/portable-template.yaml"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="in templates/custom-plugin/portable-template.yaml"',children:"name: custom-plugin\nrole: frontend-plugin\ndescription: Description of my CLI template # optional\nvalues: # optional\n  pluginVar: '{{ camelCase pluginId }}Plugin'\n"})}),"\n",(0,l.jsx)(n.p,{children:"The following properties are supported:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"name"})," ",(0,l.jsx)(n.strong,{children:"(required)"})," - The name of your template, used by the user to select it."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"role"})," ",(0,l.jsx)(n.strong,{children:"(required)"})," - The role of the template, similar to package role. See ",(0,l.jsx)(n.a,{href:"#template-roles",children:"Template Roles"})," for more details."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"description"})," - A description of the type of package that this template produces."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"values"})," - A map of additional values that will be present during templating. The values are themselves templated and can reference other values. If the key matches any of the user prompts, such as ",(0,l.jsx)(n.code,{children:"pluginId"}),", the value will be used directly instead of prompting the user."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Next, add any other files you want to be part of the template to the same directory. All files will be copied as is, except any files with a ",(0,l.jsx)(n.code,{children:".hbs"})," extension. They will be treated as ",(0,l.jsx)(n.a,{href:"https://handlebarsjs.com/",children:"Handlebars"})," templates and will be rendered with the values from the ",(0,l.jsx)(n.code,{children:"portable-template.yaml"})," file as well as additional prompts such as ",(0,l.jsx)(n.code,{children:"pluginId"}),". For example, you could create a ",(0,l.jsx)(n.code,{children:"src/index.ts"})," file with the following content:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",metastring:'title="in templates/custom-plugin/src/index.ts.hbs"',children:"export function getPluginId() {\n  return '{{ pluginId }}';\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["If you'd like to see more examples, you can find all the default templates and their yaml files ",(0,l.jsx)(n.a,{href:"https://github.com/backstage/backstage/tree/master/packages/cli/templates",children:"here"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Once your template is ready, ",(0,l.jsx)(n.a,{href:"#installing-custom-templates",children:"add it to your config"}),", and you should now be able to select it when running ",(0,l.jsx)(n.code,{children:"yarn new"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"template-roles",children:"Template Roles"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"role"})," property in the template yaml file is used to determine what input will be gathered for the template, as well as what actions will be taken after the new package has been created. The following roles are supported:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Role"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Prompts"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Output Directory"}),(0,l.jsx)(n.th,{style:{textAlign:"left"},children:"Additional Actions"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"frontend-plugin"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"pluginId"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Add dependency to ",(0,l.jsx)(n.code,{children:"packages/app"})," and entry to ",(0,l.jsx)(n.code,{children:"packages/backend/src/App.tsx"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"frontend-plugin-module"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"pluginId"}),", ",(0,l.jsx)(n.code,{children:"moduleId"})]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Add dependency to ",(0,l.jsx)(n.code,{children:"packages/app"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"backend-plugin"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"pluginId"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Add dependency to ",(0,l.jsx)(n.code,{children:"packages/backend"})," and entry to ",(0,l.jsx)(n.code,{children:"packages/backend/src/index.ts"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"backend-plugin-module"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:[(0,l.jsx)(n.code,{children:"pluginId"}),", ",(0,l.jsx)(n.code,{children:"moduleId"})]}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsxs)(n.td,{style:{textAlign:"left"},children:["Add dependency to ",(0,l.jsx)(n.code,{children:"packages/backend"})," and entry to ",(0,l.jsx)(n.code,{children:"packages/backend/src/index.ts"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"web-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"name"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"packages"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"node-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"name"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"packages"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"common-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"name"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"packages"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugin-web-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"pluginId"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugin-node-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"pluginId"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugin-common-library"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"pluginId"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:(0,l.jsx)(n.code,{children:"plugins"})}),(0,l.jsx)(n.td,{style:{textAlign:"left"},children:"none"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"dependency-versioning",children:"Dependency Versioning"}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"yarn new"})," command automatically detects if the ",(0,l.jsx)(n.a,{href:"https://github.com/backstage/backstage/tree/master/packages/yarn-plugin",children:"Backstage Yarn plugin"})," is installed in your repository and adjusts dependency versioning accordingly."]}),"\n",(0,l.jsxs)(n.p,{children:["When the Backstage Yarn plugin is installed (detected via ",(0,l.jsx)(n.code,{children:".yarnrc.yml"}),"), ",(0,l.jsx)(n.code,{children:"yarn new"})," will generate ",(0,l.jsx)(n.code,{children:"backstage:^"})," ranges for all ",(0,l.jsx)(n.code,{children:"@backstage/*"})," dependencies. This ensures that new packages use the same Backstage version as defined in your ",(0,l.jsx)(n.code,{children:"backstage.json"})," file."]}),"\n",(0,l.jsxs)(n.p,{children:["When the plugin is not installed, ",(0,l.jsx)(n.code,{children:"yarn new"})," uses the standard npm version ranges (e.g., ",(0,l.jsx)(n.code,{children:"^1.0.0"}),") for all dependencies, maintaining backward compatibility."]}),"\n",(0,l.jsxs)(n.p,{children:["Regardless of plugin installation, ",(0,l.jsx)(n.code,{children:"workspace:"})," ranges found in your ",(0,l.jsx)(n.code,{children:"yarn.lock"})," file will always take precedence over both ",(0,l.jsx)(n.code,{children:"backstage:^"})," and npm ranges. This ensures that packages within monorepos continue to use workspace linking when available."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},221020:(e,n,t)=>{var l=t(296540),s=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,c=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function r(e,n,t){var l,i={},r=null,o=null;for(l in void 0!==t&&(r=""+t),void 0!==n.key&&(r=""+n.key),void 0!==n.ref&&(o=n.ref),n)a.call(n,l)&&!d.hasOwnProperty(l)&&(i[l]=n[l]);if(e&&e.defaultProps)for(l in n=e.defaultProps)void 0===i[l]&&(i[l]=n[l]);return{$$typeof:s,type:e,key:r,ref:o,props:i,_owner:c.current}}n.Fragment=i,n.jsx=r,n.jsxs=r},474848:(e,n,t)=>{e.exports=t(221020)},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var l=t(296540);const s={},i=l.createContext(s);function a(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);