"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([["66628"],{545189(e,t,s){s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>d});var a=s(367153),n=s(474848),i=s(28453);let r={id:"database",title:"Database Service",sidebar_label:"Database",description:"Documentation for the Database service"},c,o={},d=[{value:"Using the service",id:"using-the-service",level:2}];function l(e){let t={code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["This service lets your plugins get a ",(0,n.jsx)(t.code,{children:"knex"})," client hooked up to a database which is configured in your ",(0,n.jsx)(t.code,{children:"app-config"})," YAML files, for your persistence needs."]}),"\n",(0,n.jsxs)(t.p,{children:["If there's no config provided in ",(0,n.jsx)(t.code,{children:"backend.database"})," then you will automatically get a simple in-memory SQLite 3 database for your plugin whose contents will be lost when the service restarts."]}),"\n",(0,n.jsx)(t.p,{children:"This service is scoped per plugin too, so that table names do not conflict across plugins."}),"\n",(0,n.jsx)(t.h2,{id:"using-the-service",children:"Using the service"}),"\n",(0,n.jsxs)(t.p,{children:["The following example shows how to get access to the database service in your ",(0,n.jsx)(t.code,{children:"example"})," backend plugin and getting a client for interacting with the database. It also runs some migrations from a certain directory for your plugin."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-ts",children:"import {\n  coreServices,\n  createBackendPlugin,\n} from '@backstage/backend-plugin-api';\nimport { resolvePackagePath } from '@backstage/backend-plugin-api';\n\ncreateBackendPlugin({\n  pluginId: 'example',\n  register(env) {\n    env.registerInit({\n      deps: {\n        database: coreServices.database,\n      },\n      async init({ database }) {\n        const client = await database.getClient();\n        const migrationsDir = resolvePackagePath(\n          '@internal/my-plugin',\n          'migrations',\n        );\n        if (!database.migrations?.skip) {\n          await client.migrate.latest({\n            directory: migrationsDir,\n          });\n        }\n      },\n    });\n  },\n});\n"})})]})}function p(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},28453(e,t,s){s.d(t,{R:()=>r,x:()=>c});var a=s(296540);let n={},i=a.createContext(n);function r(e){let t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),a.createElement(i.Provider,{value:t},e.children)}},367153(e){e.exports=JSON.parse('{"id":"backend-system/core-services/database","title":"Database Service","description":"Documentation for the Database service","source":"@site/versioned_docs/version-stable/backend-system/core-services/database.md","sourceDirName":"backend-system/core-services","slug":"/backend-system/core-services/database","permalink":"/docs/backend-system/core-services/database","draft":false,"unlisted":false,"editUrl":"https://github.com/backstage/backstage/edit/master/docs/backend-system/core-services/database.md","tags":[],"version":"stable","frontMatter":{"id":"database","title":"Database Service","sidebar_label":"Database","description":"Documentation for the Database service"},"sidebar":"docs","previous":{"title":"Cache","permalink":"/docs/backend-system/core-services/cache"},"next":{"title":"Discovery","permalink":"/docs/backend-system/core-services/discovery"}}')}}]);