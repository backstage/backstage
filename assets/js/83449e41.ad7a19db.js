/*! For license information please see 83449e41.ad7a19db.js.LICENSE.txt */
"use strict";(self.webpackChunkbackstage_microsite=self.webpackChunkbackstage_microsite||[]).push([[906063],{971636:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var r=n(474848),t=n(28453);const o={id:"feature-loaders",title:"Backend Feature Loaders",sidebar_label:"Feature Loaders",description:"Backend feature loaders"},s=void 0,c={id:"backend-system/architecture/feature-loaders",title:"Backend Feature Loaders",description:"Backend feature loaders",source:"@site/versioned_docs/version-stable/backend-system/architecture/07-feature-loaders.md",sourceDirName:"backend-system/architecture",slug:"/backend-system/architecture/feature-loaders",permalink:"/docs/backend-system/architecture/feature-loaders",draft:!1,unlisted:!1,editUrl:"https://github.com/backstage/backstage/edit/master/docs/backend-system/architecture/07-feature-loaders.md",tags:[],version:"stable",sidebarPosition:7,frontMatter:{id:"feature-loaders",title:"Backend Feature Loaders",sidebar_label:"Feature Loaders",description:"Backend feature loaders"},sidebar:"docs",previous:{title:"Modules",permalink:"/docs/backend-system/architecture/modules"},next:{title:"Naming Patterns",permalink:"/docs/backend-system/architecture/naming-patterns"}},i={},d=[{value:"Examples",id:"examples",level:2},{value:"Simple list of features",id:"simple-list-of-features",level:3},{value:"Conditional loading",id:"conditional-loading",level:3},{value:"Overriding service factories",id:"overriding-service-factories",level:3},{value:"Dynamic logic",id:"dynamic-logic",level:3}];function l(e){const a={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.p,{children:"Backend feature loaders are used to programmatically select and install features in a Backstage backend. They can service a wide range of use cases, such as enabling or disabling features based on static configuration, dynamically load features at runtime, or conditionally load features based on the state of a system."}),"\n",(0,r.jsxs)(a.p,{children:["Feature loaders are defined using the ",(0,r.jsx)(a.code,{children:"createBackendFeatureLoader"})," function, exported by ",(0,r.jsx)(a.code,{children:"@backstage/backend-plugin-api"}),". It accepts a ",(0,r.jsx)(a.code,{children:"loader"})," function, as well as an optional ",(0,r.jsx)(a.code,{children:"deps"})," object for declaring service dependencies. Unlike plugins and modules, feature loaders are limited to only depending on root-scoped services, but that still allows access to for example the ",(0,r.jsx)(a.a,{href:"/docs/backend-system/core-services/root-config",children:"root config"})," and ",(0,r.jsx)(a.a,{href:"/docs/backend-system/core-services/root-logger",children:"root logger"})," services."]}),"\n",(0,r.jsxs)(a.p,{children:["The ",(0,r.jsx)(a.code,{children:"loader"})," function can be defined in many different ways, with the main requirement being that it returns a list of ",(0,r.jsx)(a.code,{children:"BackendFeature"}),"s in some form. A backend feature is the kind of object that you can pass to ",(0,r.jsx)(a.code,{children:"backend.add(...)"}),", for example services factories, plugins, modules, or even other feature loaders. The ",(0,r.jsx)(a.code,{children:"loader"})," function can be synchronous or asynchronous, and can be defined as a generator function to allow for more complex logic."]}),"\n",(0,r.jsx)(a.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(a.p,{children:"The following are a few example of how feature loaders can be used:"}),"\n",(0,r.jsx)(a.h3,{id:"simple-list-of-features",children:"Simple list of features"}),"\n",(0,r.jsx)(a.p,{children:"A feature loader can simply return a list of features to be installed:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-ts",children:"export default createBackendFeatureLoader({\n  loader() {\n    return [\n      import('@backstage/plugin-search-backend'),\n      import('@backstage/plugin-search-backend-module-catalog'),\n      import('@backstage/plugin-search-backend-module-explore'),\n      import('@backstage/plugin-search-backend-module-techdocs'),\n    ];\n  },\n});\n"})}),"\n",(0,r.jsx)(a.p,{children:"It can also encapsulate a collection of custom features:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-ts",children:"export default createBackendFeatureLoader({\n  // Async loader is fine too\n  async loader() {\n    return [\n      createBackendPlugin({\n        ...\n      }),\n      createBackendModule({\n        ...\n      }),\n    ]\n  },\n});\n"})}),"\n",(0,r.jsx)(a.h3,{id:"conditional-loading",children:"Conditional loading"}),"\n",(0,r.jsx)(a.p,{children:"A feature loader can access root-scoped services, such as the config service. This allows for conditional loading of features based on configuration. It is often convenient to use a generator function for this purpose:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-ts",children:"export default createBackendFeatureLoader({\n  deps: {\n    config: coreServices.rootConfig,\n  },\n  // The `*` in front of the function name makes it a generator function\n  *loader({ config }) {\n    // Example of a custom config flag to enable search\n    if (config.getOptionalString('customFeatureToggle.search')) {\n      yield import('@backstage/plugin-search-backend');\n      yield import('@backstage/plugin-search-backend-module-catalog');\n      yield import('@backstage/plugin-search-backend-module-explore');\n      yield import('@backstage/plugin-search-backend-module-techdocs');\n    }\n  },\n});\n"})}),"\n",(0,r.jsx)(a.h3,{id:"overriding-service-factories",children:"Overriding service factories"}),"\n",(0,r.jsxs)(a.p,{children:["Service factories registered by feature loaders have lower priority than ones added directly via ",(0,r.jsx)(a.code,{children:"backend.add"}),". This allows you to use a feature loader for a larger number of service implementations, but still override individual services."]}),"\n",(0,r.jsx)(a.p,{children:"The ordering in which different feature loaders or service factories are added does not matter. There is also no priority between feature loaders, if two different feature loaders add a factory for the same service, the backend will fail to start."}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-ts",children:"const backend = createBackend();\n\nbackend.add(\n  createBackendFeatureLoader({\n    async *loader() {\n      yield import('./commonDiscoveryService'); // discovery service\n      yield import('./commonRootLoggerService'); // root logger service\n    },\n  }),\n);\n\nbackend.add(import('./myDiscoveryService')); // discovery service\n"})}),"\n",(0,r.jsxs)(a.p,{children:["The result of the above example is that the backend starts up with ",(0,r.jsx)(a.code,{children:"./myDiscoveryService"})," as the discovery service implementation, while ",(0,r.jsx)(a.code,{children:"./commonDiscoveryService"})," is ignored. The ",(0,r.jsx)(a.code,{children:"./commonRootLoggerService"})," will still be used."]}),"\n",(0,r.jsx)(a.h3,{id:"dynamic-logic",children:"Dynamic logic"}),"\n",(0,r.jsx)(a.p,{children:"A feature loader can also be asynchronous, and for example fetch data from an external source to determine which features to load:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-ts",children:"export default createBackendFeatureLoader({\n  // The `async *` in front of the function name makes it an async generator function.\n  async *loader() {\n    const localMetadata = await readMetadataFromDisk();\n\n    if (localMetadata.enableSearch) {\n      yield import('@backstage/plugin-search-backend');\n      yield import('@backstage/plugin-search-backend-module-catalog');\n\n      const remoteMetadata = await fetchMetadata();\n\n      if (remoteMetadata.enableExplore) {\n        yield import('@backstage/plugin-search-backend-module-explore');\n      }\n      if (remoteMetadata.enableTechDocs) {\n        yield import('@backstage/plugin-search-backend-module-techdocs');\n      }\n    }\n  },\n});\n"})})]})}function u(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},221020:(e,a,n)=>{var r=n(296540),t=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function d(e,a,n){var r,o={},d=null,l=null;for(r in void 0!==n&&(d=""+n),void 0!==a.key&&(d=""+a.key),void 0!==a.ref&&(l=a.ref),a)s.call(a,r)&&!i.hasOwnProperty(r)&&(o[r]=a[r]);if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===o[r]&&(o[r]=a[r]);return{$$typeof:t,type:e,key:d,ref:l,props:o,_owner:c.current}}a.Fragment=o,a.jsx=d,a.jsxs=d},474848:(e,a,n)=>{e.exports=n(221020)},28453:(e,a,n)=>{n.d(a,{R:()=>s,x:()=>c});var r=n(296540);const t={},o=r.createContext(t);function s(e){const a=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(o.Provider,{value:a},e.children)}}}]);