import{r as s,n as S,j as u,ab as L,c as j,ac as I}from"./iframe-hd6BgcQH.js";import{l as N}from"./lodash-CwBbdt2Q.js";import{u as R}from"./useAsync-DlvFpJJJ.js";import{s as q}from"./api-Bev5I2Sd.js";import{A as T,u as k}from"./useAnalytics-BNw5WHP5.js";function C(e){var r=s.useRef();return s.useEffect(function(){r.current=e}),r.current}const d=L("search-context"),J=()=>{const e=s.useContext(d);if(!e)throw new Error("useSearch must be used within a SearchContextProvider");const r=e.atVersion(1);if(!r)throw new Error("No SearchContext v1 found");return r},F=()=>s.useContext(d)!==void 0,P={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},_=(e=P)=>{const r=S(q),i=k(),[t,h]=s.useState(e.term),[c,p]=s.useState(e.types),[a,l]=s.useState(e.filters),[v,y]=s.useState(e.pageLimit),[f,n]=s.useState(e.pageCursor),x=C(t),g=C(a),o=R(async()=>{const m=await r.query({term:t,types:c,filters:a,pageLimit:v,pageCursor:f});return t&&i.captureEvent("search",t,{value:m.numberOfResults}),m},[t,c,a,v,f]),b=!o.loading&&!o.error&&o.value?.nextPageCursor,A=!o.loading&&!o.error&&o.value?.previousPageCursor,E=s.useCallback(()=>{n(o.value?.nextPageCursor)},[o.value?.nextPageCursor]),w=s.useCallback(()=>{n(o.value?.previousPageCursor)},[o.value?.previousPageCursor]);return s.useEffect(()=>{x!==void 0&&t!==x&&n(void 0)},[t,x,n]),s.useEffect(()=>{g!==void 0&&!N.isEqual(a,g)&&n(void 0)},[a,g,n]),{result:o,term:t,setTerm:h,types:c,setTypes:p,filters:a,setFilters:l,pageLimit:v,setPageLimit:y,pageCursor:f,setPageCursor:n,fetchNextPage:b?E:void 0,fetchPreviousPage:A?w:void 0}},M=e=>{const{initialState:r,children:i}=e,t=_(r);return u.jsx(T,{attributes:{searchTypes:t.types.sort().join(",")},children:u.jsx(d.Provider,{value:I({1:t}),children:i})})},O=e=>{const{initialState:r,inheritParentContextIfAvailable:i,children:t}=e,h=F(),c=S(j),p=r??{},a=c.has("search.query.pageLimit")?{pageLimit:c.getNumber("search.query.pageLimit")}:{},l={...P,...p,...a};return h&&i?u.jsx(u.Fragment,{children:t}):u.jsx(M,{initialState:l,children:t})};O.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{O as S,C as a,J as u};
