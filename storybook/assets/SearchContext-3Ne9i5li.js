import{r as e,J as b,V as I,j as l,c as N,a as k}from"./iframe-M9O-K8SB.js";import{l as q}from"./lodash-Czox7iJy.js";import{u as F}from"./useAsync-CFnaQwpM.js";import{s as T}from"./api-JIjLndcE.js";import{A as O,u as M}from"./useAnalytics-8ya555GT.js";function y(t){var s=e.useRef();return e.useEffect(function(){s.current=t}),s.current}const d=N("search-context"),U=()=>{const t=e.useContext(d);if(!t)throw new Error("useSearch must be used within a SearchContextProvider");const s=t.atVersion(1);if(!s)throw new Error("No SearchContext v1 found");return s},V=()=>e.useContext(d)!==void 0,E={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},_=(t=E)=>{const s=b(T),i=M(),[r,f]=e.useState(t.term),[n,h]=e.useState(t.types),[a,p]=e.useState(t.filters),[v,A]=e.useState(t.pageLimit),[g,c]=e.useState(t.pageCursor),C=e.useRef(!0),x=y(r),m=y(a),u=e.useRef(null),o=F(async()=>{if(C.current){if(!r&&!n.length&&!Object.keys(a).length)return{results:[],numberOfResults:0};C.current=!1}u.current&&u.current.abort();const S=new AbortController;u.current=S;const P=await s.query({term:r,types:n,filters:a,pageLimit:v,pageCursor:g},{signal:S.signal});return r&&i.captureEvent("search",r,{value:P.numberOfResults}),P},[r,n,a,v,g]),w=!o.loading&&!o.error&&o.value?.nextPageCursor,R=!o.loading&&!o.error&&o.value?.previousPageCursor,j=e.useCallback(()=>{c(o.value?.nextPageCursor)},[o.value?.nextPageCursor]),L=e.useCallback(()=>{c(o.value?.previousPageCursor)},[o.value?.previousPageCursor]);return e.useEffect(()=>()=>{u.current&&u.current.abort()},[]),e.useEffect(()=>{x!==void 0&&r!==x&&c(void 0)},[r,x,c]),e.useEffect(()=>{m!==void 0&&!q.isEqual(a,m)&&c(void 0)},[a,m,c]),{result:o,term:r,setTerm:f,types:n,setTypes:h,filters:a,setFilters:p,pageLimit:v,setPageLimit:A,pageCursor:g,setPageCursor:c,fetchNextPage:w?j:void 0,fetchPreviousPage:R?L:void 0}},J=t=>{const{initialState:s,children:i}=t,r=_(s);return l.jsx(O,{attributes:{searchTypes:r.types.sort().join(",")},children:l.jsx(d.Provider,{value:k({1:r}),children:i})})},z=t=>{const{initialState:s,inheritParentContextIfAvailable:i,children:r}=t,f=V(),n=b(I),h=s??{},a=n.has("search.query.pageLimit")?{pageLimit:n.getNumber("search.query.pageLimit")}:{},p={...E,...h,...a};return f&&i?l.jsx(l.Fragment,{children:r}):l.jsx(J,{initialState:p,children:r})};z.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{z as S,y as a,U as u};
