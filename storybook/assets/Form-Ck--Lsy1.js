import{e as N}from"./useFocusRing-BPooT00c.js";import{r as l,a3 as h}from"./iframe-B6vHPHUS.js";import{e as T,a as I,$ as U}from"./utils-Dc-c3eC3.js";const A={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},R={...A,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:A,validationErrors:[]},B=l.createContext({}),L="__formValidationState"+Date.now();function K(t){if(t[L]){let{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:s,commitValidation:n}=t[L];return{realtimeValidation:e,displayValidation:a,updateValidation:r,resetValidation:s,commitValidation:n}}return j(t)}function j(t){let{isInvalid:e,validationState:a,name:r,value:s,builtinValidation:n,validate:u,validationBehavior:v="aria"}=t;a&&(e||(e=a==="invalid"));let f=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:R}:null,o=l.useMemo(()=>{if(!u||s==null)return null;let d=Q(u,s);return C(d)},[u,s]);n?.validationDetails.valid&&(n=void 0);let i=l.useContext(B),c=l.useMemo(()=>r?Array.isArray(r)?r.flatMap(d=>x(i[d])):x(i[r]):[],[i,r]),[m,O]=l.useState(i),[S,V]=l.useState(!1);i!==m&&(O(i),V(!1));let E=l.useMemo(()=>C(S?[]:c),[S,c]),w=l.useRef($),[p,g]=l.useState($),b=l.useRef($),P=()=>{if(!F)return;y(!1);let d=o||n||w.current;M(d,b.current)||(b.current=d,g(d))},[F,y]=l.useState(!1);return l.useEffect(P),{realtimeValidation:f||E||o||n||$,displayValidation:v==="native"?f||E||p:f||E||o||n||p,updateValidation(d){v==="aria"&&!M(p,d)?g(d):w.current=d},resetValidation(){let d=$;M(d,b.current)||(b.current=d,g(d)),v==="native"&&y(!1),V(!0)},commitValidation(){v==="native"&&y(!0),V(!0)}}}function x(t){return t?Array.isArray(t)?t:[t]:[]}function Q(t,e){if(typeof t=="function"){let a=t(e);if(a&&typeof a!="boolean")return x(a)}return[]}function C(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:R}:null}function M(t,e){return t===e?!0:!!t&&!!e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every((a,r)=>a===e.validationErrors[r])&&Object.entries(t.validationDetails).every(([a,r])=>e.validationDetails[a]===r)}function W(t,e,a){let{validationBehavior:r,focus:s}=t;T(()=>{if(r==="native"&&a?.current&&!a.current.disabled){let o=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";a.current.setCustomValidity(o),a.current.hasAttribute("title")||(a.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(k(a.current))}});let n=l.useRef(!1),u=I(()=>{n.current||e.resetValidation()}),v=I(o=>{var i;e.displayValidation.isInvalid||e.commitValidation();let c=a==null||(i=a.current)===null||i===void 0?void 0:i.form;if(!o.defaultPrevented&&a&&c&&q(c)===a.current){var m;s?s():(m=a.current)===null||m===void 0||m.focus(),N("keyboard")}o.preventDefault()}),f=I(()=>{e.commitValidation()});l.useEffect(()=>{let o=a?.current;if(!o)return;let i=o.form,c=i?.reset;return i&&(i.reset=()=>{n.current=!window.event||window.event.type==="message"&&window.event.target instanceof MessagePort,c?.call(i),n.current=!1}),o.addEventListener("invalid",v),o.addEventListener("change",f),i?.addEventListener("reset",u),()=>{o.removeEventListener("invalid",v),o.removeEventListener("change",f),i?.removeEventListener("reset",u),i&&(i.reset=c)}},[a,v,f,u,r])}function _(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function k(t){return{isInvalid:!t.validity.valid,validationDetails:_(t),validationErrors:t.validationMessage?[t.validationMessage]:[]}}function q(t){for(let e=0;e<t.elements.length;e++){let a=t.elements[e];if(!a.validity.valid)return a}return null}const D=l.createContext(null),X=l.forwardRef(function(e,a){[e,a]=U(e,a,D);let{validationErrors:r,validationBehavior:s="native",children:n,className:u,...v}=e;return h.createElement("form",{noValidate:s!=="native",...v,ref:a,className:u||"react-aria-Form"},h.createElement(D.Provider,{value:{...e,validationBehavior:s}},h.createElement(B.Provider,{value:r??{}},n)))});export{X as $,D as a,K as b,W as c,L as d,$ as e};
