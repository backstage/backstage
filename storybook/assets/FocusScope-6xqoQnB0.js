import{f as H,g as I,e as U,h as m,i as E,j,k as q,l as x,m as G,n as B,o as J,p as Y}from"./useFocusRing-CK8Hb1fV.js";import{i as w}from"./utils-IJnPAz4s.js";import{r as b,a4 as R}from"./iframe-COb0l9Ot.js";class Q{get currentNode(){return this._currentNode}set currentNode(e){if(!I(this.root,e))throw new Error("Cannot set currentNode to a node that is not contained by the root node.");const r=[];let n=e,o=e;for(this._currentNode=e;n&&n!==this.root;)if(n.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const a=n,i=this._doc.createTreeWalker(a,this.whatToShow,{acceptNode:this._acceptNode});r.push(i),i.currentNode=o,this._currentSetFor.add(i),n=o=a.host}else n=n.parentNode;const l=this._doc.createTreeWalker(this.root,this.whatToShow,{acceptNode:this._acceptNode});r.push(l),l.currentNode=o,this._currentSetFor.add(l),this._walkerStack=r}get doc(){return this._doc}firstChild(){let e=this.currentNode,r=this.nextNode();return I(e,r)?(r&&(this.currentNode=r),r):(this.currentNode=e,null)}lastChild(){let r=this._walkerStack[0].lastChild();return r&&(this.currentNode=r),r}nextNode(){const e=this._walkerStack[0].nextNode();if(e){if(e.shadowRoot){var r;let o;if(typeof this.filter=="function"?o=this.filter(e):!((r=this.filter)===null||r===void 0)&&r.acceptNode&&(o=this.filter.acceptNode(e)),o===NodeFilter.FILTER_ACCEPT)return this.currentNode=e,e;let l=this.nextNode();return l&&(this.currentNode=l),l}return e&&(this.currentNode=e),e}else if(this._walkerStack.length>1){this._walkerStack.shift();let n=this.nextNode();return n&&(this.currentNode=n),n}else return null}previousNode(){const e=this._walkerStack[0];if(e.currentNode===e.root){if(this._currentSetFor.has(e))if(this._currentSetFor.delete(e),this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null;return null}const r=e.previousNode();if(r){if(r.shadowRoot){var n;let l;if(typeof this.filter=="function"?l=this.filter(r):!((n=this.filter)===null||n===void 0)&&n.acceptNode&&(l=this.filter.acceptNode(r)),l===NodeFilter.FILTER_ACCEPT)return r&&(this.currentNode=r),r;let a=this.lastChild();return a&&(this.currentNode=a),a}return r&&(this.currentNode=r),r}else if(this._walkerStack.length>1){this._walkerStack.shift();let o=this.previousNode();return o&&(this.currentNode=o),o}else return null}nextSibling(){return null}previousSibling(){return null}parentNode(){return null}constructor(e,r,n,o){this._walkerStack=[],this._currentSetFor=new Set,this._acceptNode=a=>{if(a.nodeType===Node.ELEMENT_NODE){const v=a.shadowRoot;if(v){const u=this._doc.createTreeWalker(v,this.whatToShow,{acceptNode:this._acceptNode});return this._walkerStack.unshift(u),NodeFilter.FILTER_ACCEPT}else{var i;if(typeof this.filter=="function")return this.filter(a);if(!((i=this.filter)===null||i===void 0)&&i.acceptNode)return this.filter.acceptNode(a);if(this.filter===null)return NodeFilter.FILTER_ACCEPT}}return NodeFilter.FILTER_SKIP},this._doc=e,this.root=r,this.filter=o??null,this.whatToShow=n??NodeFilter.SHOW_ALL,this._currentNode=r,this._walkerStack.unshift(e.createTreeWalker(r,n,this._acceptNode));const l=r.shadowRoot;if(l){const a=this._doc.createTreeWalker(l,this.whatToShow,{acceptNode:this._acceptNode});this._walkerStack.unshift(a)}}}function X(t,e,r,n){return H()?new Q(t,e,r,n):t.createTreeWalker(e,r,n)}function Z(t){const e=U(t);if(!(t instanceof e.HTMLElement)&&!(t instanceof e.SVGElement))return!1;let{display:r,visibility:n}=t.style,o=r!=="none"&&n!=="hidden"&&n!=="collapse";if(o){const{getComputedStyle:l}=t.ownerDocument.defaultView;let{display:a,visibility:i}=l(t);o=a!=="none"&&i!=="hidden"&&i!=="collapse"}return o}function ee(t,e){return!t.hasAttribute("hidden")&&!t.hasAttribute("data-react-aria-prevent-focus")&&(t.nodeName==="DETAILS"&&e&&e.nodeName!=="SUMMARY"?t.hasAttribute("open"):!0)}function O(t,e){return t.nodeName!=="#comment"&&Z(t)&&ee(t,e)&&(!t.parentElement||O(t.parentElement,t))}const K=R.createContext(null),L="react-aria-focus-scope-restore";let f=null;function se(t){let{children:e,contain:r,restoreFocus:n,autoFocus:o}=t,l=b.useRef(null),a=b.useRef(null),i=b.useRef([]),{parentNode:v}=b.useContext(K)||{},u=b.useMemo(()=>new A({scopeRef:i}),[i]);w(()=>{let d=v||p.root;if(p.getTreeNode(d.scopeRef)&&f&&!F(f,d.scopeRef)){let c=p.getTreeNode(f);c&&(d=c)}d.addChild(u),p.addNode(u)},[u,v]),w(()=>{let d=p.getTreeNode(i);d&&(d.contain=!!r)},[r]),w(()=>{var d;let c=(d=l.current)===null||d===void 0?void 0:d.nextSibling,N=[],g=C=>C.stopPropagation();for(;c&&c!==a.current;)N.push(c),c.addEventListener(L,g),c=c.nextSibling;return i.current=N,()=>{for(let C of N)C.removeEventListener(L,g)}},[e]),ne(i,n,r),re(i,r),ie(i,n,r),oe(i,o),b.useEffect(()=>{const d=m(E(i.current?i.current[0]:void 0));let c=null;if($(d,i.current)){for(let N of p.traverse())N.scopeRef&&$(d,N.scopeRef.current)&&(c=N);c===p.getTreeNode(i)&&(f=c.scopeRef)}},[i]),w(()=>()=>{var d,c,N;let g=(N=(c=p.getTreeNode(i))===null||c===void 0||(d=c.parent)===null||d===void 0?void 0:d.scopeRef)!==null&&N!==void 0?N:null;(i===f||F(i,f))&&(!g||p.getTreeNode(g))&&(f=g),p.removeTreeNode(i)},[i]);let h=b.useMemo(()=>te(i),[]),s=b.useMemo(()=>({focusManager:h,parentNode:u}),[u,h]);return R.createElement(K.Provider,{value:s},R.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:l}),e,R.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:a}))}function te(t){return{focusNext(e={}){let r=t.current,{from:n,tabbable:o,wrap:l,accept:a}=e;var i;let v=n||m(E((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[0].previousElementSibling,h=_(r),s=k(h,{tabbable:o,accept:a},r);s.currentNode=$(v,r)?v:u;let d=s.nextNode();return!d&&l&&(s.currentNode=u,d=s.nextNode()),d&&T(d,!0),d},focusPrevious(e={}){let r=t.current,{from:n,tabbable:o,wrap:l,accept:a}=e;var i;let v=n||m(E((i=r[0])!==null&&i!==void 0?i:void 0)),u=r[r.length-1].nextElementSibling,h=_(r),s=k(h,{tabbable:o,accept:a},r);s.currentNode=$(v,r)?v:u;let d=s.previousNode();return!d&&l&&(s.currentNode=u,d=s.previousNode()),d&&T(d,!0),d},focusFirst(e={}){let r=t.current,{tabbable:n,accept:o}=e,l=_(r),a=k(l,{tabbable:n,accept:o},r);a.currentNode=r[0].previousElementSibling;let i=a.nextNode();return i&&T(i,!0),i},focusLast(e={}){let r=t.current,{tabbable:n,accept:o}=e,l=_(r),a=k(l,{tabbable:n,accept:o},r);a.currentNode=r[r.length-1].nextElementSibling;let i=a.previousNode();return i&&T(i,!0),i}}}function _(t){return t[0].parentElement}function y(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.contain)return!1;e=e.parent}return!0}function re(t,e){let r=b.useRef(void 0),n=b.useRef(void 0);w(()=>{let o=t.current;if(!e){n.current&&(cancelAnimationFrame(n.current),n.current=void 0);return}const l=E(o?o[0]:void 0);let a=u=>{if(u.key!=="Tab"||u.altKey||u.ctrlKey||u.metaKey||!y(t)||u.isComposing)return;let h=m(l),s=t.current;if(!s||!$(h,s))return;let d=_(s),c=k(d,{tabbable:!0},s);if(!h)return;c.currentNode=h;let N=u.shiftKey?c.previousNode():c.nextNode();N||(c.currentNode=u.shiftKey?s[s.length-1].nextElementSibling:s[0].previousElementSibling,N=u.shiftKey?c.previousNode():c.nextNode()),u.preventDefault(),N&&T(N,!0)},i=u=>{(!f||F(f,t))&&$(x(u),t.current)?(f=t,r.current=x(u)):y(t)&&!S(x(u),t)?r.current?r.current.focus():f&&f.current&&M(f.current):y(t)&&(r.current=x(u))},v=u=>{n.current&&cancelAnimationFrame(n.current),n.current=requestAnimationFrame(()=>{let h=Y(),s=(h==="virtual"||h===null)&&G()&&B(),d=m(l);if(!s&&d&&y(t)&&!S(d,t)){f=t;let N=x(u);if(N&&N.isConnected){var c;r.current=N,(c=r.current)===null||c===void 0||c.focus()}else f.current&&M(f.current)}})};return l.addEventListener("keydown",a,!1),l.addEventListener("focusin",i,!1),o?.forEach(u=>u.addEventListener("focusin",i,!1)),o?.forEach(u=>u.addEventListener("focusout",v,!1)),()=>{l.removeEventListener("keydown",a,!1),l.removeEventListener("focusin",i,!1),o?.forEach(u=>u.removeEventListener("focusin",i,!1)),o?.forEach(u=>u.removeEventListener("focusout",v,!1))}},[t,e]),w(()=>()=>{n.current&&cancelAnimationFrame(n.current)},[n])}function V(t){return S(t)}function $(t,e){return!t||!e?!1:e.some(r=>r.contains(t))}function S(t,e=null){if(t instanceof Element&&t.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:r}of p.traverse(p.getTreeNode(e)))if(r&&$(t,r.current))return!0;return!1}function de(t){return S(t,f)}function F(t,e){var r;let n=(r=p.getTreeNode(e))===null||r===void 0?void 0:r.parent;for(;n;){if(n.scopeRef===t)return!0;n=n.parent}return!1}function T(t,e=!1){if(t!=null&&!e)try{J(t)}catch{}else if(t!=null)try{t.focus()}catch{}}function z(t,e=!0){let r=t[0].previousElementSibling,n=_(t),o=k(n,{tabbable:e},t);o.currentNode=r;let l=o.nextNode();return e&&!l&&(n=_(t),o=k(n,{tabbable:!1},t),o.currentNode=r,l=o.nextNode()),l}function M(t,e=!0){T(z(t,e))}function oe(t,e){const r=R.useRef(e);b.useEffect(()=>{if(r.current){f=t;const n=E(t.current?t.current[0]:void 0);!$(m(n),f.current)&&t.current&&M(t.current)}r.current=!1},[t])}function ne(t,e,r){w(()=>{if(e||r)return;let n=t.current;const o=E(n?n[0]:void 0);let l=a=>{let i=x(a);$(i,t.current)?f=t:V(i)||(f=null)};return o.addEventListener("focusin",l,!1),n?.forEach(a=>a.addEventListener("focusin",l,!1)),()=>{o.removeEventListener("focusin",l,!1),n?.forEach(a=>a.removeEventListener("focusin",l,!1))}},[t,e,r])}function P(t){let e=p.getTreeNode(f);for(;e&&e.scopeRef!==t;){if(e.nodeToRestore)return!1;e=e.parent}return e?.scopeRef===t}function ie(t,e,r){const n=b.useRef(typeof document<"u"?m(E(t.current?t.current[0]:void 0)):null);w(()=>{let o=t.current;const l=E(o?o[0]:void 0);if(!e||r)return;let a=()=>{(!f||F(f,t))&&$(m(l),t.current)&&(f=t)};return l.addEventListener("focusin",a,!1),o?.forEach(i=>i.addEventListener("focusin",a,!1)),()=>{l.removeEventListener("focusin",a,!1),o?.forEach(i=>i.removeEventListener("focusin",a,!1))}},[t,r]),w(()=>{const o=E(t.current?t.current[0]:void 0);if(!e)return;let l=a=>{if(a.key!=="Tab"||a.altKey||a.ctrlKey||a.metaKey||!y(t)||a.isComposing)return;let i=o.activeElement;if(!S(i,t)||!P(t))return;let v=p.getTreeNode(t);if(!v)return;let u=v.nodeToRestore,h=k(o.body,{tabbable:!0});h.currentNode=i;let s=a.shiftKey?h.previousNode():h.nextNode();if((!u||!u.isConnected||u===o.body)&&(u=void 0,v.nodeToRestore=void 0),(!s||!S(s,t))&&u){h.currentNode=u;do s=a.shiftKey?h.previousNode():h.nextNode();while(S(s,t));a.preventDefault(),a.stopPropagation(),s?T(s,!0):V(u)?T(u,!0):i.blur()}};return r||o.addEventListener("keydown",l,!0),()=>{r||o.removeEventListener("keydown",l,!0)}},[t,e,r]),w(()=>{const o=E(t.current?t.current[0]:void 0);if(!e)return;let l=p.getTreeNode(t);if(l){var a;return l.nodeToRestore=(a=n.current)!==null&&a!==void 0?a:void 0,()=>{let i=p.getTreeNode(t);if(!i)return;let v=i.nodeToRestore,u=m(o);if(e&&v&&(u&&S(u,t)||u===o.body&&P(t))){let h=p.clone();requestAnimationFrame(()=>{if(o.activeElement===o.body){let s=h.getTreeNode(t);for(;s;){if(s.nodeToRestore&&s.nodeToRestore.isConnected){W(s.nodeToRestore);return}s=s.parent}for(s=h.getTreeNode(t);s;){if(s.scopeRef&&s.scopeRef.current&&p.getTreeNode(s.scopeRef)){let d=z(s.scopeRef.current,!0);W(d);return}s=s.parent}}})}}}},[t,e])}function W(t){t.dispatchEvent(new CustomEvent(L,{bubbles:!0,cancelable:!0}))&&T(t)}function k(t,e,r){let n=e?.tabbable?j:q,o=t?.nodeType===Node.ELEMENT_NODE?t:null,l=E(o),a=X(l,t||l,NodeFilter.SHOW_ELEMENT,{acceptNode(i){var v;return!(e==null||(v=e.from)===null||v===void 0)&&v.contains(i)?NodeFilter.FILTER_REJECT:n(i)&&O(i)&&(!r||$(i,r))&&(!e?.accept||e.accept(i))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return e?.from&&(a.currentNode=e.from),a}class D{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,r,n){let o=this.fastMap.get(r??null);if(!o)return;let l=new A({scopeRef:e});o.addChild(l),l.parent=o,this.fastMap.set(e,l),n&&(l.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(e===null)return;let r=this.fastMap.get(e);if(!r)return;let n=r.parent;for(let l of this.traverse())l!==r&&r.nodeToRestore&&l.nodeToRestore&&r.scopeRef&&r.scopeRef.current&&$(l.nodeToRestore,r.scopeRef.current)&&(l.nodeToRestore=r.nodeToRestore);let o=r.children;n&&(n.removeChild(r),o.size>0&&o.forEach(l=>n&&n.addChild(l))),this.fastMap.delete(r.scopeRef)}*traverse(e=this.root){if(e.scopeRef!=null&&(yield e),e.children.size>0)for(let r of e.children)yield*this.traverse(r)}clone(){var e;let r=new D;var n;for(let o of this.traverse())r.addTreeNode(o.scopeRef,(n=(e=o.parent)===null||e===void 0?void 0:e.scopeRef)!==null&&n!==void 0?n:null,o.nodeToRestore);return r}constructor(){this.fastMap=new Map,this.root=new A({scopeRef:null}),this.fastMap.set(null,this.root)}}class A{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let p=new D;export{k as $,de as a,se as b};
