import{$ as q,a as V,e as G,g as le,c as ie}from"./utils-BXllfVt4.js";import{e as re,f as J,g as ne,h as de,i as se,j as _,k as ce,l as ue}from"./SelectionManager-AOhnTTKk.js";import{r as s,R as u}from"./iframe-M9O-K8SB.js";import{$ as fe,a as $e,b as be,c as ve,d as ge,e as pe,f as xe}from"./Separator-CPZLX6dD.js";import{c as me}from"./RSPContexts-BdpIjeVF.js";import{a as he,b as Pe,c as De}from"./SelectionIndicator-yhlvspp_.js";import{a as ye}from"./Text-B7PuQZMK.js";import{b as Ee,a as Q,$ as B,c as W,f as Me,d as X}from"./useObjectRef-BPFp5snO.js";import{b as Ce,$ as L,A as Se,z as Be,o as j,d as Fe,q as Le}from"./useFocusable-BwFERnd_.js";import{$ as we,a as Ie,b as Ve}from"./useListState-DtLAZGwv.js";import{b as Oe,$ as Y,a as ke}from"./useFocusRing-COnCKKka.js";import{$ as Te}from"./useLabel-COjMvP6r.js";import{$ as Ue}from"./context-Bv6kxITJ.js";function Ae(t,e){let{collection:a,onLoadMore:o,scrollOffset:i=1}=t,r=s.useRef(null),l=Ce(n=>{for(let c of n)c.isIntersecting&&o&&o()});Ee(()=>(e.current&&(r.current=new IntersectionObserver(l,{root:fe(e?.current),rootMargin:`0px ${100*i}% ${100*i}% ${100*i}%`}),r.current.observe(e.current)),()=>{r.current&&r.current.disconnect()}),[a,e,i])}const H=new WeakMap;function Ne(t){return typeof t=="string"?t.replace(/\s*/g,""):""+t}function Ke(t,e){let a=H.get(t);if(!a)throw new Error("Unknown list");return`${a.id}-option-${Ne(e)}`}function ze(t,e,a){let o=L(t,{labelable:!0}),i=t.selectionBehavior||"toggle",r=t.linkBehavior||(i==="replace"?"action":"override");i==="toggle"&&r==="action"&&(r="override");let{listProps:l}=$e({...t,ref:a,selectionManager:e.selectionManager,collection:e.collection,disabledKeys:e.disabledKeys,linkBehavior:r}),{focusWithinProps:n}=Oe({onFocusWithin:t.onFocus,onBlurWithin:t.onBlur,onFocusWithinChange:t.onFocusChange}),c=Q(t.id);H.set(e,{id:c,shouldUseVirtualFocus:t.shouldUseVirtualFocus,shouldSelectOnPressUp:t.shouldSelectOnPressUp,shouldFocusOnHover:t.shouldFocusOnHover,isVirtualized:t.isVirtualized,onAction:t.onAction,linkBehavior:r,UNSTABLE_itemBehavior:t.UNSTABLE_itemBehavior});let{labelProps:f,fieldProps:b}=Te({...t,id:c,labelElementType:"span"});return{labelProps:f,listBoxProps:B(o,n,e.selectionManager.selectionMode==="multiple"?{"aria-multiselectable":"true"}:{},{role:"listbox",...B(b,l)})}}function _e(t,e,a){var o,i;let{key:r}=t,l=H.get(e);var n;let c=(n=t.isDisabled)!==null&&n!==void 0?n:e.selectionManager.isDisabled(r);var f;let b=(f=t.isSelected)!==null&&f!==void 0?f:e.selectionManager.isSelected(r);var d;let $=(d=t.shouldSelectOnPressUp)!==null&&d!==void 0?d:l?.shouldSelectOnPressUp;var x;let p=(x=t.shouldFocusOnHover)!==null&&x!==void 0?x:l?.shouldFocusOnHover;var P;let D=(P=t.shouldUseVirtualFocus)!==null&&P!==void 0?P:l?.shouldUseVirtualFocus;var g;let M=(g=t.isVirtualized)!==null&&g!==void 0?g:l?.isVirtualized,C=W(),y=W(),m={role:"option","aria-disabled":c||void 0,"aria-selected":e.selectionManager.selectionMode!=="none"?b:void 0};Se()&&Be()||(m["aria-label"]=t["aria-label"],m["aria-labelledby"]=C,m["aria-describedby"]=y);let v=e.collection.getItem(r);if(M){let E=Number(v?.index);m["aria-posinset"]=Number.isNaN(E)?void 0:E+1,m["aria-setsize"]=be(e.collection)}let h=l?.onAction?()=>{var E;return l==null||(E=l.onAction)===null||E===void 0?void 0:E.call(l,r)}:void 0,S=Ke(e,r),{itemProps:w,isPressed:k,isFocused:I,hasAction:K,allowsSelection:T}=re({selectionManager:e.selectionManager,key:r,ref:a,shouldSelectOnPressUp:$,allowsDifferentPressOrigin:$&&p,isVirtualized:M,shouldUseVirtualFocus:D,isDisabled:c,onAction:h||!(v==null||(o=v.props)===null||o===void 0)&&o.onAction?Me(v==null||(i=v.props)===null||i===void 0?void 0:i.onAction,h):void 0,linkBehavior:l?.linkBehavior,UNSTABLE_itemBehavior:l?.UNSTABLE_itemBehavior,id:S}),{hoverProps:U}=Y({isDisabled:c||!p,onHoverStart(){j()||(e.selectionManager.setFocused(!0),e.selectionManager.setFocusedKey(r))}}),F=L(v?.props);delete F.id;let A=Fe(v?.props);return{optionProps:{...m,...B(F,w,U,A),id:S},labelProps:{id:C},descriptionProps:{id:y},isFocused:I,isFocusVisible:I&&e.selectionManager.isFocused&&j(),isSelected:b,isDisabled:c,isPressed:k,allowsSelection:T,hasAction:K}}function He(t){let{heading:e,"aria-label":a}=t,o=Q();return{itemProps:{role:"presentation"},headingProps:e?{id:o,role:"presentation"}:{},groupProps:{role:"group","aria-label":a,"aria-labelledby":e?o:void 0}}}const N=s.createContext({}),Z=s.createContext(null),Re=s.forwardRef(function(e,a){let{render:o}=s.useContext(Z);return u.createElement(u.Fragment,null,o(e,a))});function ee(t,e){var a;let o=t?.renderDropIndicator,i=t==null||(a=t.isVirtualDragging)===null||a===void 0?void 0:a.call(t),r=s.useCallback(l=>{if(i||e?.isDropTarget(l))return o?o(l):u.createElement(Re,{target:l})},[e?.target,i,o]);return t?.useDropIndicator?r:void 0}function We(t,e,a){var o,i;let r=t.focusedKey,l=null;if(!(e==null||(o=e.isVirtualDragging)===null||o===void 0)&&o.call(e)&&(a==null||(i=a.target)===null||i===void 0?void 0:i.type)==="item"&&(l=a.target.key,a.target.dropPosition==="after")){let d=a.collection.getKeyAfter(l),$=null;if(d!=null){var n,c;let x=(c=(n=a.collection.getItem(l))===null||n===void 0?void 0:n.level)!==null&&c!==void 0?c:0;for(;d;){let p=a.collection.getItem(d);if(!p)break;if(p.type!=="item"){d=a.collection.getKeyAfter(d);continue}var f;if(((f=p.level)!==null&&f!==void 0?f:0)<=x)break;$=d,d=a.collection.getKeyAfter(d)}}var b;l=(b=d??$)!==null&&b!==void 0?b:l}return s.useMemo(()=>new Set([r,l].filter(d=>d!=null)),[r,l])}const te=s.createContext(null),O=s.createContext(null),ct=s.forwardRef(function(e,a){[e,a]=q(e,a,te);let o=s.useContext(O);return o?u.createElement(oe,{state:o,props:e,listBoxRef:a}):u.createElement(ne,{content:u.createElement(de,e)},i=>u.createElement(je,{props:e,listBoxRef:a,collection:i}))});function je({props:t,listBoxRef:e,collection:a}){t={...t,collection:a,children:null,items:null};let{layoutDelegate:o}=s.useContext(_),i=Ie({...t,layoutDelegate:o});return u.createElement(oe,{state:i,props:t,listBoxRef:e})}function oe({state:t,props:e,listBoxRef:a}){[e,a]=q(e,a,me);let{dragAndDropHooks:o,layout:i="stack",orientation:r="vertical",filter:l}=e,n=we(t,l),{collection:c,selectionManager:f}=n,b=!!o?.useDraggableCollectionState,d=!!o?.useDroppableCollectionState,{direction:$}=Ue(),{disabledBehavior:x,disabledKeys:p}=f,P=ve({usage:"search",sensitivity:"base"}),{isVirtualized:D,layoutDelegate:g,dropTargetDelegate:M,CollectionRoot:C}=s.useContext(_),y=s.useMemo(()=>e.keyboardDelegate||new ge({collection:c,collator:P,ref:a,disabledKeys:p,disabledBehavior:x,layout:i,orientation:r,direction:$,layoutDelegate:g}),[c,P,a,x,p,r,$,e.keyboardDelegate,i,g]),{listBoxProps:m}=ze({...e,shouldSelectOnPressUp:b||e.shouldSelectOnPressUp,keyboardDelegate:y,isVirtualized:D},n,a);s.useRef(b),s.useRef(d),s.useEffect(()=>{},[b,d]);let v,h,S,w=!1,k=null,I=s.useRef(null);if(b&&o){v=o.useDraggableCollectionState({collection:c,selectionManager:f,preview:o.renderDragPreview?I:void 0}),o.useDraggableCollection({},v,a);let z=o.DragPreview;k=o.renderDragPreview?u.createElement(z,{ref:I},o.renderDragPreview):null}if(d&&o){h=o.useDroppableCollectionState({collection:c,selectionManager:f});let z=o.dropTargetDelegate||M||new o.ListDropTargetDelegate(c,a,{orientation:r,layout:i,direction:$});S=o.useDroppableCollection({keyboardDelegate:y,dropTargetDelegate:z},h,a),w=h.isDropTarget({type:"root"})}let{focusProps:K,isFocused:T,isFocusVisible:U}=ke(),F=n.collection.size===0,A={isDropTarget:w,isEmpty:F,isFocused:T,isFocusVisible:U,layout:e.layout||"stack",state:n},E=V({className:e.className,style:e.style,defaultClassName:"react-aria-ListBox",values:A}),R=null;F&&e.renderEmptyState&&(R=u.createElement("div",{role:"option",style:{display:"contents"}},e.renderEmptyState(A)));let ae=L(e,{global:!0});return u.createElement(Pe,null,u.createElement("div",{...B(ae,E,m,K,S?.collectionProps),ref:a,slot:e.slot||void 0,onScroll:e.onScroll,"data-drop-target":w||void 0,"data-empty":F||void 0,"data-focused":T||void 0,"data-focus-visible":U||void 0,"data-layout":e.layout||"stack","data-orientation":e.orientation||"vertical"},u.createElement(G,{values:[[te,e],[O,n],[N,{dragAndDropHooks:o,dragState:v,dropState:h}],[pe,{elementType:"div"}],[Z,{render:Ge}],[ce,{name:"ListBoxSection",render:qe}]]},u.createElement(De,null,u.createElement(C,{collection:c,scrollRef:a,persistedKeys:We(f,o,h),renderDropIndicator:ee(o,h)}))),R,k))}function qe(t,e,a,o="react-aria-ListBoxSection"){let i=s.useContext(O),{dragAndDropHooks:r,dropState:l}=s.useContext(N),{CollectionBranch:n}=s.useContext(_),[c,f]=ie();var b;let{headingProps:d,groupProps:$}=He({heading:f,"aria-label":(b=t["aria-label"])!==null&&b!==void 0?b:void 0}),x=V({defaultClassName:o,className:t.className,style:t.style,values:{}}),p=L(t,{global:!0});return delete p.id,u.createElement("section",{...B(p,x,$),ref:e},u.createElement(xe.Provider,{value:{...d,ref:c}},u.createElement(n,{collection:i.collection,parent:a,renderDropIndicator:ee(r,l)})))}const ut=J(se,function(e,a,o){let i=X(a),r=s.useContext(O),{dragAndDropHooks:l,dragState:n,dropState:c}=s.useContext(N),{optionProps:f,labelProps:b,descriptionProps:d,...$}=_e({key:o.key,"aria-label":e?.["aria-label"]},r,i),{hoverProps:x,isHovered:p}=Y({isDisabled:!$.allowsSelection&&!$.hasAction,onHoverStart:o.props.onHoverStart,onHoverChange:o.props.onHoverChange,onHoverEnd:o.props.onHoverEnd}),{focusProps:P}=Le(e),D=null;n&&l&&(D=l.useDraggableItem({key:o.key,hasAction:$.hasAction},n));let g=null;c&&l&&(g=l.useDroppableItem({target:{type:"item",key:o.key,dropPosition:"on"}},c,i));let M=n&&n.isDragging(o.key),C=V({...e,id:void 0,children:e.children,defaultClassName:"react-aria-ListBoxItem",values:{...$,isHovered:p,selectionMode:r.selectionManager.selectionMode,selectionBehavior:r.selectionManager.selectionBehavior,allowsDragging:!!n,isDragging:M,isDropTarget:g?.isDropTarget}});s.useEffect(()=>{o.textValue},[o.textValue]);let y=e.href?"a":"div",m=L(e,{global:!0});return delete m.id,delete m.onClick,y==="a"&&f.tabIndex==null&&(f.tabIndex=-1),u.createElement(y,{...B(m,C,f,x,P,D?.dragProps,g?.dropProps),ref:i,"data-allows-dragging":!!n||void 0,"data-selected":$.isSelected||void 0,"data-disabled":$.isDisabled||void 0,"data-hovered":p||void 0,"data-focused":$.isFocused||void 0,"data-focus-visible":$.isFocusVisible||void 0,"data-pressed":$.isPressed||void 0,"data-dragging":M||void 0,"data-drop-target":g?.isDropTarget||void 0,"data-selection-mode":r.selectionManager.selectionMode==="none"?void 0:r.selectionManager.selectionMode},u.createElement(G,{values:[[ye,{slots:{[le]:b,label:b,description:d}}],[he,{isSelected:$.isSelected}]]},C.children))});function Ge(t,e){e=X(e);let{dragAndDropHooks:a,dropState:o}=s.useContext(N),{dropIndicatorProps:i,isHidden:r,isDropTarget:l}=a.useDropIndicator(t,o,e);return r?null:u.createElement(Qe,{...t,dropIndicatorProps:i,isDropTarget:l,ref:e})}function Je(t,e){let{dropIndicatorProps:a,isDropTarget:o,...i}=t,r=V({...i,defaultClassName:"react-aria-DropIndicator",values:{isDropTarget:o}});return u.createElement("div",{...a,...r,role:"option",ref:e,"data-drop-target":o||void 0})}const Qe=s.forwardRef(Je);J(ue,function(e,a,o){let i=s.useContext(O),{isLoading:r,onLoadMore:l,scrollOffset:n,...c}=e,f=s.useRef(null),b=s.useMemo(()=>({onLoadMore:l,collection:i?.collection,sentinelRef:f,scrollOffset:n}),[l,n,i?.collection]);Ae(b,f);let d=V({...c,id:void 0,children:o.rendered,defaultClassName:"react-aria-ListBoxLoadingIndicator",values:null}),$={tabIndex:-1};return u.createElement(u.Fragment,null,u.createElement("div",{style:{position:"relative",width:0,height:0},inert:Ve(!0)},u.createElement("div",{"data-testid":"loadMoreSentinel",ref:f,style:{position:"absolute",height:1,width:1}})),r&&d.children&&u.createElement("div",{...B(L(e,{global:!0}),$),...d,role:"option",ref:a},d.children))});export{ct as $,ut as a,te as b,O as c,N as d,ee as e,Z as f,We as g,Ae as h};
