import{j as u}from"./jsx-runtime-hv06LKfz.js";import{l as L}from"./lodash-D1GzKnrP.js";import{r}from"./index-D8-PC79C.js";import{u as j}from"./useAsync-7M-9CJJS.js";import{s as I}from"./api-YILTVPsk.js";import{u as S,b as N}from"./ApiRef-ByCJBjX1.js";import{c as R,a as q}from"./ConfigApi-ij0WO1-Y.js";import{A as T,u as k}from"./useAnalytics-Q-nz63z2.js";function C(e){var s=r.useRef();return r.useEffect(function(){s.current=e}),s.current}const g=N("search-context"),U=()=>{const e=r.useContext(g);if(!e)throw new Error("useSearch must be used within a SearchContextProvider");const s=e.atVersion(1);if(!s)throw new Error("No SearchContext v1 found");return s},F=()=>r.useContext(g)!==void 0,P={term:"",types:[],filters:{},pageLimit:void 0,pageCursor:void 0},_=(e=P)=>{const s=S(I),i=k(),[t,p]=r.useState(e.term),[c,h]=r.useState(e.types),[a,l]=r.useState(e.filters),[f,y]=r.useState(e.pageLimit),[v,n]=r.useState(e.pageCursor),m=C(t),x=C(a),o=j(async()=>{const d=await s.query({term:t,types:c,filters:a,pageLimit:f,pageCursor:v});return t&&i.captureEvent("search",t,{value:d.numberOfResults}),d},[t,c,a,f,v]),b=!o.loading&&!o.error&&o.value?.nextPageCursor,A=!o.loading&&!o.error&&o.value?.previousPageCursor,E=r.useCallback(()=>{n(o.value?.nextPageCursor)},[o.value?.nextPageCursor]),w=r.useCallback(()=>{n(o.value?.previousPageCursor)},[o.value?.previousPageCursor]);return r.useEffect(()=>{m!==void 0&&t!==m&&n(void 0)},[t,m,n]),r.useEffect(()=>{x!==void 0&&!L.isEqual(a,x)&&n(void 0)},[a,x,n]),{result:o,term:t,setTerm:p,types:c,setTypes:h,filters:a,setFilters:l,pageLimit:f,setPageLimit:y,pageCursor:v,setPageCursor:n,fetchNextPage:b?E:void 0,fetchPreviousPage:A?w:void 0}},M=e=>{const{initialState:s,children:i}=e,t=_(s);return u.jsx(T,{attributes:{searchTypes:t.types.sort().join(",")},children:u.jsx(g.Provider,{value:q({1:t}),children:i})})},O=e=>{const{initialState:s,inheritParentContextIfAvailable:i,children:t}=e,p=F(),c=S(R),h=s??{},a=c.has("search.query.pageLimit")?{pageLimit:c.getNumber("search.query.pageLimit")}:{},l={...P,...h,...a};return p&&i?u.jsx(u.Fragment,{children:t}):u.jsx(M,{initialState:l,children:t})};O.__docgenInfo={description:`@public
Search context provider which gives you access to shared state between search components`,methods:[],displayName:"SearchContextProvider"};export{O as S,C as a,U as u};
