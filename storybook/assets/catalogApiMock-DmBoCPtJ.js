import{N as h,f as c}from"./ApiRef-ByCJBjX1.js";import{s as d,p as S,D as j}from"./ref-C0VTUPuL.js";import{c as u}from"./api-HGrEAGnM.js";import{a as E}from"./appWrappers-9ZYivgV2.js";const R=Symbol.for("CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111"),v=500,I=["attachments","relations","status","metadata.name","metadata.namespace","metadata.uid","metadata.etag"];function _(a){const t=[];function e(n,o){if(!I.includes(n)){if(o==null||["string","number","boolean"].includes(typeof o)){t.push({key:n,value:o});return}if(typeof o=="object"){if(Array.isArray(o)){for(const i of o)if(e(n,i),typeof i=="string"){const s=`${n}.${i}`;t.some(f=>f.key.toLocaleLowerCase("en-US")===s.toLocaleLowerCase("en-US"))||t.push({key:s,value:!0})}return}for(const[i,s]of Object.entries(o))e(n?`${n}.${i}`:i,s)}}}return e("",a),t}function L(a){const t=_(a);a.metadata?.name&&t.push({key:"metadata.name",value:a.metadata.name.toLocaleLowerCase("en-US")}),a.metadata?.namespace&&t.push({key:"metadata.namespace",value:a.metadata.namespace.toLocaleLowerCase("en-US")}),a.metadata?.uid&&t.push({key:"metadata.uid",value:a.metadata.uid.toLocaleLowerCase("en-US")}),a.metadata.namespace||t.push({key:"metadata.namespace",value:j});for(const e of a.relations??[])t.push({key:`relations.${e.type.toLocaleLowerCase("en-US")}`,value:e.targetRef.toLocaleLowerCase("en-US")});return t}function y(a){if(!a)return()=>!0;const t=[a].flat();return e=>{const n=L(e);return t.some(o=>{for(const[i,s]of Object.entries(o)){const f=n.filter(r=>r.key===i.toLocaleLowerCase("en-US")).map(r=>r.value?.toString().toLocaleLowerCase("en-US"));if(f.length===0)return!1;if(s!==R){if(Array.isArray(s))return s.some(r=>f?.includes(String(r).toLocaleLowerCase("en-US")));if(!f?.includes(String(s).toLocaleLowerCase("en-US")))return!1}}return!0})}}class g{#t;constructor(t){this.#t=t?.entities?.slice()??[]}async getEntities(t){const e=y(t?.filter);return{items:this.#t.filter(e)}}async getEntitiesByRefs(t){const e=y(t.filter),n=this.#e();return{items:t.entityRefs.map(o=>n.get(o)).map(o=>o&&e(o)?o:void 0)}}async queryEntities(t){if(t&&"cursor"in t)return{items:[],pageInfo:{},totalItems:0};const e=y(t?.filter),n=this.#t.filter(e);return{items:n,pageInfo:{},totalItems:n.length}}async getEntityAncestors(t){const e=this.#e().get(t.entityRef);if(!e)throw new h(`Entity with ref ${t.entityRef} not found`);return{items:[{entity:e,parentEntityRefs:[]}],rootEntityRef:t.entityRef}}async getEntityByRef(t){return this.#e().get(d(S(t)))}async removeEntityByUid(t){const e=this.#t.findIndex(n=>n.metadata.uid===t);e!==-1&&this.#t.splice(e,1)}async refreshEntity(t){}async getEntityFacets(t){const e=y(t.filter),n=this.#t.filter(e);return{facets:Object.fromEntries(t.facets.map(i=>{const s=new Map;for(const r of n){const m=L(r).find(w=>w.key===i.toLocaleLowerCase("en-US"))?.value;m&&s.set(String(m),(s.get(String(m))??0)+1)}const f=Array.from(s.entries()).map(([r,l])=>({value:r,count:l}));return[i,f]}))}}async getLocations(t){throw new c("Method not implemented.")}async getLocationById(t){throw new c("Method not implemented.")}async getLocationByRef(t){throw new c("Method not implemented.")}async addLocation(t){throw new c("Method not implemented.")}async removeLocationById(t){throw new c("Method not implemented.")}async getLocationByEntity(t){throw new c("Method not implemented.")}async validateEntity(t,e){throw new c("Method not implemented.")}async analyzeLocation(t){throw new c("Method not implemented.")}async*streamEntities(t){let e;const n=t?.pageSize??v;do{const o=await this.queryEntities(e?{...t,limit:n,cursor:e}:{...t,limit:n});yield o.items,e=o.pageInfo.nextCursor}while(e)}#e(){return new Map(this.#t.map(t=>[d(t),t]))}}function A(a,t){return e=>{const n=t();if(e)for(const[o,i]of Object.entries(e))typeof i=="function"?n[o].mockImplementation(i):n[o]=i;return Object.assign(n,{factory:E({api:a,deps:{},factory:()=>n})})}}function p(a){return new g(a)}(a=>{a.factory=t=>E({api:u,deps:{},factory:()=>new g(t)}),a.mock=A(u,()=>({getEntities:jest.fn(),getEntitiesByRefs:jest.fn(),queryEntities:jest.fn(),getEntityAncestors:jest.fn(),getEntityByRef:jest.fn(),removeEntityByUid:jest.fn(),refreshEntity:jest.fn(),getEntityFacets:jest.fn(),getLocations:jest.fn(),getLocationById:jest.fn(),getLocationByRef:jest.fn(),addLocation:jest.fn(),removeLocationById:jest.fn(),getLocationByEntity:jest.fn(),validateEntity:jest.fn(),analyzeLocation:jest.fn(),streamEntities:jest.fn(),streamEntityPages:jest.fn()}))})(p||(p={}));export{p as c};
