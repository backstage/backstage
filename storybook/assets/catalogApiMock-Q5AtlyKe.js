import{N as h,f as c}from"./ApiRef-ByCJBjX1.js";import{s as d,p as S,D as R}from"./ref-C0VTUPuL.js";import{c as u}from"./api-HGrEAGnM.js";import{a as L}from"./appWrappers-9ZYivgV2.js";const j=Symbol.for("CATALOG_FILTER_EXISTS_0e15b590c0b343a2bae3e787e84c2111"),v=["attachments","relations","status","metadata.name","metadata.namespace","metadata.uid","metadata.etag"];function C(n){const e=[];function t(o,a){if(!v.includes(o)){if(a==null||["string","number","boolean"].includes(typeof a)){e.push({key:o,value:a});return}if(typeof a=="object"){if(Array.isArray(a)){for(const i of a)if(t(o,i),typeof i=="string"){const s=`${o}.${i}`;e.some(f=>f.key.toLocaleLowerCase("en-US")===s.toLocaleLowerCase("en-US"))||e.push({key:s,value:!0})}return}for(const[i,s]of Object.entries(a))t(o?`${o}.${i}`:i,s)}}}return t("",n),e}function E(n){const e=C(n);n.metadata?.name&&e.push({key:"metadata.name",value:n.metadata.name.toLocaleLowerCase("en-US")}),n.metadata?.namespace&&e.push({key:"metadata.namespace",value:n.metadata.namespace.toLocaleLowerCase("en-US")}),n.metadata?.uid&&e.push({key:"metadata.uid",value:n.metadata.uid.toLocaleLowerCase("en-US")}),n.metadata.namespace||e.push({key:"metadata.namespace",value:R});for(const t of n.relations??[])e.push({key:`relations.${t.type.toLocaleLowerCase("en-US")}`,value:t.targetRef.toLocaleLowerCase("en-US")});return e}function y(n){if(!n)return()=>!0;const e=[n].flat();return t=>{const o=E(t);return e.some(a=>{for(const[i,s]of Object.entries(a)){const f=o.filter(r=>r.key===i.toLocaleLowerCase("en-US")).map(r=>r.value?.toString().toLocaleLowerCase("en-US"));if(f.length===0)return!1;if(s!==j){if(Array.isArray(s))return s.some(r=>f?.includes(String(r).toLocaleLowerCase("en-US")));if(!f?.includes(String(s).toLocaleLowerCase("en-US")))return!1}}return!0})}}class g{#e;constructor(e){this.#e=e?.entities?.slice()??[]}async getEntities(e){const t=y(e?.filter);return{items:this.#e.filter(t)}}async getEntitiesByRefs(e){const t=y(e.filter),o=this.#t();return{items:e.entityRefs.map(a=>o.get(a)).map(a=>a&&t(a)?a:void 0)}}async queryEntities(e){if(e&&"cursor"in e)return{items:[],pageInfo:{},totalItems:0};const t=y(e?.filter),o=this.#e.filter(t);return{items:o,pageInfo:{},totalItems:o.length}}async getEntityAncestors(e){const t=this.#t().get(e.entityRef);if(!t)throw new h(`Entity with ref ${e.entityRef} not found`);return{items:[{entity:t,parentEntityRefs:[]}],rootEntityRef:e.entityRef}}async getEntityByRef(e){return this.#t().get(d(S(e)))}async removeEntityByUid(e){const t=this.#e.findIndex(o=>o.metadata.uid===e);t!==-1&&this.#e.splice(t,1)}async refreshEntity(e){}async getEntityFacets(e){const t=y(e.filter),o=this.#e.filter(t);return{facets:Object.fromEntries(e.facets.map(i=>{const s=new Map;for(const r of o){const m=E(r).find(w=>w.key===i.toLocaleLowerCase("en-US"))?.value;m&&s.set(String(m),(s.get(String(m))??0)+1)}const f=Array.from(s.entries()).map(([r,l])=>({value:r,count:l}));return[i,f]}))}}async getLocations(e){throw new c("Method not implemented.")}async getLocationById(e){throw new c("Method not implemented.")}async getLocationByRef(e){throw new c("Method not implemented.")}async addLocation(e){throw new c("Method not implemented.")}async removeLocationById(e){throw new c("Method not implemented.")}async getLocationByEntity(e){throw new c("Method not implemented.")}async validateEntity(e,t){throw new c("Method not implemented.")}async analyzeLocation(e){throw new c("Method not implemented.")}#t(){return new Map(this.#e.map(e=>[d(e),e]))}}function k(n,e){return t=>{const o=e();if(t)for(const[a,i]of Object.entries(t))typeof i=="function"?o[a].mockImplementation(i):o[a]=i;return Object.assign(o,{factory:L({api:n,deps:{},factory:()=>o})})}}function p(n){return new g(n)}(n=>{n.factory=e=>L({api:u,deps:{},factory:()=>new g(e)}),n.mock=k(u,()=>({getEntities:jest.fn(),getEntitiesByRefs:jest.fn(),queryEntities:jest.fn(),getEntityAncestors:jest.fn(),getEntityByRef:jest.fn(),removeEntityByUid:jest.fn(),refreshEntity:jest.fn(),getEntityFacets:jest.fn(),getLocations:jest.fn(),getLocationById:jest.fn(),getLocationByRef:jest.fn(),addLocation:jest.fn(),removeLocationById:jest.fn(),getLocationByEntity:jest.fn(),validateEntity:jest.fn(),analyzeLocation:jest.fn()}))})(p||(p={}));export{p as c};
